(CompilationUnit(TypeDeclaration(Modifier:public)(TYPE_DECLARATION_KIND:class)(SimpleName:Test)(MethodDeclaration(Modifier:public)(SimpleType(SimpleName:XmldbURI))(SimpleName:createFile)(SingleVariableDeclaration(SimpleType(SimpleName:String))(SimpleName:newName))(SingleVariableDeclaration(SimpleType(SimpleName:InputStream))(SimpleName:is))(SingleVariableDeclaration(SimpleType(SimpleName:Long))(SimpleName:length))(SingleVariableDeclaration(SimpleType(SimpleName:String))(SimpleName:contentType))(SimpleType(SimpleName:IOException))(SimpleType(SimpleName:PermissionDeniedException))(SimpleType(SimpleName:CollectionDoesNotExistException))(Block(IfStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:LOG))(SimpleName:isDebugEnabled))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:LOG))(SimpleName:debug)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(SimpleName:newName)(StringLiteral:<STR>)(SimpleName:xmldbUri)(StringLiteral:<STR>))))))(VariableDeclarationStatement(SimpleType(SimpleName:XmldbURI))(VariableDeclarationFragment(SimpleName:newNameUri)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:XmldbURI))(SimpleName:create)(METHOD_INVOCATION_ARGUMENTS(SimpleName:newName)))))(VariableDeclarationStatement(SimpleType(SimpleName:MimeType))(VariableDeclarationFragment(SimpleName:mime)(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:MimeTable))(SimpleName:getInstance)))(SimpleName:getContentTypeFor)(METHOD_INVOCATION_ARGUMENTS(SimpleName:newName)))))(IfStatement(InfixExpression(SimpleName:mime)(INFIX_EXPRESSION_OPERATOR:==)(NullLiteral))(Block(ExpressionStatement(Assignment(SimpleName:mime)(ASSIGNMENT_OPERATOR:=)(QualifiedName:MimeType.BINARY_TYPE)))))(VariableDeclarationStatement(SimpleType(SimpleName:DBBroker))(VariableDeclarationFragment(SimpleName:broker)(NullLiteral)))(VariableDeclarationStatement(SimpleType(SimpleName:Collection))(VariableDeclarationFragment(SimpleName:collection)(NullLiteral)))(VariableDeclarationStatement(SimpleType(SimpleName:BufferedInputStream))(VariableDeclarationFragment(SimpleName:bis)(ClassInstanceCreation(SimpleType(SimpleName:BufferedInputStream))(SimpleName:is))))(VariableDeclarationStatement(SimpleType(SimpleName:VirtualTempFile))(VariableDeclarationFragment(SimpleName:vtf)(ClassInstanceCreation(SimpleType(SimpleName:VirtualTempFile)))))(VariableDeclarationStatement(SimpleType(SimpleName:BufferedOutputStream))(VariableDeclarationFragment(SimpleName:bos)(ClassInstanceCreation(SimpleType(SimpleName:BufferedOutputStream))(SimpleName:vtf))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:IOUtils))(SimpleName:copy)(METHOD_INVOCATION_ARGUMENTS(SimpleName:bis)(SimpleName:bos))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:bis))(SimpleName:close)))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:bos))(SimpleName:close)))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:vtf))(SimpleName:close)))(IfStatement(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mime))(SimpleName:isXMLType))(INFIX_EXPRESSION_OPERATOR:&&)(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:vtf))(SimpleName:length))(INFIX_EXPRESSION_OPERATOR:==)(NumberLiteral:0L)))(Block(IfStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:LOG))(SimpleName:isDebugEnabled))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:LOG))(SimpleName:debug)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(SimpleName:newNameUri)(StringLiteral:<STR>))))))(ExpressionStatement(Assignment(SimpleName:vtf)(ASSIGNMENT_OPERATOR:=)(ClassInstanceCreation(SimpleType(SimpleName:VirtualTempFile)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:IOUtils))(SimpleName:write)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)(SimpleName:vtf))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:vtf))(SimpleName:close)))))(VariableDeclarationStatement(SimpleType(SimpleName:TransactionManager))(VariableDeclarationFragment(SimpleName:transact)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:brokerPool))(SimpleName:getTransactionManager))))(VariableDeclarationStatement(SimpleType(SimpleName:Txn))(VariableDeclarationFragment(SimpleName:txn)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:transact))(SimpleName:beginTransaction))))(TryStatement(Block(ExpressionStatement(Assignment(SimpleName:broker)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:brokerPool))(SimpleName:get)(METHOD_INVOCATION_ARGUMENTS(SimpleName:subject)))))(ExpressionStatement(Assignment(SimpleName:collection)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:broker))(SimpleName:openCollection)(METHOD_INVOCATION_ARGUMENTS(SimpleName:xmldbUri)(QualifiedName:Lock.WRITE_LOCK)))))(IfStatement(InfixExpression(SimpleName:collection)(INFIX_EXPRESSION_OPERATOR:==)(NullLiteral))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:LOG))(SimpleName:debug)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(SimpleName:xmldbUri)(StringLiteral:<STR>)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:transact))(SimpleName:abort)(METHOD_INVOCATION_ARGUMENTS(SimpleName:txn))))(ThrowStatement(ClassInstanceCreation(SimpleType(SimpleName:CollectionDoesNotExistException))(InfixExpression(SimpleName:xmldbUri)(INFIX_EXPRESSION_OPERATOR:+)(StringLiteral:<STR>))))))(IfStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mime))(SimpleName:isXMLType))(Block(IfStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:LOG))(SimpleName:isDebugEnabled))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:LOG))(SimpleName:debug)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mime))(SimpleName:getName))(StringLiteral:<STR>))))))(VariableDeclarationStatement(SimpleType(SimpleName:VirtualTempFileInputSource))(VariableDeclarationFragment(SimpleName:vtfis)(ClassInstanceCreation(SimpleType(SimpleName:VirtualTempFileInputSource))(SimpleName:vtf))))(VariableDeclarationStatement(SimpleType(SimpleName:IndexInfo))(VariableDeclarationFragment(SimpleName:info)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:collection))(SimpleName:validateXMLResource)(METHOD_INVOCATION_ARGUMENTS(SimpleName:txn)(SimpleName:broker)(SimpleName:newNameUri)(SimpleName:vtfis)))))(VariableDeclarationStatement(SimpleType(SimpleName:DocumentImpl))(VariableDeclarationFragment(SimpleName:doc)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:info))(SimpleName:getDocument))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:doc))(SimpleName:getMetadata)))(SimpleName:setMimeType)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mime))(SimpleName:getName)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:collection))(SimpleName:store)(METHOD_INVOCATION_ARGUMENTS(SimpleName:txn)(SimpleName:broker)(SimpleName:info)(SimpleName:vtfis)(BooleanLiteral:false)))))(Block(IfStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:LOG))(SimpleName:isDebugEnabled))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:LOG))(SimpleName:debug)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mime))(SimpleName:getName))(StringLiteral:<STR>))))))(VariableDeclarationStatement(SimpleType(SimpleName:InputStream))(VariableDeclarationFragment(SimpleName:fis)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:vtf))(SimpleName:getByteStream))))(ExpressionStatement(Assignment(SimpleName:bis)(ASSIGNMENT_OPERATOR:=)(ClassInstanceCreation(SimpleType(SimpleName:BufferedInputStream))(SimpleName:fis))))(VariableDeclarationStatement(SimpleType(SimpleName:DocumentImpl))(VariableDeclarationFragment(SimpleName:doc)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:collection))(SimpleName:addBinaryResource)(METHOD_INVOCATION_ARGUMENTS(SimpleName:txn)(SimpleName:broker)(SimpleName:newNameUri)(SimpleName:bis)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mime))(SimpleName:getName))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:length))(SimpleName:longValue))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:bis))(SimpleName:close)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:transact))(SimpleName:commit)(METHOD_INVOCATION_ARGUMENTS(SimpleName:txn))))(IfStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:LOG))(SimpleName:isDebugEnabled))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:LOG))(SimpleName:debug)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:EXistException))(SimpleName:e))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:LOG))(SimpleName:error)(METHOD_INVOCATION_ARGUMENTS(SimpleName:e))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:transact))(SimpleName:abort)(METHOD_INVOCATION_ARGUMENTS(SimpleName:txn))))(ThrowStatement(ClassInstanceCreation(SimpleType(SimpleName:IOException))(SimpleName:e)))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:TriggerException))(SimpleName:e))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:LOG))(SimpleName:error)(METHOD_INVOCATION_ARGUMENTS(SimpleName:e))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:transact))(SimpleName:abort)(METHOD_INVOCATION_ARGUMENTS(SimpleName:txn))))(ThrowStatement(ClassInstanceCreation(SimpleType(SimpleName:IOException))(SimpleName:e)))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:SAXException))(SimpleName:e))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:LOG))(SimpleName:error)(METHOD_INVOCATION_ARGUMENTS(SimpleName:e))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:transact))(SimpleName:abort)(METHOD_INVOCATION_ARGUMENTS(SimpleName:txn))))(ThrowStatement(ClassInstanceCreation(SimpleType(SimpleName:IOException))(SimpleName:e)))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:LockException))(SimpleName:e))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:LOG))(SimpleName:error)(METHOD_INVOCATION_ARGUMENTS(SimpleName:e))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:transact))(SimpleName:abort)(METHOD_INVOCATION_ARGUMENTS(SimpleName:txn))))(ThrowStatement(ClassInstanceCreation(SimpleType(SimpleName:PermissionDeniedException))(InfixExpression(SimpleName:xmldbUri)(INFIX_EXPRESSION_OPERATOR:+)(StringLiteral:<STR>))))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:IOException))(SimpleName:e))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:LOG))(SimpleName:error)(METHOD_INVOCATION_ARGUMENTS(SimpleName:e))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:transact))(SimpleName:abort)(METHOD_INVOCATION_ARGUMENTS(SimpleName:txn))))(ThrowStatement(SimpleName:e))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:PermissionDeniedException))(SimpleName:e))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:LOG))(SimpleName:error)(METHOD_INVOCATION_ARGUMENTS(SimpleName:e))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:transact))(SimpleName:abort)(METHOD_INVOCATION_ARGUMENTS(SimpleName:txn))))(ThrowStatement(SimpleName:e))))(Block(IfStatement(InfixExpression(SimpleName:vtf)(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:vtf))(SimpleName:delete)))))(IfStatement(InfixExpression(SimpleName:collection)(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:collection))(SimpleName:release)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:Lock.WRITE_LOCK))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:brokerPool))(SimpleName:release)(METHOD_INVOCATION_ARGUMENTS(SimpleName:broker))))(IfStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:LOG))(SimpleName:isDebugEnabled))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:LOG))(SimpleName:debug)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))))))(VariableDeclarationStatement(SimpleType(SimpleName:XmldbURI))(VariableDeclarationFragment(SimpleName:newResource)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:xmldbUri))(SimpleName:append)(METHOD_INVOCATION_ARGUMENTS(SimpleName:newName)))))(ReturnStatement(SimpleName:newResource))))))