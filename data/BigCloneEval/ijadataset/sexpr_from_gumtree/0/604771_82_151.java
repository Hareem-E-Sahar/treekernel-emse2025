(CompilationUnit(TypeDeclaration(Modifier:public)(TYPE_DECLARATION_KIND:class)(SimpleName:Test)(MethodDeclaration(Modifier:public)(PrimitiveType:void)(SimpleName:addImageHistoryTag)(SingleVariableDeclaration(SimpleType(SimpleName:File))(SimpleName:file))(Block(VariableDeclarationStatement(SimpleType(SimpleName:File))(VariableDeclarationFragment(SimpleName:dst)(NullLiteral)))(VariableDeclarationStatement(SimpleType(SimpleName:IImageMetadata))(VariableDeclarationFragment(SimpleName:metadata)(NullLiteral)))(VariableDeclarationStatement(SimpleType(SimpleName:JpegImageMetadata))(VariableDeclarationFragment(SimpleName:jpegMetadata)(NullLiteral)))(VariableDeclarationStatement(SimpleType(SimpleName:TiffImageMetadata))(VariableDeclarationFragment(SimpleName:exif)(NullLiteral)))(VariableDeclarationStatement(SimpleType(SimpleName:OutputStream))(VariableDeclarationFragment(SimpleName:os)(NullLiteral)))(VariableDeclarationStatement(SimpleType(SimpleName:TiffOutputSet))(VariableDeclarationFragment(SimpleName:outputSet)(ClassInstanceCreation(SimpleType(SimpleName:TiffOutputSet)))))(TryStatement(Block(ExpressionStatement(Assignment(SimpleName:metadata)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:Sanselan))(SimpleName:getMetadata)(METHOD_INVOCATION_ARGUMENTS(SimpleName:file))))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:ImageReadException))(SimpleName:e))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:e))(SimpleName:printStackTrace)))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:IOException))(SimpleName:e))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:e))(SimpleName:printStackTrace))))))(IfStatement(InfixExpression(SimpleName:metadata)(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(Block(ExpressionStatement(Assignment(SimpleName:jpegMetadata)(ASSIGNMENT_OPERATOR:=)(CastExpression(SimpleType(SimpleName:JpegImageMetadata))(SimpleName:metadata))))))(IfStatement(InfixExpression(SimpleName:jpegMetadata)(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(Block(ExpressionStatement(Assignment(SimpleName:exif)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:jpegMetadata))(SimpleName:getExif))))))(IfStatement(InfixExpression(SimpleName:exif)(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(Block(TryStatement(Block(ExpressionStatement(Assignment(SimpleName:outputSet)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:exif))(SimpleName:getOutputSet)))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:ImageWriteException))(SimpleName:e))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:e))(SimpleName:printStackTrace))))))))(IfStatement(InfixExpression(SimpleName:outputSet)(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(Block(VariableDeclarationStatement(SimpleType(SimpleName:TiffOutputField))(VariableDeclarationFragment(SimpleName:imageHistoryPre)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:outputSet))(SimpleName:findField)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:TiffConstants.EXIF_TAG_IMAGE_HISTORY)))))(IfStatement(InfixExpression(SimpleName:imageHistoryPre)(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:outputSet))(SimpleName:removeField)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:TiffConstants.EXIF_TAG_IMAGE_HISTORY))))))(TryStatement(Block(VariableDeclarationStatement(SimpleType(SimpleName:String))(VariableDeclarationFragment(SimpleName:fieldData)(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:System))(SimpleName:currentTimeMillis)))))(VariableDeclarationStatement(SimpleType(SimpleName:TiffOutputField))(VariableDeclarationFragment(SimpleName:imageHistory)(ClassInstanceCreation(SimpleType(SimpleName:TiffOutputField))(QualifiedName:ExifTagConstants.EXIF_TAG_IMAGE_HISTORY)(QualifiedName:TiffFieldTypeConstants.FIELD_TYPE_ASCII)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:fieldData))(SimpleName:length))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:fieldData))(SimpleName:getBytes)))))(VariableDeclarationStatement(SimpleType(SimpleName:TiffOutputDirectory))(VariableDeclarationFragment(SimpleName:exifDirectory)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:outputSet))(SimpleName:getOrCreateExifDirectory))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:exifDirectory))(SimpleName:add)(METHOD_INVOCATION_ARGUMENTS(SimpleName:imageHistory)))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:ImageWriteException))(SimpleName:e))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:e))(SimpleName:printStackTrace))))))))(TryStatement(Block(ExpressionStatement(Assignment(SimpleName:dst)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:File))(SimpleName:createTempFile)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:System))(SimpleName:currentTimeMillis)))(StringLiteral:<STR>)))))(ExpressionStatement(Assignment(SimpleName:os)(ASSIGNMENT_OPERATOR:=)(ClassInstanceCreation(SimpleType(SimpleName:FileOutputStream))(SimpleName:dst))))(ExpressionStatement(Assignment(SimpleName:os)(ASSIGNMENT_OPERATOR:=)(ClassInstanceCreation(SimpleType(SimpleName:BufferedOutputStream))(SimpleName:os)))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:IOException))(SimpleName:e))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:e))(SimpleName:printStackTrace))))))(TryStatement(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(ClassInstanceCreation(SimpleType(SimpleName:ExifRewriter))))(SimpleName:updateExifMetadataLossless)(METHOD_INVOCATION_ARGUMENTS(SimpleName:file)(SimpleName:os)(SimpleName:outputSet)))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:ImageReadException))(SimpleName:e))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:e))(SimpleName:printStackTrace)))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:ImageWriteException))(SimpleName:e))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:e))(SimpleName:printStackTrace)))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:IOException))(SimpleName:e))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:e))(SimpleName:printStackTrace)))))(Block(IfStatement(InfixExpression(SimpleName:os)(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(Block(TryStatement(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:os))(SimpleName:close))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:IOException))(SimpleName:e))(Block)))))))(TryStatement(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:FileUtils))(SimpleName:copyFile)(METHOD_INVOCATION_ARGUMENTS(SimpleName:dst)(SimpleName:file)))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:IOException))(SimpleName:e))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:e))(SimpleName:printStackTrace))))))))))