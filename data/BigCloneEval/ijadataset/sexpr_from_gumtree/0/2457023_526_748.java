(CompilationUnit(TypeDeclaration(Modifier:public)(TYPE_DECLARATION_KIND:class)(SimpleName:Test)(MethodDeclaration(SingleMemberAnnotation(SimpleName:SuppressWarnings)(StringLiteral:<STR>))(Modifier:public)(PrimitiveType:void)(SimpleName:methodPut)(SingleVariableDeclaration(SimpleType(SimpleName:HttpServletRequest))(SimpleName:req))(SingleVariableDeclaration(SimpleType(SimpleName:HttpServletResponse))(SimpleName:resp))(SimpleType(SimpleName:ServletException))(SimpleType(SimpleName:IOException))(Block(VariableDeclarationStatement(SimpleType(SimpleName:OutputStream))(VariableDeclarationFragment(SimpleName:out)(NullLiteral)))(TryStatement(Block(VariableDeclarationStatement(SimpleType(SimpleName:S3ObjectRequest))(VariableDeclarationFragment(SimpleName:or)))(TryStatement(Block(ExpressionStatement(Assignment(SimpleName:or)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:S3ObjectRequest))(SimpleName:create)(METHOD_INVOCATION_ARGUMENTS(SimpleName:req)(MethodInvocation(SimpleName:resolvedHost))(CastExpression(SimpleType(SimpleName:Authenticator))(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(SimpleName:getWebApplicationContext)))(SimpleName:getBean)(METHOD_INVOCATION_ARGUMENTS(SimpleName:BEAN_AUTHENTICATOR)))))))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:InvalidAccessKeyIdException))(SimpleName:e))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:e))(SimpleName:printStackTrace)))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:resp))(SimpleName:sendError)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:HttpServletResponse.SC_FORBIDDEN)(StringLiteral:<STR>))))(ReturnStatement)))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:InvalidSecurityException))(SimpleName:e))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:e))(SimpleName:printStackTrace)))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:resp))(SimpleName:sendError)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:HttpServletResponse.SC_FORBIDDEN)(StringLiteral:<STR>))))(ReturnStatement)))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:RequestTimeTooSkewedException))(SimpleName:e))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:e))(SimpleName:printStackTrace)))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:resp))(SimpleName:sendError)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:HttpServletResponse.SC_FORBIDDEN)(StringLiteral:<STR>))))(ReturnStatement)))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:SignatureDoesNotMatchException))(SimpleName:e))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:e))(SimpleName:printStackTrace)))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:resp))(SimpleName:sendError)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:HttpServletResponse.SC_FORBIDDEN)(StringLiteral:<STR>))))(ReturnStatement)))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:AuthenticatorException))(SimpleName:e))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:e))(SimpleName:printStackTrace)))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:resp))(SimpleName:sendError)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:HttpServletResponse.SC_FORBIDDEN)(StringLiteral:<STR>))))(ReturnStatement))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:logger))(SimpleName:debug)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(SimpleName:or)))))(VariableDeclarationStatement(SimpleType(SimpleName:CanonicalUser))(VariableDeclarationFragment(SimpleName:requestor)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:or))(SimpleName:getRequestor))))(IfStatement(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:or))(SimpleName:getKey))(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(Block(VariableDeclarationStatement(SimpleType(SimpleName:String))(VariableDeclarationFragment(SimpleName:value)))(VariableDeclarationStatement(PrimitiveType:long)(VariableDeclarationFragment(SimpleName:contentLength)))(VariableDeclarationStatement(SimpleType(SimpleName:MessageDigest))(VariableDeclarationFragment(SimpleName:messageDigest)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:MessageDigest))(SimpleName:getInstance)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))))(VariableDeclarationStatement(SimpleType(SimpleName:DigestOutputStream))(VariableDeclarationFragment(SimpleName:digestOutputStream)(NullLiteral)))(VariableDeclarationStatement(SimpleType(SimpleName:S3Object))(VariableDeclarationFragment(SimpleName:oldS3Object)(NullLiteral)))(VariableDeclarationStatement(SimpleType(SimpleName:S3Object))(VariableDeclarationFragment(SimpleName:s3Object)))(VariableDeclarationStatement(SimpleType(SimpleName:StorageService))(VariableDeclarationFragment(SimpleName:storageService)))(VariableDeclarationStatement(SimpleType(SimpleName:Bucket))(VariableDeclarationFragment(SimpleName:bucket)))(VariableDeclarationStatement(SimpleType(SimpleName:String))(VariableDeclarationFragment(SimpleName:bucketName)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:or))(SimpleName:getBucket))))(VariableDeclarationStatement(SimpleType(SimpleName:String))(VariableDeclarationFragment(SimpleName:key)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:or))(SimpleName:getKey))))(IfStatement(PrefixExpression(PREFIX_EXPRESSION_OPERATOR:!)(MethodInvocation(SimpleName:isValidKey)(METHOD_INVOCATION_ARGUMENTS(SimpleName:key))))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:resp))(SimpleName:sendError)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:HttpServletResponse.SC_BAD_REQUEST)(StringLiteral:<STR>))))(ReturnStatement)))(ExpressionStatement(Assignment(SimpleName:storageService)(ASSIGNMENT_OPERATOR:=)(CastExpression(SimpleType(SimpleName:StorageService))(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(SimpleName:getWebApplicationContext)))(SimpleName:getBean)(METHOD_INVOCATION_ARGUMENTS(SimpleName:BEAN_STORAGE_SERVICE))))))(IfStatement(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:req))(SimpleName:getParameter)(METHOD_INVOCATION_ARGUMENTS(SimpleName:PARAMETER_ACL)))(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(Block(VariableDeclarationStatement(SimpleType(SimpleName:Acp))(VariableDeclarationFragment(SimpleName:acp)))(VariableDeclarationStatement(SimpleType(SimpleName:CanonicalUser))(VariableDeclarationFragment(SimpleName:owner)))(ExpressionStatement(Assignment(SimpleName:s3Object)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:storageService))(SimpleName:load)(METHOD_INVOCATION_ARGUMENTS(SimpleName:bucketName)(SimpleName:key)))))(IfStatement(InfixExpression(SimpleName:s3Object)(INFIX_EXPRESSION_OPERATOR:==)(NullLiteral))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:resp))(SimpleName:sendError)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:HttpServletResponse.SC_NOT_FOUND)(StringLiteral:<STR>))))(ReturnStatement)))(ExpressionStatement(Assignment(SimpleName:acp)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:s3Object))(SimpleName:getAcp))))(TryStatement(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:acp))(SimpleName:canWrite)(METHOD_INVOCATION_ARGUMENTS(SimpleName:requestor)))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:AccessControlException))(SimpleName:e))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:resp))(SimpleName:sendError)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:HttpServletResponse.SC_FORBIDDEN)(StringLiteral:<STR>))))(ReturnStatement))))(ExpressionStatement(Assignment(SimpleName:owner)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:acp))(SimpleName:getOwner))))(TryStatement(Block(ExpressionStatement(Assignment(SimpleName:acp)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:Acp))(SimpleName:decode)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:req))(SimpleName:getInputStream)))))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:IOException))(SimpleName:e))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:e))(SimpleName:printStackTrace)))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:resp))(SimpleName:sendError)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:HttpServletResponse.SC_BAD_REQUEST)(StringLiteral:<STR>))))(ReturnStatement))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:acp))(SimpleName:setOwner)(METHOD_INVOCATION_ARGUMENTS(SimpleName:owner))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:s3Object))(SimpleName:setAcp)(METHOD_INVOCATION_ARGUMENTS(SimpleName:acp))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:storageService))(SimpleName:store)(METHOD_INVOCATION_ARGUMENTS(SimpleName:s3Object)))))(Block(TryStatement(Block(ExpressionStatement(Assignment(SimpleName:bucket)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:storageService))(SimpleName:loadBucket)(METHOD_INVOCATION_ARGUMENTS(SimpleName:bucketName)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:bucket))(SimpleName:canWrite)(METHOD_INVOCATION_ARGUMENTS(SimpleName:requestor)))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:AccessControlException))(SimpleName:e))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:resp))(SimpleName:sendError)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:HttpServletResponse.SC_FORBIDDEN)(StringLiteral:<STR>))))(ReturnStatement)))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:DataAccessException))(SimpleName:e))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:resp))(SimpleName:sendError)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:HttpServletResponse.SC_NOT_FOUND)(StringLiteral:<STR>))))(ReturnStatement))))(TryStatement(Block(ExpressionStatement(Assignment(SimpleName:oldS3Object)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:storageService))(SimpleName:load)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:bucket))(SimpleName:getName))(SimpleName:key))))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:DataRetrievalFailureException))(SimpleName:e))(Block)))(TryStatement(Block(ExpressionStatement(Assignment(SimpleName:s3Object)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:storageService))(SimpleName:createS3Object)(METHOD_INVOCATION_ARGUMENTS(SimpleName:bucket)(SimpleName:key)(SimpleName:requestor))))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:DataAccessException))(SimpleName:e))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:resp))(SimpleName:sendError)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:HttpServletResponse.SC_NOT_FOUND)(StringLiteral:<STR>))))(ReturnStatement))))(ExpressionStatement(Assignment(SimpleName:out)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:s3Object))(SimpleName:getOutputStream))))(ExpressionStatement(Assignment(SimpleName:digestOutputStream)(ASSIGNMENT_OPERATOR:=)(ClassInstanceCreation(SimpleType(SimpleName:DigestOutputStream))(SimpleName:out)(SimpleName:messageDigest))))(ExpressionStatement(Assignment(SimpleName:value)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:req))(SimpleName:getHeader)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))))(IfStatement(InfixExpression(SimpleName:value)(INFIX_EXPRESSION_OPERATOR:==)(NullLiteral))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:resp))(SimpleName:sendError)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:HttpServletResponse.SC_LENGTH_REQUIRED)(StringLiteral:<STR>))))(ReturnStatement)))(ExpressionStatement(Assignment(SimpleName:contentLength)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:Long))(SimpleName:valueOf)(METHOD_INVOCATION_ARGUMENTS(SimpleName:value))))(SimpleName:longValue))))(IfStatement(InfixExpression(SimpleName:contentLength)(INFIX_EXPRESSION_OPERATOR:>)(NumberLiteral:5368709120L))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:resp))(SimpleName:sendError)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:HttpServletResponse.SC_BAD_REQUEST)(StringLiteral:<STR>))))(ReturnStatement)))(VariableDeclarationStatement(PrimitiveType:long)(VariableDeclarationFragment(SimpleName:written)(NumberLiteral:0)))(VariableDeclarationStatement(PrimitiveType:int)(VariableDeclarationFragment(SimpleName:count)))(VariableDeclarationStatement(ArrayType(PrimitiveType:byte)(Dimension))(VariableDeclarationFragment(SimpleName:b)(ArrayCreation(ArrayType(PrimitiveType:byte)(Dimension(NumberLiteral:4096))))))(VariableDeclarationStatement(SimpleType(SimpleName:ServletInputStream))(VariableDeclarationFragment(SimpleName:in)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:req))(SimpleName:getInputStream))))(WhileStatement(InfixExpression(ParenthesizedExpression(InfixExpression(ParenthesizedExpression(Assignment(SimpleName:count)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:in))(SimpleName:read)(METHOD_INVOCATION_ARGUMENTS(SimpleName:b)(NumberLiteral:0)(QualifiedName:b.length)))))(INFIX_EXPRESSION_OPERATOR:>)(NumberLiteral:0)))(INFIX_EXPRESSION_OPERATOR:&&)(ParenthesizedExpression(InfixExpression(SimpleName:written)(INFIX_EXPRESSION_OPERATOR:<)(SimpleName:contentLength))))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:digestOutputStream))(SimpleName:write)(METHOD_INVOCATION_ARGUMENTS(SimpleName:b)(NumberLiteral:0)(SimpleName:count))))(ExpressionStatement(Assignment(SimpleName:written)(ASSIGNMENT_OPERATOR:+=)(SimpleName:count)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:digestOutputStream))(SimpleName:flush)))(IfStatement(InfixExpression(SimpleName:written)(INFIX_EXPRESSION_OPERATOR:!=)(SimpleName:contentLength))(Block(IfStatement(InfixExpression(SimpleName:out)(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:out))(SimpleName:close)))(ExpressionStatement(Assignment(SimpleName:out)(ASSIGNMENT_OPERATOR:=)(NullLiteral)))))(IfStatement(InfixExpression(SimpleName:digestOutputStream)(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:digestOutputStream))(SimpleName:close)))(ExpressionStatement(Assignment(SimpleName:digestOutputStream)(ASSIGNMENT_OPERATOR:=)(NullLiteral)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:storageService))(SimpleName:remove)(METHOD_INVOCATION_ARGUMENTS(SimpleName:s3Object))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:resp))(SimpleName:sendError)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:HttpServletResponse.SC_BAD_REQUEST)(StringLiteral:<STR>))))(ReturnStatement)))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:s3Object))(SimpleName:setContentDisposition)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:req))(SimpleName:getHeader)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:s3Object))(SimpleName:setContentLength)(METHOD_INVOCATION_ARGUMENTS(SimpleName:contentLength))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:s3Object))(SimpleName:setContentMD5)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:req))(SimpleName:getHeader)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))))(ExpressionStatement(Assignment(SimpleName:value)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:req))(SimpleName:getContentType))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:logger))(SimpleName:debug)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(SimpleName:value)))))(IfStatement(InfixExpression(SimpleName:value)(INFIX_EXPRESSION_OPERATOR:==)(NullLiteral))(Block(ExpressionStatement(Assignment(SimpleName:value)(ASSIGNMENT_OPERATOR:=)(QualifiedName:S3Object.DEFAULT_CONTENT_TYPE)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:s3Object))(SimpleName:setContentType)(METHOD_INVOCATION_ARGUMENTS(SimpleName:value))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:logger))(SimpleName:debug)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:s3Object))(SimpleName:getContentType))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:s3Object))(SimpleName:setLastModified)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:System))(SimpleName:currentTimeMillis)))))(VariableDeclarationStatement(PrimitiveType:int)(VariableDeclarationFragment(SimpleName:prefixLength)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:HEADER_PREFIX_USER_META))(SimpleName:length))))(VariableDeclarationStatement(SimpleType(SimpleName:String))(VariableDeclarationFragment(SimpleName:name)))(ForStatement(VariableDeclarationExpression(SimpleType(SimpleName:Enumeration))(VariableDeclarationFragment(SimpleName:headerNames)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:req))(SimpleName:getHeaderNames))))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:headerNames))(SimpleName:hasMoreElements))(Block(VariableDeclarationStatement(SimpleType(SimpleName:String))(VariableDeclarationFragment(SimpleName:headerName)(CastExpression(SimpleType(SimpleName:String))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:headerNames))(SimpleName:nextElement)))))(IfStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:headerName))(SimpleName:startsWith)(METHOD_INVOCATION_ARGUMENTS(SimpleName:HEADER_PREFIX_USER_META)))(Block(ExpressionStatement(Assignment(SimpleName:name)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:headerName))(SimpleName:substring)(METHOD_INVOCATION_ARGUMENTS(SimpleName:prefixLength))))(SimpleName:toLowerCase))))(ForStatement(VariableDeclarationExpression(SimpleType(SimpleName:Enumeration))(VariableDeclarationFragment(SimpleName:headers)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:req))(SimpleName:getHeaders)(METHOD_INVOCATION_ARGUMENTS(SimpleName:headerName)))))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:headers))(SimpleName:hasMoreElements))(Block(ExpressionStatement(Assignment(SimpleName:value)(ASSIGNMENT_OPERATOR:=)(CastExpression(SimpleType(SimpleName:String))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:headers))(SimpleName:nextElement)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:s3Object))(SimpleName:addMetadata)(METHOD_INVOCATION_ARGUMENTS(SimpleName:name)(SimpleName:value))))))))))(ExpressionStatement(Assignment(SimpleName:value)(ASSIGNMENT_OPERATOR:=)(ClassInstanceCreation(SimpleType(SimpleName:String))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:Hex))(SimpleName:encodeHex)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:digestOutputStream))(SimpleName:getMessageDigest)))(SimpleName:digest)))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:resp))(SimpleName:setHeader)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)(SimpleName:value))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:s3Object))(SimpleName:setETag)(METHOD_INVOCATION_ARGUMENTS(SimpleName:value))))(ExpressionStatement(MethodInvocation(SimpleName:grantCannedAccessPolicies)(METHOD_INVOCATION_ARGUMENTS(SimpleName:req)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:s3Object))(SimpleName:getAcp))(SimpleName:requestor))))(IfStatement(InfixExpression(SimpleName:oldS3Object)(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:storageService))(SimpleName:remove)(METHOD_INVOCATION_ARGUMENTS(SimpleName:oldS3Object))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:storageService))(SimpleName:store)(METHOD_INVOCATION_ARGUMENTS(SimpleName:s3Object)))))))(IfStatement(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:or))(SimpleName:getBucket))(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(Block(VariableDeclarationStatement(SimpleType(SimpleName:StorageService))(VariableDeclarationFragment(SimpleName:storageService)))(VariableDeclarationStatement(SimpleType(SimpleName:Bucket))(VariableDeclarationFragment(SimpleName:bucket)))(ExpressionStatement(Assignment(SimpleName:storageService)(ASSIGNMENT_OPERATOR:=)(CastExpression(SimpleType(SimpleName:StorageService))(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(SimpleName:getWebApplicationContext)))(SimpleName:getBean)(METHOD_INVOCATION_ARGUMENTS(SimpleName:BEAN_STORAGE_SERVICE))))))(IfStatement(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:req))(SimpleName:getParameter)(METHOD_INVOCATION_ARGUMENTS(SimpleName:PARAMETER_ACL)))(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(Block(VariableDeclarationStatement(SimpleType(SimpleName:Acp))(VariableDeclarationFragment(SimpleName:acp)))(VariableDeclarationStatement(SimpleType(SimpleName:CanonicalUser))(VariableDeclarationFragment(SimpleName:owner)))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:logger))(SimpleName:debug)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:or))(SimpleName:getBucket))))))(TryStatement(Block(ExpressionStatement(Assignment(SimpleName:bucket)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:storageService))(SimpleName:loadBucket)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:or))(SimpleName:getBucket)))))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:DataAccessException))(SimpleName:e))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:resp))(SimpleName:sendError)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:HttpServletResponse.SC_NOT_FOUND)(StringLiteral:<STR>))))(ReturnStatement))))(ExpressionStatement(Assignment(SimpleName:acp)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:bucket))(SimpleName:getAcp))))(TryStatement(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:acp))(SimpleName:canWrite)(METHOD_INVOCATION_ARGUMENTS(SimpleName:requestor)))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:AccessControlException))(SimpleName:e))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:resp))(SimpleName:sendError)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:HttpServletResponse.SC_FORBIDDEN)(StringLiteral:<STR>))))(ReturnStatement))))(ExpressionStatement(Assignment(SimpleName:owner)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:acp))(SimpleName:getOwner))))(TryStatement(Block(ExpressionStatement(Assignment(SimpleName:acp)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:Acp))(SimpleName:decode)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:req))(SimpleName:getInputStream)))))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:IOException))(SimpleName:e))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:e))(SimpleName:printStackTrace)))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:resp))(SimpleName:sendError)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:HttpServletResponse.SC_BAD_REQUEST)(StringLiteral:<STR>))))(ReturnStatement))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:acp))(SimpleName:setOwner)(METHOD_INVOCATION_ARGUMENTS(SimpleName:owner))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:bucket))(SimpleName:setAcp)(METHOD_INVOCATION_ARGUMENTS(SimpleName:acp))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:logger))(SimpleName:debug)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:logger))(SimpleName:debug)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:Acp))(SimpleName:encode)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:bucket))(SimpleName:getAcp))))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:storageService))(SimpleName:storeBucket)(METHOD_INVOCATION_ARGUMENTS(SimpleName:bucket)))))(Block(VariableDeclarationStatement(SimpleType(SimpleName:String))(VariableDeclarationFragment(SimpleName:bucketName)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:or))(SimpleName:getBucket))))(IfStatement(PrefixExpression(PREFIX_EXPRESSION_OPERATOR:!)(MethodInvocation(SimpleName:isValidBucketName)(METHOD_INVOCATION_ARGUMENTS(SimpleName:bucketName))))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:resp))(SimpleName:sendError)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:HttpServletResponse.SC_BAD_REQUEST)(StringLiteral:<STR>))))(ReturnStatement)))(TryStatement(Block(ExpressionStatement(Assignment(SimpleName:bucket)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:storageService))(SimpleName:createBucket)(METHOD_INVOCATION_ARGUMENTS(SimpleName:bucketName)(SimpleName:requestor))))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:BucketAlreadyExistsException))(SimpleName:e))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:resp))(SimpleName:sendError)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:HttpServletResponse.SC_CONFLICT)(StringLiteral:<STR>))))(ReturnStatement))))(ExpressionStatement(MethodInvocation(SimpleName:grantCannedAccessPolicies)(METHOD_INVOCATION_ARGUMENTS(SimpleName:req)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:bucket))(SimpleName:getAcp))(SimpleName:requestor))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:storageService))(SimpleName:storeBucket)(METHOD_INVOCATION_ARGUMENTS(SimpleName:bucket))))))))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:NoSuchAlgorithmException))(SimpleName:e))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:e))(SimpleName:printStackTrace)))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:logger))(SimpleName:error)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)(SimpleName:e))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:resp))(SimpleName:sendError)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:HttpServletResponse.SC_INTERNAL_SERVER_ERROR)(StringLiteral:<STR>))))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:IOException))(SimpleName:e))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:e))(SimpleName:printStackTrace)))(ThrowStatement(SimpleName:e))))(Block(IfStatement(InfixExpression(SimpleName:out)(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:out))(SimpleName:close)))(ExpressionStatement(Assignment(SimpleName:out)(ASSIGNMENT_OPERATOR:=)(NullLiteral)))))))))))