(CompilationUnit(TypeDeclaration(Modifier:public)(TYPE_DECLARATION_KIND:class)(SimpleName:Test)(MethodDeclaration(Modifier:public)(PrimitiveType:void)(SimpleName:start)(SingleVariableDeclaration(SimpleType(SimpleName:PipelineContext))(SimpleName:pipelineContext))(Block(VariableDeclarationStatement(SimpleType(SimpleName:ExternalContext))(VariableDeclarationFragment(SimpleName:externalContext)(CastExpression(SimpleType(SimpleName:ExternalContext))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:pipelineContext))(SimpleName:getAttribute)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:org.orbeon.oxf.pipeline.api.PipelineContext.EXTERNAL_CONTEXT))))))(VariableDeclarationStatement(SimpleType(QualifiedName:ExternalContext.Response))(VariableDeclarationFragment(SimpleName:response)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:externalContext))(SimpleName:getResponse))))(TryStatement(Block(VariableDeclarationStatement(SimpleType(SimpleName:Node))(VariableDeclarationFragment(SimpleName:config)(MethodInvocation(SimpleName:readCacheInputAsDOM4J)(METHOD_INVOCATION_ARGUMENTS(SimpleName:pipelineContext)(SimpleName:INPUT_CONFIG)))))(VariableDeclarationStatement(SimpleType(SimpleName:String))(VariableDeclarationFragment(SimpleName:imageDirectoryString)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:XPathUtils))(SimpleName:selectStringValueNormalize)(METHOD_INVOCATION_ARGUMENTS(SimpleName:config)(StringLiteral:<STR>)))))(ExpressionStatement(Assignment(SimpleName:imageDirectoryString)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:imageDirectoryString))(SimpleName:replace)(METHOD_INVOCATION_ARGUMENTS(CharacterLiteral:<STR>)(CharacterLiteral:<STR>)))))(IfStatement(PrefixExpression(PREFIX_EXPRESSION_OPERATOR:!)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:imageDirectoryString))(SimpleName:endsWith)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))(ExpressionStatement(Assignment(SimpleName:imageDirectoryString)(ASSIGNMENT_OPERATOR:=)(InfixExpression(SimpleName:imageDirectoryString)(INFIX_EXPRESSION_OPERATOR:+)(CharacterLiteral:<STR>)))))(VariableDeclarationStatement(SimpleType(SimpleName:URL))(VariableDeclarationFragment(SimpleName:imageDirectoryURL)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:URLFactory))(SimpleName:createURL)(METHOD_INVOCATION_ARGUMENTS(SimpleName:imageDirectoryString)))))(VariableDeclarationStatement(SimpleType(SimpleName:String))(VariableDeclarationFragment(SimpleName:cacheDirectoryString)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:XPathUtils))(SimpleName:selectStringValueNormalize)(METHOD_INVOCATION_ARGUMENTS(SimpleName:config)(StringLiteral:<STR>)))))(VariableDeclarationStatement(SimpleType(SimpleName:File))(VariableDeclarationFragment(SimpleName:cacheDir)(ConditionalExpression(ParenthesizedExpression(InfixExpression(SimpleName:cacheDirectoryString)(INFIX_EXPRESSION_OPERATOR:==)(NullLiteral)))(NullLiteral)(ClassInstanceCreation(SimpleType(SimpleName:File))(SimpleName:cacheDirectoryString)))))(IfStatement(InfixExpression(InfixExpression(SimpleName:cacheDir)(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(INFIX_EXPRESSION_OPERATOR:&&)(PrefixExpression(PREFIX_EXPRESSION_OPERATOR:!)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:cacheDir))(SimpleName:isDirectory))))(ThrowStatement(ClassInstanceCreation(SimpleType(SimpleName:IllegalArgumentException))(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(SimpleName:cacheDirectoryString)))))(VariableDeclarationStatement(PrimitiveType:float)(VariableDeclarationFragment(SimpleName:defaultQuality)(MethodInvocation(SimpleName:selectFloatValue)(METHOD_INVOCATION_ARGUMENTS(SimpleName:config)(StringLiteral:<STR>)(SimpleName:DEFAULT_QUALITY)))))(IfStatement(InfixExpression(InfixExpression(SimpleName:defaultQuality)(INFIX_EXPRESSION_OPERATOR:<)(NumberLiteral:0.0f))(INFIX_EXPRESSION_OPERATOR:||)(InfixExpression(SimpleName:defaultQuality)(INFIX_EXPRESSION_OPERATOR:>)(NumberLiteral:1.0f)))(ThrowStatement(ClassInstanceCreation(SimpleType(SimpleName:IllegalArgumentException))(StringLiteral:<STR>))))(VariableDeclarationStatement(PrimitiveType:boolean)(VariableDeclarationFragment(SimpleName:useSandbox)(MethodInvocation(SimpleName:selectBooleanValue)(METHOD_INVOCATION_ARGUMENTS(SimpleName:config)(StringLiteral:<STR>)(SimpleName:DEFAULT_USE_SANDBOX)))))(VariableDeclarationStatement(SimpleType(SimpleName:String))(VariableDeclarationFragment(SimpleName:cachePathEncoding)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:XPathUtils))(SimpleName:selectStringValueNormalize)(METHOD_INVOCATION_ARGUMENTS(SimpleName:config)(StringLiteral:<STR>)))))(VariableDeclarationStatement(SimpleType(SimpleName:Node))(VariableDeclarationFragment(SimpleName:imageConfig)(MethodInvocation(SimpleName:readCacheInputAsDOM4J)(METHOD_INVOCATION_ARGUMENTS(SimpleName:pipelineContext)(SimpleName:INPUT_IMAGE)))))(VariableDeclarationStatement(SimpleType(SimpleName:String))(VariableDeclarationFragment(SimpleName:urlString)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:XPathUtils))(SimpleName:selectStringValueNormalize)(METHOD_INVOCATION_ARGUMENTS(SimpleName:imageConfig)(StringLiteral:<STR>)))))(IfStatement(InfixExpression(SimpleName:urlString)(INFIX_EXPRESSION_OPERATOR:==)(NullLiteral))(Block(ExpressionStatement(Assignment(SimpleName:urlString)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:XPathUtils))(SimpleName:selectStringValueNormalize)(METHOD_INVOCATION_ARGUMENTS(SimpleName:imageConfig)(StringLiteral:<STR>)))))))(VariableDeclarationStatement(PrimitiveType:float)(VariableDeclarationFragment(SimpleName:quality)(MethodInvocation(SimpleName:selectFloatValue)(METHOD_INVOCATION_ARGUMENTS(SimpleName:imageConfig)(StringLiteral:<STR>)(SimpleName:defaultQuality)))))(VariableDeclarationStatement(PrimitiveType:boolean)(VariableDeclarationFragment(SimpleName:useCache)(InfixExpression(InfixExpression(SimpleName:cacheDir)(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(INFIX_EXPRESSION_OPERATOR:&&)(MethodInvocation(SimpleName:selectBooleanValue)(METHOD_INVOCATION_ARGUMENTS(SimpleName:imageConfig)(StringLiteral:<STR>)(SimpleName:DEFAULT_USE_CACHE))))))(VariableDeclarationStatement(PrimitiveType:int)(VariableDeclarationFragment(SimpleName:transformCount)(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:XPathUtils))(SimpleName:selectIntegerValue)(METHOD_INVOCATION_ARGUMENTS(SimpleName:imageConfig)(StringLiteral:<STR>))))(SimpleName:intValue))))(VariableDeclarationStatement(SimpleType(SimpleName:Object))(VariableDeclarationFragment(SimpleName:transforms)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:XPathUtils))(SimpleName:selectObjectValue)(METHOD_INVOCATION_ARGUMENTS(SimpleName:imageConfig)(StringLiteral:<STR>)))))(IfStatement(InfixExpression(InfixExpression(SimpleName:transforms)(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(INFIX_EXPRESSION_OPERATOR:&&)(InstanceofExpression(SimpleName:transforms)(SimpleType(SimpleName:Node))))(ExpressionStatement(Assignment(SimpleName:transforms)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:Collections))(SimpleName:singletonList)(METHOD_INVOCATION_ARGUMENTS(SimpleName:transforms))))))(VariableDeclarationStatement(SimpleType(SimpleName:Iterator))(VariableDeclarationFragment(SimpleName:transformIterator)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:XPathUtils))(SimpleName:selectIterator)(METHOD_INVOCATION_ARGUMENTS(SimpleName:imageConfig)(StringLiteral:<STR>)))))(VariableDeclarationStatement(SimpleType(SimpleName:URLConnection))(VariableDeclarationFragment(SimpleName:urlConnection)(NullLiteral)))(VariableDeclarationStatement(SimpleType(SimpleName:InputStream))(VariableDeclarationFragment(SimpleName:urlConnectionInputStream)(NullLiteral)))(TryStatement(Block(VariableDeclarationStatement(SimpleType(SimpleName:URL))(VariableDeclarationFragment(SimpleName:newURL)(NullLiteral)))(TryStatement(Block(ExpressionStatement(Assignment(SimpleName:newURL)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:URLFactory))(SimpleName:createURL)(METHOD_INVOCATION_ARGUMENTS(SimpleName:imageDirectoryURL)(SimpleName:urlString)))))(VariableDeclarationStatement(PrimitiveType:boolean)(VariableDeclarationFragment(SimpleName:relative)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:NetUtils))(SimpleName:relativeURL)(METHOD_INVOCATION_ARGUMENTS(SimpleName:imageDirectoryURL)(SimpleName:newURL)))))(IfStatement(InfixExpression(SimpleName:useSandbox)(INFIX_EXPRESSION_OPERATOR:&&)(PrefixExpression(PREFIX_EXPRESSION_OPERATOR:!)(SimpleName:relative)))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:response))(SimpleName:setStatus)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:ExternalContext.SC_NOT_FOUND))))(ReturnStatement)))(ExpressionStatement(Assignment(SimpleName:urlConnection)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:newURL))(SimpleName:openConnection))))(ExpressionStatement(Assignment(SimpleName:urlConnectionInputStream)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:urlConnection))(SimpleName:getInputStream))))(IfStatement(PrefixExpression(PREFIX_EXPRESSION_OPERATOR:!)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:urlConnectionInputStream))(SimpleName:markSupported)))(ExpressionStatement(Assignment(SimpleName:urlConnectionInputStream)(ASSIGNMENT_OPERATOR:=)(ClassInstanceCreation(SimpleType(SimpleName:BufferedInputStream))(SimpleName:urlConnectionInputStream)))))(VariableDeclarationStatement(SimpleType(SimpleName:String))(VariableDeclarationFragment(SimpleName:contentType)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:URLConnection))(SimpleName:guessContentTypeFromStream)(METHOD_INVOCATION_ARGUMENTS(SimpleName:urlConnectionInputStream)))))(IfStatement(PrefixExpression(PREFIX_EXPRESSION_OPERATOR:!)(MethodInvocation(METHOD_INVOCATION_RECEIVER(StringLiteral:<STR>))(SimpleName:equals)(METHOD_INVOCATION_ARGUMENTS(SimpleName:contentType))))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:response))(SimpleName:setStatus)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:ExternalContext.SC_NOT_FOUND))))(ReturnStatement))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:IOException))(SimpleName:e))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:response))(SimpleName:setStatus)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:ExternalContext.SC_NOT_FOUND))))(ReturnStatement))))(VariableDeclarationStatement(PrimitiveType:long)(VariableDeclarationFragment(SimpleName:lastModified)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:NetUtils))(SimpleName:getLastModified)(METHOD_INVOCATION_ARGUMENTS(SimpleName:urlConnection)))))(VariableDeclarationStatement(SimpleType(SimpleName:String))(VariableDeclarationFragment(SimpleName:cacheFileName)(ConditionalExpression(SimpleName:useCache)(MethodInvocation(SimpleName:computeCacheFileName)(METHOD_INVOCATION_ARGUMENTS(SimpleName:cachePathEncoding)(SimpleName:urlString)(CastExpression(SimpleType(SimpleName:List))(SimpleName:transforms))))(NullLiteral))))(VariableDeclarationStatement(SimpleType(SimpleName:File))(VariableDeclarationFragment(SimpleName:cacheFile)(ConditionalExpression(SimpleName:useCache)(ClassInstanceCreation(SimpleType(SimpleName:File))(SimpleName:cacheDir)(SimpleName:cacheFileName))(NullLiteral))))(VariableDeclarationStatement(PrimitiveType:boolean)(VariableDeclarationFragment(SimpleName:cacheInvalid)(InfixExpression(InfixExpression(InfixExpression(PrefixExpression(PREFIX_EXPRESSION_OPERATOR:!)(SimpleName:useCache))(INFIX_EXPRESSION_OPERATOR:||)(PrefixExpression(PREFIX_EXPRESSION_OPERATOR:!)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:cacheFile))(SimpleName:exists)))(InfixExpression(SimpleName:lastModified)(INFIX_EXPRESSION_OPERATOR:==)(NumberLiteral:0)))(INFIX_EXPRESSION_OPERATOR:||)(InfixExpression(SimpleName:lastModified)(INFIX_EXPRESSION_OPERATOR:>)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:cacheFile))(SimpleName:lastModified))))(INFIX_EXPRESSION_OPERATOR:||)(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:cacheFile))(SimpleName:length))(INFIX_EXPRESSION_OPERATOR:==)(NumberLiteral:0)))))(VariableDeclarationStatement(PrimitiveType:boolean)(VariableDeclarationFragment(SimpleName:mustProcess)(SimpleName:cacheInvalid)))(VariableDeclarationStatement(PrimitiveType:boolean)(VariableDeclarationFragment(SimpleName:updateCache)(InfixExpression(SimpleName:useCache)(INFIX_EXPRESSION_OPERATOR:&&)(SimpleName:cacheInvalid))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:response))(SimpleName:setCaching)(METHOD_INVOCATION_ARGUMENTS(SimpleName:lastModified)(BooleanLiteral:false)(BooleanLiteral:false))))(IfStatement(InfixExpression(ParenthesizedExpression(InfixExpression(InfixExpression(SimpleName:transformCount)(INFIX_EXPRESSION_OPERATOR:==)(NumberLiteral:0))(INFIX_EXPRESSION_OPERATOR:||)(PrefixExpression(PREFIX_EXPRESSION_OPERATOR:!)(SimpleName:mustProcess))))(INFIX_EXPRESSION_OPERATOR:&&)(PrefixExpression(PREFIX_EXPRESSION_OPERATOR:!)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:response))(SimpleName:checkIfModifiedSince)(METHOD_INVOCATION_ARGUMENTS(SimpleName:lastModified)(BooleanLiteral:false)))))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:response))(SimpleName:setStatus)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:ExternalContext.SC_NOT_MODIFIED))))(ReturnStatement)))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:response))(SimpleName:setContentType)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))(IfStatement(InfixExpression(SimpleName:transformCount)(INFIX_EXPRESSION_OPERATOR:==)(NumberLiteral:0))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:NetUtils))(SimpleName:copyStream)(METHOD_INVOCATION_ARGUMENTS(SimpleName:urlConnectionInputStream)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:response))(SimpleName:getOutputStream)))))(ReturnStatement)))(IfStatement(SimpleName:mustProcess)(Block(VariableDeclarationStatement(PrimitiveType:boolean)(VariableDeclarationFragment(SimpleName:closeOutputStream)(BooleanLiteral:false)))(VariableDeclarationStatement(SimpleType(SimpleName:OutputStream))(VariableDeclarationFragment(SimpleName:os)(NullLiteral)))(TryStatement(Block(VariableDeclarationStatement(SimpleType(SimpleName:Long))(VariableDeclarationFragment(SimpleName:cacheValidity)(ClassInstanceCreation(SimpleType(SimpleName:Long))(SimpleName:lastModified))))(VariableDeclarationStatement(SimpleType(SimpleName:String))(VariableDeclarationFragment(SimpleName:cacheKey)(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:newURL))(SimpleName:toExternalForm))(StringLiteral:<STR>)(SimpleName:cacheValidity)(StringLiteral:<STR>))))(VariableDeclarationStatement(SimpleType(SimpleName:BufferedImage))(VariableDeclarationFragment(SimpleName:img1)(NullLiteral)))(SynchronizedStatement(ThisExpression(SimpleName:ImageServer))(Block(ExpressionStatement(Assignment(SimpleName:img1)(ASSIGNMENT_OPERATOR:=)(ConditionalExpression(ParenthesizedExpression(InfixExpression(SimpleName:cache)(INFIX_EXPRESSION_OPERATOR:==)(NullLiteral)))(NullLiteral)(CastExpression(SimpleType(SimpleName:BufferedImage))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:cache))(SimpleName:get)(METHOD_INVOCATION_ARGUMENTS(SimpleName:cacheKey)))))))(IfStatement(InfixExpression(SimpleName:img1)(INFIX_EXPRESSION_OPERATOR:==)(NullLiteral))(Block(VariableDeclarationStatement(SimpleType(SimpleName:JPEGImageDecoder))(VariableDeclarationFragment(SimpleName:decoder)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:JPEGCodec))(SimpleName:createJPEGDecoder)(METHOD_INVOCATION_ARGUMENTS(SimpleName:urlConnectionInputStream)))))(ExpressionStatement(Assignment(SimpleName:img1)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:decoder))(SimpleName:decodeAsBufferedImage))))(IfStatement(InfixExpression(SimpleName:cache)(INFIX_EXPRESSION_OPERATOR:==)(NullLiteral))(ExpressionStatement(Assignment(SimpleName:cache)(ASSIGNMENT_OPERATOR:=)(ClassInstanceCreation(SimpleType(SimpleName:SoftCacheImpl))(NumberLiteral:0)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:cache))(SimpleName:put)(METHOD_INVOCATION_ARGUMENTS(SimpleName:cacheKey)(SimpleName:img1)))))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:cache))(SimpleName:refresh)(METHOD_INVOCATION_ARGUMENTS(SimpleName:cacheKey))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:logger))(SimpleName:info)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))))))(VariableDeclarationStatement(SimpleType(SimpleName:BufferedImage))(VariableDeclarationFragment(SimpleName:img2)(MethodInvocation(SimpleName:filter)(METHOD_INVOCATION_ARGUMENTS(SimpleName:img1)(SimpleName:transformIterator)))))(IfStatement(SimpleName:updateCache)(Block(VariableDeclarationStatement(SimpleType(SimpleName:File))(VariableDeclarationFragment(SimpleName:outputDir)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:cacheFile))(SimpleName:getParentFile))))(IfStatement(InfixExpression(PrefixExpression(PREFIX_EXPRESSION_OPERATOR:!)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:outputDir))(SimpleName:exists)))(INFIX_EXPRESSION_OPERATOR:&&)(PrefixExpression(PREFIX_EXPRESSION_OPERATOR:!)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:outputDir))(SimpleName:mkdirs))))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:logger))(SimpleName:info)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:outputDir))(SimpleName:getCanonicalPath))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:response))(SimpleName:setStatus)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:ExternalContext.SC_INTERNAL_SERVER_ERROR))))(ReturnStatement)))(ExpressionStatement(Assignment(SimpleName:os)(ASSIGNMENT_OPERATOR:=)(ClassInstanceCreation(SimpleType(SimpleName:FileOutputStream))(SimpleName:cacheFile))))(ExpressionStatement(Assignment(SimpleName:closeOutputStream)(ASSIGNMENT_OPERATOR:=)(BooleanLiteral:true))))(Block(ExpressionStatement(Assignment(SimpleName:os)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:response))(SimpleName:getOutputStream))))))(VariableDeclarationStatement(SimpleType(SimpleName:JPEGImageEncoder))(VariableDeclarationFragment(SimpleName:encoder)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:JPEGCodec))(SimpleName:createJPEGEncoder)(METHOD_INVOCATION_ARGUMENTS(SimpleName:os)))))(VariableDeclarationStatement(SimpleType(SimpleName:JPEGEncodeParam))(VariableDeclarationFragment(SimpleName:params)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:encoder))(SimpleName:getDefaultJPEGEncodeParam)(METHOD_INVOCATION_ARGUMENTS(SimpleName:img2)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:params))(SimpleName:setQuality)(METHOD_INVOCATION_ARGUMENTS(SimpleName:quality)(BooleanLiteral:false))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:encoder))(SimpleName:setJPEGEncodeParam)(METHOD_INVOCATION_ARGUMENTS(SimpleName:params))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:encoder))(SimpleName:encode)(METHOD_INVOCATION_ARGUMENTS(SimpleName:img2)))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:OXFException))(SimpleName:e))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:logger))(SimpleName:error)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:OXFException))(SimpleName:getRootThrowable)(METHOD_INVOCATION_ARGUMENTS(SimpleName:e))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:response))(SimpleName:setStatus)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:ExternalContext.SC_INTERNAL_SERVER_ERROR))))(ReturnStatement)))(Block(IfStatement(InfixExpression(InfixExpression(SimpleName:os)(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(INFIX_EXPRESSION_OPERATOR:&&)(SimpleName:closeOutputStream))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:os))(SimpleName:close))))))))(IfStatement(SimpleName:useCache)(Block(VariableDeclarationStatement(SimpleType(SimpleName:InputStream))(VariableDeclarationFragment(SimpleName:is)(ClassInstanceCreation(SimpleType(SimpleName:FileInputStream))(SimpleName:cacheFile))))(VariableDeclarationStatement(SimpleType(SimpleName:OutputStream))(VariableDeclarationFragment(SimpleName:os)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:response))(SimpleName:getOutputStream))))(TryStatement(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:NetUtils))(SimpleName:copyStream)(METHOD_INVOCATION_ARGUMENTS(SimpleName:is)(SimpleName:os)))))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:is))(SimpleName:close))))))))(Block(IfStatement(InfixExpression(InfixExpression(SimpleName:urlConnection)(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(INFIX_EXPRESSION_OPERATOR:&&)(MethodInvocation(METHOD_INVOCATION_RECEIVER(StringLiteral:<STR>))(SimpleName:equalsIgnoreCase)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:urlConnection))(SimpleName:getURL)))(SimpleName:getProtocol)))))(Block(IfStatement(InfixExpression(SimpleName:urlConnectionInputStream)(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:urlConnectionInputStream))(SimpleName:close)))))))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:OutOfMemoryError))(SimpleName:e))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:logger))(SimpleName:info)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))(ThrowStatement(SimpleName:e))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:Exception))(SimpleName:e))(Block(ThrowStatement(ClassInstanceCreation(SimpleType(SimpleName:OXFException))(SimpleName:e))))))))))