(CompilationUnit(TypeDeclaration(Modifier:public)(TYPE_DECLARATION_KIND:class)(SimpleName:Test)(MethodDeclaration(MarkerAnnotation(SimpleName:Override))(Modifier:public)(PrimitiveType:void)(SimpleName:run)(Block(WhileStatement(SimpleName:serverSocketThreadRunning)(Block(TryStatement(Block(VariableDeclarationStatement(SimpleType(SimpleName:SSLSocket))(VariableDeclarationFragment(SimpleName:federationClient)(CastExpression(SimpleType(SimpleName:SSLSocket))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:federationServerSocket))(SimpleName:accept)))))(VariableDeclarationStatement(SimpleType(SimpleName:BufferedReader))(VariableDeclarationFragment(SimpleName:reader)(ClassInstanceCreation(SimpleType(SimpleName:BufferedReader))(ClassInstanceCreation(SimpleType(SimpleName:InputStreamReader))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:federationClient))(SimpleName:getInputStream))))))(VariableDeclarationStatement(SimpleType(SimpleName:BufferedWriter))(VariableDeclarationFragment(SimpleName:writer)(ClassInstanceCreation(SimpleType(SimpleName:BufferedWriter))(ClassInstanceCreation(SimpleType(SimpleName:OutputStreamWriter))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:federationClient))(SimpleName:getOutputStream))))))(VariableDeclarationStatement(SimpleType(SimpleName:FederationRequestType))(VariableDeclarationFragment(SimpleName:requestType)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:FederationRequestType))(SimpleName:getType)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:reader))(SimpleName:readLine))))))(VariableDeclarationStatement(SimpleType(SimpleName:FederationRequest))(VariableDeclarationFragment(SimpleName:federationRequest)(ClassInstanceCreation(SimpleType(SimpleName:FederationRequest))(SimpleName:federationClient)(SimpleName:reader)(SimpleName:writer)(SimpleName:requestType))))(TryStatement(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:FederationSecurityShield))(SimpleName:getInstance)))(SimpleName:verifyRequestPermission)(METHOD_INVOCATION_ARGUMENTS(SimpleName:federationRequest)))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:NoPromptHandlerDefinedException))(SimpleName:ex))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:writer))(SimpleName:write)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(QualifiedName:FederationServiceMessageCodes.ACCESS_DENIED))(SimpleName:toString))(INFIX_EXPRESSION_OPERATOR:+)(CharacterLiteral:<STR>)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:writer))(SimpleName:flush)))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:reader))(SimpleName:close)))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:writer))(SimpleName:close)))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:federationClient))(SimpleName:close)))(ExpressionStatement(Assignment(SimpleName:federationRequest)(ASSIGNMENT_OPERATOR:=)(NullLiteral)))(ThrowStatement(SimpleName:ex))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:FederationRequestAccessDeniedException))(SimpleName:ex))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:writer))(SimpleName:write)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(QualifiedName:FederationServiceMessageCodes.ACCESS_DENIED))(SimpleName:toString))(INFIX_EXPRESSION_OPERATOR:+)(CharacterLiteral:<STR>)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:writer))(SimpleName:flush)))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:reader))(SimpleName:close)))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:writer))(SimpleName:close)))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:federationClient))(SimpleName:close)))(ExpressionStatement(Assignment(SimpleName:federationRequest)(ASSIGNMENT_OPERATOR:=)(NullLiteral)))(ThrowStatement(SimpleName:ex)))))(VariableDeclarationStatement(SimpleType(SimpleName:FederationRequestHandlerFactory))(VariableDeclarationFragment(SimpleName:handlerFactory)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:FederationRequestHandlerFactory))(SimpleName:getInstance))))(VariableDeclarationStatement(SimpleType(SimpleName:FederationRequestHandler))(VariableDeclarationFragment(SimpleName:requestHandler)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:handlerFactory))(SimpleName:getFederationRequestHandler)(METHOD_INVOCATION_ARGUMENTS(SimpleName:requestType)))))(IfStatement(InfixExpression(SimpleName:requestHandler)(INFIX_EXPRESSION_OPERATOR:==)(NullLiteral))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:writer))(SimpleName:write)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(QualifiedName:FederationServiceMessageCodes.UNSUPPORTED_SERVICE))(SimpleName:toString))(INFIX_EXPRESSION_OPERATOR:+)(CharacterLiteral:<STR>)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:writer))(SimpleName:flush)))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:reader))(SimpleName:close)))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:writer))(SimpleName:close)))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:federationClient))(SimpleName:close)))(ExpressionStatement(Assignment(SimpleName:federationRequest)(ASSIGNMENT_OPERATOR:=)(NullLiteral)))(ThrowStatement(ClassInstanceCreation(SimpleType(SimpleName:IOException))(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(SimpleName:requestType))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:writer))(SimpleName:write)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(QualifiedName:FederationServiceMessageCodes.SERVICE_AVAILABLE))(SimpleName:toString))(INFIX_EXPRESSION_OPERATOR:+)(CharacterLiteral:<STR>)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:writer))(SimpleName:flush)))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:FederationServiceStateRegistry))(SimpleName:getInstance)))(SimpleName:addToRegistry)(METHOD_INVOCATION_ARGUMENTS(SimpleName:federationRequest))))(IfStatement(InfixExpression(SimpleName:uiNotifiers)(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(Block(EnhancedForStatement(SingleVariableDeclaration(SimpleType(SimpleName:FederationRequestHandlerUINotifier))(SimpleName:uin))(SimpleName:uiNotifiers)(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:requestHandler))(SimpleName:addUINotifier)(METHOD_INVOCATION_ARGUMENTS(SimpleName:uin)))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:requestHandler))(SimpleName:handleRequest)(METHOD_INVOCATION_ARGUMENTS(SimpleName:federationRequest)))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:IOException))(SimpleName:ioe))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(QualifiedName:System.err))(SimpleName:println)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(StringLiteral:<STR>)(SimpleName:ioe)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:ioe))(SimpleName:printStackTrace)))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:FederationRequestAccessDeniedException))(SimpleName:fex))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(QualifiedName:System.err))(SimpleName:println)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(StringLiteral:<STR>)(SimpleName:fex)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:fex))(SimpleName:printStackTrace)))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:NoPromptHandlerDefinedException))(SimpleName:nex))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(QualifiedName:System.err))(SimpleName:println)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(StringLiteral:<STR>)(SimpleName:nex)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:nex))(SimpleName:printStackTrace))))))))))))