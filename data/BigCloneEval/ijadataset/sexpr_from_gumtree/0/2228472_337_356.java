(CompilationUnit(TypeDeclaration(Modifier:public)(TYPE_DECLARATION_KIND:class)(SimpleName:Test)(MethodDeclaration(Modifier:public)(SimpleType(SimpleName:MimeMultipart))(SimpleName:generateTargetMessageAsMimeMultipart)(SingleVariableDeclaration(SimpleType(SimpleName:String))(SimpleName:deviceName))(SimpleType(SimpleName:MessageException))(Block(IfStatement(InfixExpression(SimpleName:deviceName)(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(Block(VariableDeclarationStatement(SimpleType(SimpleName:MimeMultipart))(VariableDeclarationFragment(SimpleName:mimeMultipart)(CastExpression(SimpleType(SimpleName:MimeMultipart))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mimeMessageCache))(SimpleName:get)(METHOD_INVOCATION_ARGUMENTS(SimpleName:deviceName))))))(IfStatement(InfixExpression(SimpleName:mimeMultipart)(INFIX_EXPRESSION_OPERATOR:==)(NullLiteral))(Block(VariableDeclarationStatement(SimpleType(SimpleName:ProtocolIndependentMessage))(VariableDeclarationFragment(SimpleName:rawMessage)(CastExpression(SimpleType(SimpleName:ProtocolIndependentMessage))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:rawMessageCache))(SimpleName:get)(METHOD_INVOCATION_ARGUMENTS(SimpleName:deviceName))))))(IfStatement(InfixExpression(SimpleName:rawMessage)(INFIX_EXPRESSION_OPERATOR:==)(NullLiteral))(Block(VariableDeclarationStatement(SimpleType(SimpleName:MessageRequestor))(VariableDeclarationFragment(SimpleName:messageRequestor)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:MessageRequestor))(SimpleName:getInstance))))(ExpressionStatement(Assignment(SimpleName:rawMessage)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:messageRequestor))(SimpleName:getChannelIndependentMessage)(METHOD_INVOCATION_ARGUMENTS(SimpleName:deviceName)(ThisExpression)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:rawMessageCache))(SimpleName:put)(METHOD_INVOCATION_ARGUMENTS(SimpleName:deviceName)(SimpleName:rawMessage))))))(VariableDeclarationStatement(SimpleType(SimpleName:MessageAssembler))(VariableDeclarationFragment(SimpleName:messageAssembler)(ClassInstanceCreation(SimpleType(SimpleName:MimeMessageAssembler)))))(VariableDeclarationStatement(SimpleType(SimpleName:MessageAttachments))(VariableDeclarationFragment(SimpleName:attachments)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:AttachmentUtilities))(SimpleName:getAttachmentsForDevice)(METHOD_INVOCATION_ARGUMENTS(SimpleName:deviceName)(SimpleName:messageAttachments)))))(ExpressionStatement(Assignment(SimpleName:mimeMultipart)(ASSIGNMENT_OPERATOR:=)(CastExpression(SimpleType(SimpleName:MimeMultipart))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:messageAssembler))(SimpleName:assembleMessage)(METHOD_INVOCATION_ARGUMENTS(SimpleName:rawMessage)(SimpleName:attachments))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mimeMessageCache))(SimpleName:put)(METHOD_INVOCATION_ARGUMENTS(SimpleName:deviceName)(SimpleName:mimeMultipart))))))(ReturnStatement(SimpleName:mimeMultipart)))(Block(ThrowStatement(ClassInstanceCreation(SimpleType(SimpleName:MessageException))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:LOCALIZER))(SimpleName:format)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))))))))))