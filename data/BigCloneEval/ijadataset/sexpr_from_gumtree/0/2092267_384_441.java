(CompilationUnit(TypeDeclaration(Modifier:public)(TYPE_DECLARATION_KIND:class)(SimpleName:Test)(MethodDeclaration(MarkerAnnotation(SimpleName:Test))(Modifier:public)(PrimitiveType:void)(SimpleName:testPreSignPostSign)(SimpleType(SimpleName:Exception))(Block(VariableDeclarationStatement(SimpleType(SimpleName:KeyPair))(VariableDeclarationFragment(SimpleName:keyPair)(MethodInvocation(SimpleName:generateKeyPair))))(VariableDeclarationStatement(SimpleType(SimpleName:DateTime))(VariableDeclarationFragment(SimpleName:notBefore)(ClassInstanceCreation(SimpleType(SimpleName:DateTime)))))(VariableDeclarationStatement(SimpleType(SimpleName:DateTime))(VariableDeclarationFragment(SimpleName:notAfter)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:notBefore))(SimpleName:plusYears)(METHOD_INVOCATION_ARGUMENTS(NumberLiteral:1)))))(VariableDeclarationStatement(SimpleType(SimpleName:X509Certificate))(VariableDeclarationFragment(SimpleName:certificate)(MethodInvocation(SimpleName:generateCertificate)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:keyPair))(SimpleName:getPublic))(StringLiteral:<STR>)(SimpleName:notBefore)(SimpleName:notAfter)(NullLiteral)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:keyPair))(SimpleName:getPrivate))(BooleanLiteral:true)(NumberLiteral:0)(NullLiteral)(NullLiteral)(ClassInstanceCreation(SimpleType(SimpleName:KeyUsage))(QualifiedName:KeyUsage.nonRepudiation))))))(VariableDeclarationStatement(ArrayType(PrimitiveType:byte)(Dimension))(VariableDeclarationFragment(SimpleName:toBeSigned)(MethodInvocation(METHOD_INVOCATION_RECEIVER(StringLiteral:<STR>))(SimpleName:getBytes))))(VariableDeclarationStatement(SimpleType(SimpleName:MessageDigest))(VariableDeclarationFragment(SimpleName:messageDigest)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:MessageDigest))(SimpleName:getInstance)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))))(VariableDeclarationStatement(ArrayType(PrimitiveType:byte)(Dimension))(VariableDeclarationFragment(SimpleName:digestValue)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:messageDigest))(SimpleName:digest)(METHOD_INVOCATION_ARGUMENTS(SimpleName:toBeSigned)))))(VariableDeclarationStatement(ParameterizedType(SimpleType(SimpleName:List))(SimpleType(SimpleName:DigestInfo)))(VariableDeclarationFragment(SimpleName:digestInfos)(ClassInstanceCreation(ParameterizedType(SimpleType(SimpleName:LinkedList))(SimpleType(SimpleName:DigestInfo))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:digestInfos))(SimpleName:add)(METHOD_INVOCATION_ARGUMENTS(ClassInstanceCreation(SimpleType(SimpleName:DigestInfo))(SimpleName:digestValue)(StringLiteral:<STR>)(StringLiteral:<STR>)))))(VariableDeclarationStatement(SimpleType(SimpleName:HttpServletRequest))(VariableDeclarationFragment(SimpleName:mockHttpServletRequest)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:createMock)(METHOD_INVOCATION_ARGUMENTS(TypeLiteral(SimpleType(SimpleName:HttpServletRequest)))))))(VariableDeclarationStatement(SimpleType(SimpleName:HttpSession))(VariableDeclarationFragment(SimpleName:mockHttpSession)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:createMock)(METHOD_INVOCATION_ARGUMENTS(TypeLiteral(SimpleType(SimpleName:HttpSession)))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:expect)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mockHttpServletRequest))(SimpleName:getSession)))))(SimpleName:andStubReturn)(METHOD_INVOCATION_ARGUMENTS(SimpleName:mockHttpSession))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:expect)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mockHttpSession))(SimpleName:getAttribute)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))))(SimpleName:andStubReturn)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))(VariableDeclarationStatement(SimpleType(SimpleName:PolicyContextHandler))(VariableDeclarationFragment(SimpleName:handler)(ClassInstanceCreation(SimpleType(SimpleName:PolicyContextTestHandler))(SimpleName:mockHttpServletRequest))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:PolicyContext))(SimpleName:registerHandler)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)(SimpleName:handler)(BooleanLiteral:false))))(VariableDeclarationStatement(ParameterizedType(SimpleType(SimpleName:Capture))(SimpleType(SimpleName:String)))(VariableDeclarationFragment(SimpleName:xmlDocumentCapture)(ClassInstanceCreation(ParameterizedType(SimpleType(SimpleName:Capture))(SimpleType(SimpleName:String))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mockHttpSession))(SimpleName:setAttribute)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:eq)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:capture)(METHOD_INVOCATION_ARGUMENTS(SimpleName:xmlDocumentCapture))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:replay)(METHOD_INVOCATION_ARGUMENTS(SimpleName:mockHttpServletRequest)(SimpleName:mockHttpSession))))(VariableDeclarationStatement(SimpleType(SimpleName:DigestInfo))(VariableDeclarationFragment(SimpleName:resultDigestInfo)(MethodInvocation(METHOD_INVOCATION_RECEIVER(FieldAccess(ThisExpression)(SimpleName:testedInstance)))(SimpleName:preSign)(METHOD_INVOCATION_ARGUMENTS(SimpleName:digestInfos)(NullLiteral)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:verify)(METHOD_INVOCATION_ARGUMENTS(SimpleName:mockHttpServletRequest)(SimpleName:mockHttpSession))))(ExpressionStatement(MethodInvocation(SimpleName:assertNotNull)(METHOD_INVOCATION_ARGUMENTS(SimpleName:resultDigestInfo))))(ExpressionStatement(MethodInvocation(SimpleName:assertNotNull)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:resultDigestInfo.digestValue))))(ExpressionStatement(MethodInvocation(SimpleName:assertNotNull)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:resultDigestInfo.digestAlgo))))(ExpressionStatement(MethodInvocation(SimpleName:assertNotNull)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:resultDigestInfo.description))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:LOG))(SimpleName:debug)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(QualifiedName:resultDigestInfo.digestAlgo)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:LOG))(SimpleName:debug)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(QualifiedName:resultDigestInfo.description)))))(VariableDeclarationStatement(ArrayType(PrimitiveType:byte)(Dimension))(VariableDeclarationFragment(SimpleName:digestInfoValue)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:ArrayUtils))(SimpleName:addAll)(METHOD_INVOCATION_ARGUMENTS(SimpleName:SHA1_DIGEST_INFO_PREFIX)(QualifiedName:resultDigestInfo.digestValue)))))(VariableDeclarationStatement(SimpleType(SimpleName:Cipher))(VariableDeclarationFragment(SimpleName:cipher)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:Cipher))(SimpleName:getInstance)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:cipher))(SimpleName:init)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:Cipher.ENCRYPT_MODE)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:keyPair))(SimpleName:getPrivate)))))(VariableDeclarationStatement(ArrayType(PrimitiveType:byte)(Dimension))(VariableDeclarationFragment(SimpleName:signatureValue)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:cipher))(SimpleName:doFinal)(METHOD_INVOCATION_ARGUMENTS(SimpleName:digestInfoValue)))))(VariableDeclarationStatement(ParameterizedType(SimpleType(SimpleName:List))(SimpleType(SimpleName:X509Certificate)))(VariableDeclarationFragment(SimpleName:signingCertificateChain)(ClassInstanceCreation(ParameterizedType(SimpleType(SimpleName:LinkedList))(SimpleType(SimpleName:X509Certificate))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:signingCertificateChain))(SimpleName:add)(METHOD_INVOCATION_ARGUMENTS(SimpleName:certificate))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:reset)(METHOD_INVOCATION_ARGUMENTS(SimpleName:mockHttpServletRequest)(SimpleName:mockHttpSession))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:expect)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mockHttpServletRequest))(SimpleName:getSession)))))(SimpleName:andStubReturn)(METHOD_INVOCATION_ARGUMENTS(SimpleName:mockHttpSession))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:expect)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mockHttpSession))(SimpleName:getAttribute)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))))(SimpleName:andReturn)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:xmlDocumentCapture))(SimpleName:getValue)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mockHttpSession))(SimpleName:setAttribute)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:eq)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:capture)(METHOD_INVOCATION_ARGUMENTS(SimpleName:xmlDocumentCapture))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:replay)(METHOD_INVOCATION_ARGUMENTS(SimpleName:mockHttpServletRequest)(SimpleName:mockHttpSession))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(FieldAccess(ThisExpression)(SimpleName:testedInstance)))(SimpleName:postSign)(METHOD_INVOCATION_ARGUMENTS(SimpleName:signatureValue)(SimpleName:signingCertificateChain))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:verify)(METHOD_INVOCATION_ARGUMENTS(SimpleName:mockHttpServletRequest)(SimpleName:mockHttpSession))))(VariableDeclarationStatement(SimpleType(SimpleName:String))(VariableDeclarationFragment(SimpleName:signedDocumentStr)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:xmlDocumentCapture))(SimpleName:getValue))))(VariableDeclarationStatement(SimpleType(SimpleName:StringReader))(VariableDeclarationFragment(SimpleName:stringReader)(ClassInstanceCreation(SimpleType(SimpleName:StringReader))(SimpleName:signedDocumentStr))))(VariableDeclarationStatement(SimpleType(SimpleName:InputSource))(VariableDeclarationFragment(SimpleName:inputSource)(ClassInstanceCreation(SimpleType(SimpleName:InputSource))(SimpleName:stringReader))))(VariableDeclarationStatement(SimpleType(SimpleName:DocumentBuilderFactory))(VariableDeclarationFragment(SimpleName:documentBuilderFactory)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:DocumentBuilderFactory))(SimpleName:newInstance))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:documentBuilderFactory))(SimpleName:setNamespaceAware)(METHOD_INVOCATION_ARGUMENTS(BooleanLiteral:true))))(VariableDeclarationStatement(SimpleType(SimpleName:DocumentBuilder))(VariableDeclarationFragment(SimpleName:documentBuilder)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:documentBuilderFactory))(SimpleName:newDocumentBuilder))))(VariableDeclarationStatement(SimpleType(SimpleName:Document))(VariableDeclarationFragment(SimpleName:signedDocument)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:documentBuilder))(SimpleName:parse)(METHOD_INVOCATION_ARGUMENTS(SimpleName:inputSource)))))(VariableDeclarationStatement(SimpleType(SimpleName:Element))(VariableDeclarationFragment(SimpleName:signatureElement)(CastExpression(SimpleType(SimpleName:Element))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:XPathAPI))(SimpleName:selectSingleNode)(METHOD_INVOCATION_ARGUMENTS(SimpleName:signedDocument)(StringLiteral:<STR>))))))(ExpressionStatement(MethodInvocation(SimpleName:assertNotNull)(METHOD_INVOCATION_ARGUMENTS(SimpleName:signatureElement))))(VariableDeclarationStatement(SimpleType(SimpleName:XMLSignature))(VariableDeclarationFragment(SimpleName:apacheXmlSignature)(ClassInstanceCreation(SimpleType(SimpleName:XMLSignature))(SimpleName:signatureElement)(NullLiteral))))(VariableDeclarationStatement(SimpleType(SimpleName:ResourceTestResolver))(VariableDeclarationFragment(SimpleName:resourceResolver)(ClassInstanceCreation(SimpleType(SimpleName:ResourceTestResolver)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:resourceResolver))(SimpleName:addResource)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)(SimpleName:toBeSigned))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:apacheXmlSignature))(SimpleName:addResourceResolver)(METHOD_INVOCATION_ARGUMENTS(SimpleName:resourceResolver))))(VariableDeclarationStatement(PrimitiveType:boolean)(VariableDeclarationFragment(SimpleName:signatureResult)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:apacheXmlSignature))(SimpleName:checkSignatureValue)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:keyPair))(SimpleName:getPublic))))))(ExpressionStatement(MethodInvocation(SimpleName:assertTrue)(METHOD_INVOCATION_ARGUMENTS(SimpleName:signatureResult))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:LOG))(SimpleName:debug)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:xmlDocumentCapture))(SimpleName:getValue))))))))))