(CompilationUnit(TypeDeclaration(Modifier:public)(TYPE_DECLARATION_KIND:class)(SimpleName:Test)(MethodDeclaration(Modifier:protected)(PrimitiveType:void)(SimpleName:doPost)(SingleVariableDeclaration(Modifier:final)(SimpleType(SimpleName:HttpServletRequest))(SimpleName:request))(SingleVariableDeclaration(Modifier:final)(SimpleType(SimpleName:HttpServletResponse))(SimpleName:response))(SimpleType(SimpleName:ServletException))(SimpleType(SimpleName:IOException))(Block(VariableDeclarationStatement(SimpleType(SimpleName:Session))(VariableDeclarationFragment(SimpleName:session)(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:HibernateUtil))(SimpleName:getInstance)))(SimpleName:getSession))))(VariableDeclarationStatement(SimpleType(SimpleName:User))(VariableDeclarationFragment(SimpleName:owner)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:baseService))(SimpleName:getAuthenticatedUser)(METHOD_INVOCATION_ARGUMENTS(SimpleName:session)(SimpleName:request)(SimpleName:response)))))(IfStatement(InfixExpression(SimpleName:owner)(INFIX_EXPRESSION_OPERATOR:==)(NullLiteral))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:response))(SimpleName:sendError)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:HttpServletResponse.SC_FORBIDDEN))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:response))(SimpleName:setStatus)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:HttpServletResponse.SC_FORBIDDEN))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:response))(SimpleName:flushBuffer)))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:Logger))(SimpleName:log)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:request))(SimpleName:getRemoteAddr))))))(ReturnStatement)))(VariableDeclarationStatement(ParameterizedType(SimpleType(SimpleName:List))(SimpleType(SimpleName:FileItem)))(VariableDeclarationFragment(SimpleName:fileItems)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:Collections))(SimpleName:emptyList))))(TryStatement(Block(ExpressionStatement(Assignment(SimpleName:fileItems)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(SimpleName:getFileItems)(METHOD_INVOCATION_ARGUMENTS(SimpleName:request)(SimpleName:owner))))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:Throwable))(SimpleName:t))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:Logger))(SimpleName:log)(METHOD_INVOCATION_ARGUMENTS(SimpleName:t))))(ReturnStatement))))(VariableDeclarationStatement(Modifier:final)(SimpleType(SimpleName:FileUploadStatus))(VariableDeclarationFragment(SimpleName:status)(MethodInvocation(METHOD_INVOCATION_RECEIVER(QualifiedName:BaseService.fileUploadStatusMap))(SimpleName:get)(METHOD_INVOCATION_ARGUMENTS(SimpleName:owner)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:status))(SimpleName:setStatus)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:FileUploadStatus.CREATING_FILE))))(VariableDeclarationStatement(SimpleType(SimpleName:Transaction))(VariableDeclarationFragment(SimpleName:tx)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:session))(SimpleName:beginTransaction))))(TryStatement(Block(EnhancedForStatement(SingleVariableDeclaration(Modifier:final)(SimpleType(SimpleName:FileItem))(SimpleName:item))(SimpleName:fileItems)(Block(VariableDeclarationStatement(SimpleType(SimpleName:File))(VariableDeclarationFragment(SimpleName:fileObject)(NullLiteral)))(IfStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:item))(SimpleName:getContentType)))(SimpleName:contains)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))(Block(ExpressionStatement(Assignment(SimpleName:fileObject)(ASSIGNMENT_OPERATOR:=)(ClassInstanceCreation(SimpleType(SimpleName:Photo))))))(Block(ExpressionStatement(Assignment(SimpleName:fileObject)(ASSIGNMENT_OPERATOR:=)(ClassInstanceCreation(SimpleType(SimpleName:File)))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:fileObject))(SimpleName:setOwner)(METHOD_INVOCATION_ARGUMENTS(SimpleName:owner))))(VariableDeclarationStatement(SimpleType(SimpleName:String))(VariableDeclarationFragment(SimpleName:parentFolderId)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:request))(SimpleName:getParameter)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))))(VariableDeclarationStatement(SimpleType(SimpleName:Folder))(VariableDeclarationFragment(SimpleName:parentFolder)(NullLiteral)))(IfStatement(InfixExpression(InfixExpression(SimpleName:parentFolderId)(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(INFIX_EXPRESSION_OPERATOR:&&)(PrefixExpression(PREFIX_EXPRESSION_OPERATOR:!)(MethodInvocation(METHOD_INVOCATION_RECEIVER(StringLiteral:<STR>))(SimpleName:equals)(METHOD_INVOCATION_ARGUMENTS(SimpleName:parentFolderId)))))(Block(ExpressionStatement(Assignment(SimpleName:parentFolder)(ASSIGNMENT_OPERATOR:=)(CastExpression(SimpleType(SimpleName:Folder))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:session))(SimpleName:load)(METHOD_INVOCATION_ARGUMENTS(TypeLiteral(SimpleType(SimpleName:Folder)))(ClassInstanceCreation(SimpleType(SimpleName:Long))(SimpleName:parentFolderId)))))))(IfStatement(PrefixExpression(PREFIX_EXPRESSION_OPERATOR:!)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:SecurityHelper))(SimpleName:doesUserHavePermission)(METHOD_INVOCATION_ARGUMENTS(SimpleName:session)(SimpleName:owner)(SimpleName:parentFolder)(QualifiedName:PERM.WRITE))))(Block(VariableDeclarationStatement(SimpleType(SimpleName:Cookie))(VariableDeclarationFragment(SimpleName:cookie)(ClassInstanceCreation(SimpleType(SimpleName:Cookie))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:item))(SimpleName:getFieldName))(StringLiteral:<STR>))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:cookie))(SimpleName:setMaxAge)(METHOD_INVOCATION_ARGUMENTS(NumberLiteral:0))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:cookie))(SimpleName:setPath)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:response))(SimpleName:addCookie)(METHOD_INVOCATION_ARGUMENTS(SimpleName:cookie))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:response))(SimpleName:sendError)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:HttpServletResponse.SC_FORBIDDEN))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:response))(SimpleName:setStatus)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:HttpServletResponse.SC_FORBIDDEN))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:response))(SimpleName:flushBuffer)))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:Logger))(SimpleName:log)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:request))(SimpleName:getRemoteAddr))))))(ReturnStatement)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:fileObject))(SimpleName:setParent)(METHOD_INVOCATION_ARGUMENTS(SimpleName:parentFolder))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:fileObject))(SimpleName:setContentType)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:item))(SimpleName:getContentType)))))(VariableDeclarationStatement(SimpleType(SimpleName:String))(VariableDeclarationFragment(SimpleName:name)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:item))(SimpleName:getName))))(IfStatement(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:name))(SimpleName:lastIndexOf)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))(INFIX_EXPRESSION_OPERATOR:>=)(NumberLiteral:0))(Block(ExpressionStatement(Assignment(SimpleName:name)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:name))(SimpleName:substring)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:name))(SimpleName:lastIndexOf)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))(INFIX_EXPRESSION_OPERATOR:+)(NumberLiteral:1))))))))(IfStatement(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:name))(SimpleName:lastIndexOf)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))(INFIX_EXPRESSION_OPERATOR:>=)(NumberLiteral:0))(Block(ExpressionStatement(Assignment(SimpleName:name)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:name))(SimpleName:substring)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:name))(SimpleName:lastIndexOf)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))(INFIX_EXPRESSION_OPERATOR:+)(NumberLiteral:1))))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:fileObject))(SimpleName:setName)(METHOD_INVOCATION_ARGUMENTS(SimpleName:name))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:fileObject))(SimpleName:setDescription)(METHOD_INVOCATION_ARGUMENTS(SimpleName:name))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:session))(SimpleName:save)(METHOD_INVOCATION_ARGUMENTS(SimpleName:fileObject))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:status))(SimpleName:setStatus)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:FileUploadStatus.WRITING_FILE))))(VariableDeclarationStatement(SimpleType(QualifiedName:java.io.File))(VariableDeclarationFragment(SimpleName:outputPath)(ClassInstanceCreation(SimpleType(QualifiedName:java.io.File))(InfixExpression(QualifiedName:java.io.File.separatorChar)(INFIX_EXPRESSION_OPERATOR:+)(StringLiteral:<STR>)(QualifiedName:java.io.File.separatorChar)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:BaseSystem))(SimpleName:getDomainName)(METHOD_INVOCATION_ARGUMENTS(SimpleName:request)))))))(VariableDeclarationStatement(SimpleType(QualifiedName:java.io.File))(VariableDeclarationFragment(SimpleName:outputFile)(ClassInstanceCreation(SimpleType(QualifiedName:java.io.File))(SimpleName:outputPath)(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:fileObject))(SimpleName:getId))(INFIX_EXPRESSION_OPERATOR:+)(StringLiteral:<STR>)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:fileObject))(SimpleName:getName))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:outputPath))(SimpleName:mkdirs)))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:item))(SimpleName:write)(METHOD_INVOCATION_ARGUMENTS(SimpleName:outputFile))))(ExpressionStatement(Assignment(SimpleName:tx)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:session))(SimpleName:beginTransaction))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:fileObject))(SimpleName:setNameOnDisk)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:fileObject))(SimpleName:getId))(INFIX_EXPRESSION_OPERATOR:+)(StringLiteral:<STR>)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:fileObject))(SimpleName:getName))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:fileObject))(SimpleName:setSize)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:outputFile))(SimpleName:length)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:session))(SimpleName:save)(METHOD_INVOCATION_ARGUMENTS(SimpleName:fileObject))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:tx))(SimpleName:commit)))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:Logger))(SimpleName:log)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:outputFile))(SimpleName:getCanonicalPath))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:status))(SimpleName:setStatus)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:FileUploadStatus.WRITING_DATABASE))))(ExpressionStatement(MethodInvocation(SimpleName:saveFileFromStream)(METHOD_INVOCATION_ARGUMENTS(SimpleName:fileObject)(ClassInstanceCreation(SimpleType(SimpleName:FileInputStream))(SimpleName:outputFile)))))(TryStatement(Block(IfStatement(InstanceofExpression(SimpleName:fileObject)(SimpleType(SimpleName:Photo)))(Block(VariableDeclarationStatement(SimpleType(SimpleName:BufferedImage))(VariableDeclarationFragment(SimpleName:bi)(MethodInvocation(METHOD_INVOCATION_RECEIVER(QualifiedName:javax.imageio.ImageIO))(SimpleName:read)(METHOD_INVOCATION_ARGUMENTS(SimpleName:outputFile)))))(VariableDeclarationStatement(SimpleType(SimpleName:ByteArrayOutputStream))(VariableDeclarationFragment(SimpleName:pngOut)(ClassInstanceCreation(SimpleType(SimpleName:ByteArrayOutputStream)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:ImageIO))(SimpleName:write)(METHOD_INVOCATION_ARGUMENTS(SimpleName:bi)(StringLiteral:<STR>)(SimpleName:pngOut))))(ExpressionStatement(Assignment(SimpleName:tx)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:session))(SimpleName:beginTransaction))))(VariableDeclarationStatement(SimpleType(SimpleName:Photo))(VariableDeclarationFragment(SimpleName:photo)(CastExpression(SimpleType(SimpleName:Photo))(SimpleName:fileObject))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:photo))(SimpleName:setWidth)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:bi))(SimpleName:getWidth)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:photo))(SimpleName:setHeight)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:bi))(SimpleName:getHeight)))))(VariableDeclarationStatement(SimpleType(SimpleName:PhotoThumbnail))(VariableDeclarationFragment(SimpleName:thumbFile)(ClassInstanceCreation(SimpleType(SimpleName:PhotoThumbnail)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:thumbFile))(SimpleName:setHidden)(METHOD_INVOCATION_ARGUMENTS(BooleanLiteral:true))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:thumbFile))(SimpleName:setOwner)(METHOD_INVOCATION_ARGUMENTS(SimpleName:owner))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:thumbFile))(SimpleName:setParent)(METHOD_INVOCATION_ARGUMENTS(SimpleName:parentFolder))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:thumbFile))(SimpleName:setName)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(SimpleName:createFileName)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)(SimpleName:name)(StringLiteral:<STR>))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:thumbFile))(SimpleName:setDescription)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(SimpleName:name)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:session))(SimpleName:save)(METHOD_INVOCATION_ARGUMENTS(SimpleName:thumbFile))))(VariableDeclarationStatement(SimpleType(SimpleName:PhotoThumbnail))(VariableDeclarationFragment(SimpleName:previewFile)(ClassInstanceCreation(SimpleType(SimpleName:PhotoThumbnail)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:previewFile))(SimpleName:setHidden)(METHOD_INVOCATION_ARGUMENTS(BooleanLiteral:true))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:previewFile))(SimpleName:setOwner)(METHOD_INVOCATION_ARGUMENTS(SimpleName:owner))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:previewFile))(SimpleName:setParent)(METHOD_INVOCATION_ARGUMENTS(SimpleName:parentFolder))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:previewFile))(SimpleName:setName)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(SimpleName:createFileName)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)(SimpleName:name)(StringLiteral:<STR>))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:previewFile))(SimpleName:setDescription)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(SimpleName:name)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:session))(SimpleName:save)(METHOD_INVOCATION_ARGUMENTS(SimpleName:previewFile))))(VariableDeclarationStatement(SimpleType(SimpleName:PhotoThumbnail))(VariableDeclarationFragment(SimpleName:slideFile)(ClassInstanceCreation(SimpleType(SimpleName:PhotoThumbnail)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:slideFile))(SimpleName:setHidden)(METHOD_INVOCATION_ARGUMENTS(BooleanLiteral:true))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:slideFile))(SimpleName:setOwner)(METHOD_INVOCATION_ARGUMENTS(SimpleName:owner))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:slideFile))(SimpleName:setParent)(METHOD_INVOCATION_ARGUMENTS(SimpleName:parentFolder))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:slideFile))(SimpleName:setName)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(SimpleName:createFileName)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)(SimpleName:name)(StringLiteral:<STR>))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:slideFile))(SimpleName:setDescription)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(SimpleName:name)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:session))(SimpleName:save)(METHOD_INVOCATION_ARGUMENTS(SimpleName:slideFile))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:photo))(SimpleName:setThumbnailImage)(METHOD_INVOCATION_ARGUMENTS(SimpleName:thumbFile))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:photo))(SimpleName:setSlideshowImage)(METHOD_INVOCATION_ARGUMENTS(SimpleName:slideFile))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:photo))(SimpleName:setPreviewImage)(METHOD_INVOCATION_ARGUMENTS(SimpleName:previewFile))))(VariableDeclarationStatement(SimpleType(SimpleName:ByteArrayInputStream))(VariableDeclarationFragment(SimpleName:pngIn)(ClassInstanceCreation(SimpleType(SimpleName:ByteArrayInputStream))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:pngOut))(SimpleName:toByteArray)))))(VariableDeclarationStatement(SimpleType(SimpleName:ByteArrayOutputStream))(VariableDeclarationFragment(SimpleName:thumbOutStream)(ClassInstanceCreation(SimpleType(SimpleName:ByteArrayOutputStream)))))(VariableDeclarationStatement(SimpleType(SimpleName:BufferedImage))(VariableDeclarationFragment(SimpleName:thumbbi)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:ImageIO))(SimpleName:read)(METHOD_INVOCATION_ARGUMENTS(SimpleName:pngIn)))))(VariableDeclarationStatement(SimpleType(SimpleName:BufferedImage))(VariableDeclarationFragment(SimpleName:convertedThumbImage)(MethodInvocation(SimpleName:createThumbnail)(METHOD_INVOCATION_ARGUMENTS(SimpleName:thumbbi)(NumberLiteral:128)(NumberLiteral:128)(BooleanLiteral:true)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:thumbFile))(SimpleName:setWidth)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:convertedThumbImage))(SimpleName:getWidth)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:thumbFile))(SimpleName:setHeight)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:convertedThumbImage))(SimpleName:getHeight)))))(VariableDeclarationStatement(SimpleType(SimpleName:ImageWriter))(VariableDeclarationFragment(SimpleName:writer)(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:ImageIO))(SimpleName:getImageWritersByFormatName)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))(SimpleName:next))))(VariableDeclarationStatement(SimpleType(SimpleName:ImageWriteParam))(VariableDeclarationFragment(SimpleName:iwp)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:writer))(SimpleName:getDefaultWriteParam))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:iwp))(SimpleName:setCompressionMode)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:ImageWriteParam.MODE_EXPLICIT))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:iwp))(SimpleName:setCompressionQuality)(METHOD_INVOCATION_ARGUMENTS(NumberLiteral:0.75f))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:writer))(SimpleName:setOutput)(METHOD_INVOCATION_ARGUMENTS(ClassInstanceCreation(SimpleType(SimpleName:MemoryCacheImageOutputStream))(SimpleName:thumbOutStream)))))(VariableDeclarationStatement(SimpleType(SimpleName:IIOImage))(VariableDeclarationFragment(SimpleName:thumbimage)(ClassInstanceCreation(SimpleType(SimpleName:IIOImage))(SimpleName:convertedThumbImage)(NullLiteral)(NullLiteral))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:writer))(SimpleName:write)(METHOD_INVOCATION_ARGUMENTS(NullLiteral)(SimpleName:thumbimage)(SimpleName:iwp))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:pngIn))(SimpleName:reset)))(VariableDeclarationStatement(SimpleType(SimpleName:ByteArrayOutputStream))(VariableDeclarationFragment(SimpleName:slideOutStream)(ClassInstanceCreation(SimpleType(SimpleName:ByteArrayOutputStream)))))(VariableDeclarationStatement(SimpleType(SimpleName:BufferedImage))(VariableDeclarationFragment(SimpleName:slidebi)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:ImageIO))(SimpleName:read)(METHOD_INVOCATION_ARGUMENTS(SimpleName:pngIn)))))(VariableDeclarationStatement(SimpleType(SimpleName:BufferedImage))(VariableDeclarationFragment(SimpleName:convertedSlideImage)(MethodInvocation(SimpleName:createThumbnail)(METHOD_INVOCATION_ARGUMENTS(SimpleName:slidebi)(NumberLiteral:640)(NumberLiteral:400)(BooleanLiteral:true)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:slideFile))(SimpleName:setWidth)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:convertedSlideImage))(SimpleName:getWidth)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:slideFile))(SimpleName:setHeight)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:convertedSlideImage))(SimpleName:getHeight)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:writer))(SimpleName:setOutput)(METHOD_INVOCATION_ARGUMENTS(ClassInstanceCreation(SimpleType(SimpleName:MemoryCacheImageOutputStream))(SimpleName:slideOutStream)))))(VariableDeclarationStatement(SimpleType(SimpleName:IIOImage))(VariableDeclarationFragment(SimpleName:slideimage)(ClassInstanceCreation(SimpleType(SimpleName:IIOImage))(SimpleName:convertedSlideImage)(NullLiteral)(NullLiteral))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:writer))(SimpleName:write)(METHOD_INVOCATION_ARGUMENTS(NullLiteral)(SimpleName:slideimage)(SimpleName:iwp))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:pngIn))(SimpleName:reset)))(VariableDeclarationStatement(SimpleType(SimpleName:ByteArrayOutputStream))(VariableDeclarationFragment(SimpleName:previewOutStream)(ClassInstanceCreation(SimpleType(SimpleName:ByteArrayOutputStream)))))(VariableDeclarationStatement(SimpleType(SimpleName:BufferedImage))(VariableDeclarationFragment(SimpleName:previewbi)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:ImageIO))(SimpleName:read)(METHOD_INVOCATION_ARGUMENTS(SimpleName:pngIn)))))(VariableDeclarationStatement(SimpleType(SimpleName:BufferedImage))(VariableDeclarationFragment(SimpleName:convertedPreviewImage)(MethodInvocation(SimpleName:createThumbnail)(METHOD_INVOCATION_ARGUMENTS(SimpleName:previewbi)(NumberLiteral:320)(NumberLiteral:200)(BooleanLiteral:true)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:previewFile))(SimpleName:setWidth)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:convertedPreviewImage))(SimpleName:getWidth)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:previewFile))(SimpleName:setHeight)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:convertedPreviewImage))(SimpleName:getHeight)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:writer))(SimpleName:setOutput)(METHOD_INVOCATION_ARGUMENTS(ClassInstanceCreation(SimpleType(SimpleName:MemoryCacheImageOutputStream))(SimpleName:previewOutStream)))))(VariableDeclarationStatement(SimpleType(SimpleName:IIOImage))(VariableDeclarationFragment(SimpleName:previewimage)(ClassInstanceCreation(SimpleType(SimpleName:IIOImage))(SimpleName:convertedPreviewImage)(NullLiteral)(NullLiteral))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:writer))(SimpleName:write)(METHOD_INVOCATION_ARGUMENTS(NullLiteral)(SimpleName:previewimage)(SimpleName:iwp))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:thumbFile))(SimpleName:setContentType)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:slideFile))(SimpleName:setContentType)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:previewFile))(SimpleName:setContentType)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:thumbFile))(SimpleName:setSize)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:thumbOutStream))(SimpleName:size)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:slideFile))(SimpleName:setSize)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:slideOutStream))(SimpleName:size)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:previewFile))(SimpleName:setSize)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:previewOutStream))(SimpleName:size)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:session))(SimpleName:save)(METHOD_INVOCATION_ARGUMENTS(SimpleName:thumbFile))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:session))(SimpleName:save)(METHOD_INVOCATION_ARGUMENTS(SimpleName:slideFile))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:session))(SimpleName:save)(METHOD_INVOCATION_ARGUMENTS(SimpleName:previewFile))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:tx))(SimpleName:commit)))(ExpressionStatement(Assignment(SimpleName:tx)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:session))(SimpleName:beginTransaction))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:thumbFile))(SimpleName:setNameOnDisk)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(SimpleName:createFileName)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:thumbFile))(SimpleName:getId)))(SimpleName:toString))(INFIX_EXPRESSION_OPERATOR:+)(StringLiteral:<STR>))(SimpleName:name)(StringLiteral:<STR>))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:slideFile))(SimpleName:setNameOnDisk)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(SimpleName:createFileName)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:slideFile))(SimpleName:getId)))(SimpleName:toString))(INFIX_EXPRESSION_OPERATOR:+)(StringLiteral:<STR>))(SimpleName:name)(StringLiteral:<STR>))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:previewFile))(SimpleName:setNameOnDisk)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(SimpleName:createFileName)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:previewFile))(SimpleName:getId)))(SimpleName:toString))(INFIX_EXPRESSION_OPERATOR:+)(StringLiteral:<STR>))(SimpleName:name)(StringLiteral:<STR>))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:tx))(SimpleName:commit)))(ExpressionStatement(MethodInvocation(SimpleName:saveFileFromStream)(METHOD_INVOCATION_ARGUMENTS(SimpleName:thumbFile)(ClassInstanceCreation(SimpleType(SimpleName:ByteArrayInputStream))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:thumbOutStream))(SimpleName:toByteArray))))))(ExpressionStatement(MethodInvocation(SimpleName:saveFileFromStream)(METHOD_INVOCATION_ARGUMENTS(SimpleName:slideFile)(ClassInstanceCreation(SimpleType(SimpleName:ByteArrayInputStream))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:slideOutStream))(SimpleName:toByteArray))))))(ExpressionStatement(MethodInvocation(SimpleName:saveFileFromStream)(METHOD_INVOCATION_ARGUMENTS(SimpleName:previewFile)(ClassInstanceCreation(SimpleType(SimpleName:ByteArrayInputStream))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:previewOutStream))(SimpleName:toByteArray))))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:status))(SimpleName:setStatus)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:FileUploadStatus.FINISHED))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:Logger))(SimpleName:log)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:fileObject))(SimpleName:getName)))))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:Throwable))(SimpleName:t))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:Logger))(SimpleName:log)(METHOD_INVOCATION_ARGUMENTS(SimpleName:t)))))))(VariableDeclarationStatement(SimpleType(SimpleName:Cookie))(VariableDeclarationFragment(SimpleName:cookie)(ClassInstanceCreation(SimpleType(SimpleName:Cookie))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:item))(SimpleName:getFieldName))(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:fileObject))(SimpleName:getId)))(SimpleName:toString)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:cookie))(SimpleName:setPath)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:cookie))(SimpleName:setMaxAge)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:BaseService.COOKIE_TIMEOUT))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:response))(SimpleName:addCookie)(METHOD_INVOCATION_ARGUMENTS(SimpleName:cookie))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:response))(SimpleName:setStatus)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:HttpServletResponse.SC_OK))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:response))(SimpleName:getOutputStream)))(SimpleName:close)))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:response))(SimpleName:flushBuffer))))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:Throwable))(SimpleName:t))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:Logger))(SimpleName:log)(METHOD_INVOCATION_ARGUMENTS(SimpleName:t))))(TryStatement(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:tx))(SimpleName:rollback))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:Exception))(SimpleName:e2))(Block)))))(Block(TryStatement(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:session))(SimpleName:close))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:Exception))(SimpleName:e))(Block)))))))))