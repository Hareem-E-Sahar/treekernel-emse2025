(CompilationUnit(TypeDeclaration(Modifier:public)(TYPE_DECLARATION_KIND:class)(SimpleName:Test)(MethodDeclaration(MarkerAnnotation(SimpleName:Test))(Modifier:public)(PrimitiveType:void)(SimpleName:testHandleMessageWithAudit)(SimpleType(SimpleName:Exception))(Block(VariableDeclarationStatement(SimpleType(SimpleName:KeyPair))(VariableDeclarationFragment(SimpleName:keyPair)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:MiscTestUtils))(SimpleName:generateKeyPair))))(VariableDeclarationStatement(SimpleType(SimpleName:DateTime))(VariableDeclarationFragment(SimpleName:notBefore)(ClassInstanceCreation(SimpleType(SimpleName:DateTime)))))(VariableDeclarationStatement(SimpleType(SimpleName:DateTime))(VariableDeclarationFragment(SimpleName:notAfter)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:notBefore))(SimpleName:plusYears)(METHOD_INVOCATION_ARGUMENTS(NumberLiteral:1)))))(VariableDeclarationStatement(SimpleType(SimpleName:X509Certificate))(VariableDeclarationFragment(SimpleName:certificate)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:MiscTestUtils))(SimpleName:generateCertificate)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:keyPair))(SimpleName:getPublic))(StringLiteral:<STR>)(SimpleName:notBefore)(SimpleName:notAfter)(NullLiteral)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:keyPair))(SimpleName:getPrivate))(BooleanLiteral:true)(NumberLiteral:0)(NullLiteral)(NullLiteral)))))(VariableDeclarationStatement(SimpleType(SimpleName:ServletConfig))(VariableDeclarationFragment(SimpleName:mockServletConfig)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:createMock)(METHOD_INVOCATION_ARGUMENTS(TypeLiteral(SimpleType(SimpleName:ServletConfig)))))))(VariableDeclarationStatement(ParameterizedType(SimpleType(SimpleName:Map))(SimpleType(SimpleName:String))(SimpleType(SimpleName:String)))(VariableDeclarationFragment(SimpleName:httpHeaders)(ClassInstanceCreation(ParameterizedType(SimpleType(SimpleName:HashMap))(SimpleType(SimpleName:String))(SimpleType(SimpleName:String))))))(VariableDeclarationStatement(SimpleType(SimpleName:HttpSession))(VariableDeclarationFragment(SimpleName:mockHttpSession)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:createMock)(METHOD_INVOCATION_ARGUMENTS(TypeLiteral(SimpleType(SimpleName:HttpSession)))))))(VariableDeclarationStatement(SimpleType(SimpleName:HttpServletRequest))(VariableDeclarationFragment(SimpleName:mockServletRequest)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:createMock)(METHOD_INVOCATION_ARGUMENTS(TypeLiteral(SimpleType(SimpleName:HttpServletRequest)))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:expect)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mockServletConfig))(SimpleName:getInitParameter)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))))(SimpleName:andStubReturn)(METHOD_INVOCATION_ARGUMENTS(NullLiteral))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:expect)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mockServletConfig))(SimpleName:getInitParameter)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))))(SimpleName:andStubReturn)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(TypeLiteral(SimpleType(SimpleName:AuditTestService))))(SimpleName:getName)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:expect)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mockServletConfig))(SimpleName:getInitParameter)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))))(SimpleName:andStubReturn)(METHOD_INVOCATION_ARGUMENTS(NullLiteral))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:expect)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mockServletConfig))(SimpleName:getInitParameter)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))))(SimpleName:andStubReturn)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(TypeLiteral(SimpleType(SimpleName:SignatureTestService))))(SimpleName:getName)))))(VariableDeclarationStatement(SimpleType(SimpleName:MessageDigest))(VariableDeclarationFragment(SimpleName:messageDigest)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:MessageDigest))(SimpleName:getInstance)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))))(VariableDeclarationStatement(ArrayType(PrimitiveType:byte)(Dimension))(VariableDeclarationFragment(SimpleName:document)(MethodInvocation(METHOD_INVOCATION_RECEIVER(StringLiteral:<STR>))(SimpleName:getBytes))))(VariableDeclarationStatement(ArrayType(PrimitiveType:byte)(Dimension))(VariableDeclarationFragment(SimpleName:digestValue)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:messageDigest))(SimpleName:digest)(METHOD_INVOCATION_ARGUMENTS(SimpleName:document)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:expect)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mockHttpSession))(SimpleName:getAttribute)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:SignatureDataMessageHandler.DIGEST_VALUE_SESSION_ATTRIBUTE))))))(SimpleName:andStubReturn)(METHOD_INVOCATION_ARGUMENTS(SimpleName:digestValue))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:expect)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mockHttpSession))(SimpleName:getAttribute)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:SignatureDataMessageHandler.DIGEST_ALGO_SESSION_ATTRIBUTE))))))(SimpleName:andStubReturn)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))(VariableDeclarationStatement(SimpleType(SimpleName:SignatureDataMessage))(VariableDeclarationFragment(SimpleName:message)(ClassInstanceCreation(SimpleType(SimpleName:SignatureDataMessage)))))(ExpressionStatement(Assignment(QualifiedName:message.certificateChain)(ASSIGNMENT_OPERATOR:=)(ClassInstanceCreation(ParameterizedType(SimpleType(SimpleName:LinkedList))(SimpleType(SimpleName:X509Certificate))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(QualifiedName:message.certificateChain))(SimpleName:add)(METHOD_INVOCATION_ARGUMENTS(SimpleName:certificate))))(VariableDeclarationStatement(SimpleType(SimpleName:Signature))(VariableDeclarationFragment(SimpleName:signature)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:Signature))(SimpleName:getInstance)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:signature))(SimpleName:initSign)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:keyPair))(SimpleName:getPrivate)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:signature))(SimpleName:update)(METHOD_INVOCATION_ARGUMENTS(SimpleName:document))))(VariableDeclarationStatement(ArrayType(PrimitiveType:byte)(Dimension))(VariableDeclarationFragment(SimpleName:signatureValue)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:signature))(SimpleName:sign))))(ExpressionStatement(Assignment(QualifiedName:message.signatureValue)(ASSIGNMENT_OPERATOR:=)(SimpleName:signatureValue)))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:replay)(METHOD_INVOCATION_ARGUMENTS(SimpleName:mockServletConfig)(SimpleName:mockHttpSession)(SimpleName:mockServletRequest))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:AppletServiceServlet))(SimpleName:injectInitParams)(METHOD_INVOCATION_ARGUMENTS(SimpleName:mockServletConfig)(FieldAccess(ThisExpression)(SimpleName:testedInstance)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(FieldAccess(ThisExpression)(SimpleName:testedInstance)))(SimpleName:init)(METHOD_INVOCATION_ARGUMENTS(SimpleName:mockServletConfig))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(FieldAccess(ThisExpression)(SimpleName:testedInstance)))(SimpleName:handleMessage)(METHOD_INVOCATION_ARGUMENTS(SimpleName:message)(SimpleName:httpHeaders)(SimpleName:mockServletRequest)(SimpleName:mockHttpSession))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:verify)(METHOD_INVOCATION_ARGUMENTS(SimpleName:mockServletConfig)(SimpleName:mockHttpSession)(SimpleName:mockServletRequest))))(ExpressionStatement(MethodInvocation(SimpleName:assertEquals)(METHOD_INVOCATION_ARGUMENTS(SimpleName:signatureValue)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:SignatureTestService))(SimpleName:getSignatureValue)))))(ExpressionStatement(MethodInvocation(SimpleName:assertEquals)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:AuditTestService))(SimpleName:getAuditSigningUserId)))))))))