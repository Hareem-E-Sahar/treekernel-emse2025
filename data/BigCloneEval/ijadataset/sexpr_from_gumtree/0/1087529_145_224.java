(CompilationUnit(TypeDeclaration(Modifier:public)(TYPE_DECLARATION_KIND:class)(SimpleName:Test)(MethodDeclaration(MarkerAnnotation(SimpleName:Override))(Modifier:public)(ParameterizedType(SimpleType(SimpleName:DataUpdateResult))(SimpleType(SimpleName:Record)))(SimpleName:archiveRecord)(SingleVariableDeclaration(SimpleType(SimpleName:String))(SimpleName:authToken))(SingleVariableDeclaration(SimpleType(SimpleName:Record))(SimpleName:record))(SingleVariableDeclaration(SimpleType(SimpleName:Filter))(SimpleName:filter))(SingleVariableDeclaration(SimpleType(SimpleName:Field))(SimpleName:sourceField))(SingleVariableDeclaration(SimpleType(SimpleName:InputModel))(SimpleName:inputmodel))(SimpleType(SimpleName:DataOperationException))(Block(ExpressionStatement(MethodInvocation(SimpleName:validateUserIsSignedOn)(METHOD_INVOCATION_ARGUMENTS(SimpleName:authToken))))(ExpressionStatement(MethodInvocation(SimpleName:validateUserHasAdminRights)(METHOD_INVOCATION_ARGUMENTS(SimpleName:authToken))))(VariableDeclarationStatement(ParameterizedType(SimpleType(SimpleName:DataUpdateResult))(SimpleType(SimpleName:Record)))(VariableDeclarationFragment(SimpleName:recordUpdateResult)(ClassInstanceCreation(ParameterizedType(SimpleType(SimpleName:DataUpdateResult))(SimpleType(SimpleName:Record))))))(IfStatement(InfixExpression(SimpleName:record)(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(Block(VariableDeclarationStatement(SimpleType(SimpleName:Connection))(VariableDeclarationFragment(SimpleName:connection)(NullLiteral)))(VariableDeclarationStatement(PrimitiveType:boolean)(VariableDeclarationFragment(SimpleName:archived)(BooleanLiteral:false)))(TryStatement(Block(VariableDeclarationStatement(PrimitiveType:long)(VariableDeclarationFragment(SimpleName:userId)(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(SimpleName:getSignedOnUser)(METHOD_INVOCATION_ARGUMENTS(SimpleName:authToken))))(SimpleName:getUserId))))(ExpressionStatement(Assignment(SimpleName:connection)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:DatabaseConnector))(SimpleName:getConnection))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:connection))(SimpleName:setAutoCommit)(METHOD_INVOCATION_ARGUMENTS(BooleanLiteral:false))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:recordUpdateResult))(SimpleName:setMessage)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:messages))(SimpleName:server_record_delete_success)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:recordUpdateResult))(SimpleName:setSuccessful)(METHOD_INVOCATION_ARGUMENTS(BooleanLiteral:true))))(VariableDeclarationStatement(SimpleType(SimpleName:String))(VariableDeclarationFragment(SimpleName:sql)(StringLiteral:<STR>)))(VariableDeclarationStatement(SimpleType(SimpleName:PreparedStatement))(VariableDeclarationFragment(SimpleName:updateRecord)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:connection))(SimpleName:prepareStatement)(METHOD_INVOCATION_ARGUMENTS(SimpleName:sql)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:updateRecord))(SimpleName:setLong)(METHOD_INVOCATION_ARGUMENTS(NumberLiteral:1)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:record))(SimpleName:getRecordid)))))(VariableDeclarationStatement(PrimitiveType:int)(VariableDeclarationFragment(SimpleName:recordArchived)(NumberLiteral:0)))(ExpressionStatement(Assignment(SimpleName:recordArchived)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:updateRecord))(SimpleName:executeUpdate))))(IfStatement(InfixExpression(SimpleName:recordArchived)(INFIX_EXPRESSION_OPERATOR:>)(NumberLiteral:0))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:AuditTrailManager))(SimpleName:updateAuditTrail)(METHOD_INVOCATION_ARGUMENTS(SimpleName:connection)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:AuditTrailManager))(SimpleName:createAuditTrailEvent)(METHOD_INVOCATION_ARGUMENTS(SimpleName:record)(SimpleName:userId)(QualifiedName:AuditableEvent.EVENTYPE_DELETE)))(SimpleName:authToken)(MethodInvocation(SimpleName:getSession))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:TopicUpdateServiceImpl))(SimpleName:archiveRecordTopics)(METHOD_INVOCATION_ARGUMENTS(SimpleName:connection)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:record))(SimpleName:getTopics))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:record))(SimpleName:getRecordid)))))(VariableDeclarationStatement(ParameterizedType(SimpleType(SimpleName:ArrayList))(SimpleType(SimpleName:RecordAttribute)))(VariableDeclarationFragment(SimpleName:recordAttributes)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:record))(SimpleName:getRecordattributes))))(IfStatement(InfixExpression(InfixExpression(SimpleName:recordAttributes)(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(INFIX_EXPRESSION_OPERATOR:&&)(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:recordAttributes))(SimpleName:size))(INFIX_EXPRESSION_OPERATOR:>)(NumberLiteral:0)))(Block(VariableDeclarationStatement(ParameterizedType(SimpleType(SimpleName:Iterator))(SimpleType(SimpleName:RecordAttribute)))(VariableDeclarationFragment(SimpleName:rItr)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:recordAttributes))(SimpleName:iterator))))(WhileStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:rItr))(SimpleName:hasNext))(Block(VariableDeclarationStatement(SimpleType(SimpleName:RecordAttribute))(VariableDeclarationFragment(SimpleName:r)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:rItr))(SimpleName:next))))(VariableDeclarationStatement(SimpleType(SimpleName:String))(VariableDeclarationFragment(SimpleName:rAtSql)(StringLiteral:<STR>)))(VariableDeclarationStatement(SimpleType(SimpleName:PreparedStatement))(VariableDeclarationFragment(SimpleName:updateRecordAttribute)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:connection))(SimpleName:prepareStatement)(METHOD_INVOCATION_ARGUMENTS(SimpleName:rAtSql)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:updateRecordAttribute))(SimpleName:setLong)(METHOD_INVOCATION_ARGUMENTS(NumberLiteral:1)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:r))(SimpleName:getRecordattributeid)))))(VariableDeclarationStatement(PrimitiveType:int)(VariableDeclarationFragment(SimpleName:recordAttribArchived)(NumberLiteral:0)))(ExpressionStatement(Assignment(SimpleName:recordAttribArchived)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:updateRecordAttribute))(SimpleName:executeUpdate))))(IfStatement(InfixExpression(SimpleName:recordAttribArchived)(INFIX_EXPRESSION_OPERATOR:>)(NumberLiteral:0))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:AuditTrailManager))(SimpleName:updateAuditTrail)(METHOD_INVOCATION_ARGUMENTS(SimpleName:connection)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:AuditTrailManager))(SimpleName:createAuditTrailEvent)(METHOD_INVOCATION_ARGUMENTS(SimpleName:r)(SimpleName:userId)(QualifiedName:AuditableEvent.EVENTYPE_DELETE)))(SimpleName:authToken)(MethodInvocation(SimpleName:getSession))))))))))(VariableDeclarationStatement(ParameterizedType(SimpleType(SimpleName:ArrayList))(SimpleType(SimpleName:Term)))(VariableDeclarationFragment(SimpleName:terms)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:record))(SimpleName:getTerms))))(VariableDeclarationStatement(ParameterizedType(SimpleType(SimpleName:Iterator))(SimpleType(SimpleName:Term)))(VariableDeclarationFragment(SimpleName:termsItr)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:terms))(SimpleName:iterator))))(WhileStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:termsItr))(SimpleName:hasNext))(Block(VariableDeclarationStatement(SimpleType(SimpleName:Term))(VariableDeclarationFragment(SimpleName:term)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:termsItr))(SimpleName:next))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:TermUpdater))(SimpleName:archiveTerm)(METHOD_INVOCATION_ARGUMENTS(SimpleName:connection)(SimpleName:term)(SimpleName:userId)(SimpleName:authToken)(MethodInvocation(SimpleName:getSession)))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:connection))(SimpleName:commit)))(ExpressionStatement(Assignment(SimpleName:archived)(ASSIGNMENT_OPERATOR:=)(BooleanLiteral:true)))(IfStatement(InfixExpression(SimpleName:filter)(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:RecordIdTracker))(SimpleName:refreshRecordIdsInSessionByFilter)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(ThisExpression))(SimpleName:getThreadLocalRequest)))(SimpleName:getSession))(SimpleName:connection)(BooleanLiteral:true)(SimpleName:filter)(SimpleName:sourceField)(SimpleName:authToken))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:RecordIdTracker))(SimpleName:refreshRecordIdsInSession)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(ThisExpression))(SimpleName:getThreadLocalRequest)))(SimpleName:getSession))(SimpleName:connection)(BooleanLiteral:false)(SimpleName:authToken)))))(VariableDeclarationStatement(SimpleType(SimpleName:RecordRetrievalServiceImpl))(VariableDeclarationFragment(SimpleName:retriever)(ClassInstanceCreation(SimpleType(SimpleName:RecordRetrievalServiceImpl)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:RecordIdTracker))(SimpleName:refreshRecordIdsInSession)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(ThisExpression))(SimpleName:getThreadLocalRequest)))(SimpleName:getSession))(SimpleName:connection)(BooleanLiteral:false)(SimpleName:authToken))))(VariableDeclarationStatement(SimpleType(SimpleName:Record))(VariableDeclarationFragment(SimpleName:updatedRecord)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:retriever))(SimpleName:retrieveRecordByRecordId)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(SimpleName:initSignedOnUser)(METHOD_INVOCATION_ARGUMENTS(SimpleName:authToken)))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:record))(SimpleName:getRecordid))(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(ThisExpression))(SimpleName:getThreadLocalRequest)))(SimpleName:getSession))(BooleanLiteral:false)(SimpleName:inputmodel)(SimpleName:authToken)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:recordUpdateResult))(SimpleName:setResult)(METHOD_INVOCATION_ARGUMENTS(SimpleName:updatedRecord)))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:Exception))(SimpleName:e))(Block(IfStatement(InfixExpression(PrefixExpression(PREFIX_EXPRESSION_OPERATOR:!)(SimpleName:archived))(INFIX_EXPRESSION_OPERATOR:&&)(InfixExpression(SimpleName:connection)(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral)))(Block(TryStatement(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:connection))(SimpleName:rollback))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:SQLException))(SimpleName:e1))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:LogUtility))(SimpleName:log)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:Level.SEVERE)(MethodInvocation(SimpleName:getSession))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:messages))(SimpleName:log_db_rollback)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))(SimpleName:e1)(SimpleName:authToken))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:e1))(SimpleName:printStackTrace))))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:recordUpdateResult))(SimpleName:setFailed)(METHOD_INVOCATION_ARGUMENTS(BooleanLiteral:true))))(IfStatement(SimpleName:archived)(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:recordUpdateResult))(SimpleName:setMessage)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:messages))(SimpleName:server_record_delete_retrieve)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:recordUpdateResult))(SimpleName:setException)(METHOD_INVOCATION_ARGUMENTS(SimpleName:e))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:LogUtility))(SimpleName:log)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:Level.SEVERE)(MethodInvocation(SimpleName:getSession))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:messages))(SimpleName:server_record_delete_retrieve)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))(SimpleName:e)(SimpleName:authToken)))))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:recordUpdateResult))(SimpleName:setMessage)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:messages))(SimpleName:server_record_delete_fail)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:recordUpdateResult))(SimpleName:setException)(METHOD_INVOCATION_ARGUMENTS(ClassInstanceCreation(SimpleType(SimpleName:PersistenceException))(SimpleName:e)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:LogUtility))(SimpleName:log)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:Level.SEVERE)(MethodInvocation(SimpleName:getSession))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:messages))(SimpleName:server_record_delete_fail)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))(SimpleName:e)(SimpleName:authToken))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:GWT))(SimpleName:log)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:recordUpdateResult))(SimpleName:getMessage))(SimpleName:e))))))(Block(TryStatement(Block(IfStatement(InfixExpression(SimpleName:connection)(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:connection))(SimpleName:setAutoCommit)(METHOD_INVOCATION_ARGUMENTS(BooleanLiteral:true))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:connection))(SimpleName:close))))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:Exception))(SimpleName:e))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:LogUtility))(SimpleName:log)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:Level.SEVERE)(MethodInvocation(SimpleName:getSession))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:messages))(SimpleName:log_db_close)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))(SimpleName:e)(SimpleName:authToken)))))))))))(ReturnStatement(SimpleName:recordUpdateResult))))))