(CompilationUnit(TypeDeclaration(Modifier:public)(TYPE_DECLARATION_KIND:class)(SimpleName:Test)(MethodDeclaration(MarkerAnnotation(SimpleName:Override))(Modifier:public)(PrimitiveType:void)(SimpleName:onUpdate)(SingleVariableDeclaration(SimpleType(SimpleName:WaveViewServiceUpdate))(SimpleName:update))(Block(TryStatement(Block(ExpressionStatement(MethodInvocation(SimpleName:checkUpdateProtocolRestrictions)(METHOD_INVOCATION_ARGUMENTS(SimpleName:update)))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:ChannelException))(SimpleName:e))(Block(ExpressionStatement(MethodInvocation(SimpleName:triggerOnException)(METHOD_INVOCATION_ARGUMENTS(SimpleName:e)(ConditionalExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:update))(SimpleName:hasWaveletId))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:update))(SimpleName:getWaveletId))(NullLiteral)))))(ExpressionStatement(MethodInvocation(SimpleName:terminate)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:e))(SimpleName:toString)))))))))(SwitchStatement(SimpleName:state)(SwitchCase(SimpleName:INITIAL))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:Preconditions))(SimpleName:illegalState)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)(ThisExpression)(SimpleName:update))))(BreakStatement)(SwitchCase(SimpleName:CONNECTING))(IfStatement(PrefixExpression(PREFIX_EXPRESSION_OPERATOR:!)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:update))(SimpleName:hasChannelId)))(Block(ExpressionStatement(MethodInvocation(SimpleName:onException)(METHOD_INVOCATION_ARGUMENTS(ClassInstanceCreation(SimpleType(SimpleName:ChannelException))(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(SimpleName:waveId)(StringLiteral:<STR>)(SimpleName:update))(QualifiedName:Recoverable.NOT_RECOVERABLE)))))(ReturnStatement)))(ExpressionStatement(Assignment(SimpleName:channelId)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:update))(SimpleName:getChannelId))))(ExpressionStatement(Assignment(SimpleName:state)(ASSIGNMENT_OPERATOR:=)(QualifiedName:State.CONNECTED)))(IfStatement(InfixExpression(SimpleName:openListener)(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:openListener))(SimpleName:onConnected)))))(BreakStatement)(SwitchCase(SimpleName:CONNECTED))(IfStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:update))(SimpleName:hasChannelId))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:logger))(SimpleName:trace)))(SimpleName:log)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(SimpleName:update)))))))(IfStatement(InfixExpression(SimpleName:openListener)(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(Block(VariableDeclarationStatement(SimpleType(SimpleName:WaveletId))(VariableDeclarationFragment(SimpleName:waveletId)(ConditionalExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:update))(SimpleName:hasWaveletId))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:update))(SimpleName:getWaveletId))(NullLiteral))))(VariableDeclarationStatement(SimpleType(SimpleName:HashedVersion))(VariableDeclarationFragment(SimpleName:lastCommittedVersion)(ConditionalExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:update))(SimpleName:hasLastCommittedVersion))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:update))(SimpleName:getLastCommittedVersion))(NullLiteral))))(VariableDeclarationStatement(SimpleType(SimpleName:HashedVersion))(VariableDeclarationFragment(SimpleName:currentVersion)(ConditionalExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:update))(SimpleName:hasCurrentVersion))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:update))(SimpleName:getCurrentVersion))(NullLiteral))))(TryStatement(Block(IfStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:update))(SimpleName:hasWaveletSnapshot))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:openListener))(SimpleName:onSnapshot)(METHOD_INVOCATION_ARGUMENTS(SimpleName:waveletId)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:update))(SimpleName:getWaveletSnapshot))(SimpleName:lastCommittedVersion)(SimpleName:currentVersion)))))(IfStatement(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:update))(SimpleName:hasDeltas))(INFIX_EXPRESSION_OPERATOR:||)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:update))(SimpleName:hasLastCommittedVersion))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:update))(SimpleName:hasCurrentVersion)))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:openListener))(SimpleName:onUpdate)(METHOD_INVOCATION_ARGUMENTS(SimpleName:waveletId)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:update))(SimpleName:getDeltaList))(SimpleName:lastCommittedVersion)(SimpleName:currentVersion)))))))(IfStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:update))(SimpleName:hasMarker))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:openListener))(SimpleName:onOpenFinished))))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:ChannelException))(SimpleName:e))(Block(ExpressionStatement(MethodInvocation(SimpleName:triggerOnException)(METHOD_INVOCATION_ARGUMENTS(SimpleName:e)(SimpleName:waveletId))))(ExpressionStatement(MethodInvocation(SimpleName:terminate)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:e))(SimpleName:toString)))))))))))(BreakStatement)(SwitchCase(SimpleName:CLOSING))(IfStatement(PrefixExpression(PREFIX_EXPRESSION_OPERATOR:!)(MethodInvocation(SimpleName:hasChannelId)))(Block(IfStatement(PrefixExpression(PREFIX_EXPRESSION_OPERATOR:!)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:update))(SimpleName:hasChannelId)))(Block(ExpressionStatement(MethodInvocation(SimpleName:onException)(METHOD_INVOCATION_ARGUMENTS(ClassInstanceCreation(SimpleType(SimpleName:ChannelException))(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(SimpleName:waveId)(StringLiteral:<STR>)(SimpleName:update))(QualifiedName:Recoverable.NOT_RECOVERABLE)))))))(ExpressionStatement(Assignment(SimpleName:channelId)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:update))(SimpleName:getChannelId))))(ExpressionStatement(MethodInvocation(SimpleName:requestViewClose)))))(ExpressionStatement(Assignment(SimpleName:state)(ASSIGNMENT_OPERATOR:=)(QualifiedName:State.CLOSED)))(BreakStatement)(SwitchCase(SimpleName:CLOSED))(BreakStatement)(SwitchCase)(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:Preconditions))(SimpleName:illegalState)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(SimpleName:state))))))))))