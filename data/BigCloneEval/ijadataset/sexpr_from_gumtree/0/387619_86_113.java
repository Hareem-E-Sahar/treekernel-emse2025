(CompilationUnit(TypeDeclaration(Modifier:public)(TYPE_DECLARATION_KIND:class)(SimpleName:Test)(MethodDeclaration(Modifier:public)(PrimitiveType:void)(SimpleName:commit)(Block(IfStatement(PrefixExpression(PREFIX_EXPRESSION_OPERATOR:!)(MethodInvocation(SimpleName:isReadOnly)))(Block(EnhancedForStatement(SingleVariableDeclaration(SimpleType(SimpleName:StmResource))(SimpleName:resource))(SimpleName:writeSet)(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:resource))(SimpleName:onLockingWriteSet)(METHOD_INVOCATION_ARGUMENTS(ThisExpression))))))(VariableDeclarationStatement(Modifier:final)(PrimitiveType:long)(VariableDeclarationFragment(SimpleName:newClock)(MethodInvocation(SimpleName:incrementGlobalVersionClock))))(IfStatement(InfixExpression(InfixExpression(SimpleName:readVersion)(INFIX_EXPRESSION_OPERATOR:+)(NumberLiteral:1))(INFIX_EXPRESSION_OPERATOR:==)(SimpleName:newClock))(Block)(Block(EnhancedForStatement(SingleVariableDeclaration(SimpleType(SimpleName:StmResource))(SimpleName:resource))(SimpleName:readSet)(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:resource))(SimpleName:onValidateReadSet)(METHOD_INVOCATION_ARGUMENTS(ThisExpression))))))))(ExpressionStatement(MethodInvocation(SimpleName:doActionEnsureAllInvoked)(METHOD_INVOCATION_ARGUMENTS(ClassInstanceCreation(ParameterizedType(SimpleType(SimpleName:ResourceAction))(SimpleType(SimpleName:StmResource)))(AnonymousClassDeclaration(MethodDeclaration(Modifier:public)(PrimitiveType:void)(SimpleName:doAction)(SingleVariableDeclaration(SimpleType(SimpleName:StmResource))(SimpleName:resource))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:resource))(SimpleName:onCommit)(METHOD_INVOCATION_ARGUMENTS(ThisExpression(SimpleName:TransactionImpl))(SimpleName:newClock))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:resource))(SimpleName:onReleaseLocks)(METHOD_INVOCATION_ARGUMENTS(ThisExpression(SimpleName:TransactionImpl)))))))))(TypeLiteral(SimpleType(SimpleName:CommitFailedException)))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:writeSet))(SimpleName:iterator)))))))(ExpressionStatement(MethodInvocation(SimpleName:doActionEnsureAllInvoked)(METHOD_INVOCATION_ARGUMENTS(ClassInstanceCreation(ParameterizedType(SimpleType(SimpleName:ResourceAction))(SimpleType(SimpleName:StmResource)))(AnonymousClassDeclaration(MethodDeclaration(Modifier:public)(PrimitiveType:void)(SimpleName:doAction)(SingleVariableDeclaration(SimpleType(SimpleName:StmResource))(SimpleName:resource))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:resource))(SimpleName:onFinished)(METHOD_INVOCATION_ARGUMENTS(ThisExpression(SimpleName:TransactionImpl))(BooleanLiteral:false))))))))(TypeLiteral(SimpleType(SimpleName:RollbackFailedException)))(ClassInstanceCreation(ParameterizedType(SimpleType(SimpleName:LinkedIterator))(SimpleType(SimpleName:StmResource)))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:writeSet))(SimpleName:iterator))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:readSet))(SimpleName:iterator))))))(ExpressionStatement(MethodInvocation(SimpleName:executeActions)))))))