(CompilationUnit(TypeDeclaration(Modifier:public)(TYPE_DECLARATION_KIND:class)(SimpleName:Test)(MethodDeclaration(Modifier:public)(SimpleType(SimpleName:String))(SimpleName:generateTargetMessageAsString)(SingleVariableDeclaration(SimpleType(SimpleName:String))(SimpleName:deviceName))(SimpleType(SimpleName:MessageException))(Block(IfStatement(InfixExpression(SimpleName:deviceName)(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(Block(VariableDeclarationStatement(SimpleType(SimpleName:ProtocolIndependentMessage))(VariableDeclarationFragment(SimpleName:rawMessage)(CastExpression(SimpleType(SimpleName:ProtocolIndependentMessage))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:rawMessageCache))(SimpleName:get)(METHOD_INVOCATION_ARGUMENTS(SimpleName:deviceName))))))(IfStatement(InfixExpression(SimpleName:rawMessage)(INFIX_EXPRESSION_OPERATOR:==)(NullLiteral))(Block(VariableDeclarationStatement(SimpleType(SimpleName:MessageRequestor))(VariableDeclarationFragment(SimpleName:messageRequestor)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:MessageRequestor))(SimpleName:getInstance))))(ExpressionStatement(Assignment(SimpleName:rawMessage)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:messageRequestor))(SimpleName:getChannelIndependentMessage)(METHOD_INVOCATION_ARGUMENTS(SimpleName:deviceName)(ThisExpression)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:rawMessageCache))(SimpleName:put)(METHOD_INVOCATION_ARGUMENTS(SimpleName:deviceName)(SimpleName:rawMessage))))))(VariableDeclarationStatement(SimpleType(SimpleName:MessageAssembler))(VariableDeclarationFragment(SimpleName:messageAssembler)(ClassInstanceCreation(SimpleType(SimpleName:PlainTextMessageAssembler)))))(ReturnStatement(CastExpression(SimpleType(SimpleName:String))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:messageAssembler))(SimpleName:assembleMessage)(METHOD_INVOCATION_ARGUMENTS(SimpleName:rawMessage)(SimpleName:messageAttachments))))))(Block(ThrowStatement(ClassInstanceCreation(SimpleType(SimpleName:MessageException))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:LOCALIZER))(SimpleName:format)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))))))))))