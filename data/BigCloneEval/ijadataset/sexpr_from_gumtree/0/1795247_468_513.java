(CompilationUnit(TypeDeclaration(Modifier:public)(TYPE_DECLARATION_KIND:class)(SimpleName:Test)(MethodDeclaration(Modifier:private)(SimpleType(SimpleName:Message))(SimpleName:handleSubscribeMessage)(SingleVariableDeclaration(SimpleType(SimpleName:CommandMessage))(SimpleName:message))(Block(VariableDeclarationStatement(SimpleType(SimpleName:GraniteContext))(VariableDeclarationFragment(SimpleName:context)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:GraniteContext))(SimpleName:getCurrentInstance))))(VariableDeclarationStatement(SimpleType(SimpleName:Destination))(VariableDeclarationFragment(SimpleName:destination)(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:context))(SimpleName:getServicesConfig)))(SimpleName:findDestinationById)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:message))(SimpleName:getMessageRefType))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:message))(SimpleName:getDestination))))))(IfStatement(InfixExpression(SimpleName:destination)(INFIX_EXPRESSION_OPERATOR:==)(NullLiteral))(ReturnStatement(MethodInvocation(SimpleName:getInvalidDestinationError)(METHOD_INVOCATION_ARGUMENTS(SimpleName:message)))))(VariableDeclarationStatement(SimpleType(SimpleName:GravityInvocationContext))(VariableDeclarationFragment(SimpleName:invocationContext)(ClassInstanceCreation(SimpleType(SimpleName:GravityInvocationContext))(SimpleName:message)(SimpleName:destination))))(IfStatement(InstanceofExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:destination))(SimpleName:getSecurizer))(SimpleType(SimpleName:GravityDestinationSecurizer)))(Block(TryStatement(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(ParenthesizedExpression(CastExpression(SimpleType(SimpleName:GravityDestinationSecurizer))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:destination))(SimpleName:getSecurizer)))))(SimpleName:canSubscribe)(METHOD_INVOCATION_ARGUMENTS(SimpleName:invocationContext)))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:Exception))(SimpleName:e))(Block(ReturnStatement(ClassInstanceCreation(SimpleType(SimpleName:ErrorMessage))(SimpleName:message)(SimpleName:e))))))))(VariableDeclarationStatement(SimpleType(SimpleName:GraniteConfig))(VariableDeclarationFragment(SimpleName:config)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:context))(SimpleName:getGraniteConfig))))(IfStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:config))(SimpleName:hasSecurityService))(Block(TryStatement(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:config))(SimpleName:getSecurityService)))(SimpleName:authorize)(METHOD_INVOCATION_ARGUMENTS(SimpleName:invocationContext)))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:Exception))(SimpleName:e))(Block(ReturnStatement(ClassInstanceCreation(SimpleType(SimpleName:ErrorMessage))(SimpleName:message)(SimpleName:e))))))))(VariableDeclarationStatement(SimpleType(SimpleName:Channel))(VariableDeclarationFragment(SimpleName:channel)(MethodInvocation(SimpleName:getChannel)(METHOD_INVOCATION_ARGUMENTS(CastExpression(SimpleType(SimpleName:String))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:message))(SimpleName:getClientId)))))))(IfStatement(InfixExpression(SimpleName:channel)(INFIX_EXPRESSION_OPERATOR:==)(NullLiteral))(ReturnStatement(MethodInvocation(SimpleName:handleUnknownClientMessage)(METHOD_INVOCATION_ARGUMENTS(SimpleName:message)))))(VariableDeclarationStatement(SimpleType(SimpleName:String))(VariableDeclarationFragment(SimpleName:subscriptionId)(CastExpression(SimpleType(SimpleName:String))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:message))(SimpleName:getHeader)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:AsyncMessage.DESTINATION_CLIENT_ID_HEADER))))))(IfStatement(InfixExpression(SimpleName:subscriptionId)(INFIX_EXPRESSION_OPERATOR:==)(NullLiteral))(Block(ExpressionStatement(Assignment(SimpleName:subscriptionId)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:UUIDUtil))(SimpleName:randomUUID))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:message))(SimpleName:setHeader)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:AsyncMessage.DESTINATION_CLIENT_ID_HEADER)(SimpleName:subscriptionId))))))(VariableDeclarationStatement(SimpleType(SimpleName:HttpSession))(VariableDeclarationFragment(SimpleName:session)(NullLiteral)))(IfStatement(InstanceofExpression(SimpleName:context)(SimpleType(SimpleName:HttpGraniteContext)))(ExpressionStatement(Assignment(SimpleName:session)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(ParenthesizedExpression(CastExpression(SimpleType(SimpleName:HttpGraniteContext))(SimpleName:context))))(SimpleName:getSession)(METHOD_INVOCATION_ARGUMENTS(BooleanLiteral:false))))))(IfStatement(InfixExpression(InfixExpression(SimpleName:session)(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(INFIX_EXPRESSION_OPERATOR:&&)(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(QualifiedName:Boolean.TRUE))(SimpleName:toString)))(SimpleName:equals)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:destination))(SimpleName:getProperties)))(SimpleName:get)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))))(Block(VariableDeclarationStatement(SimpleType(SimpleName:String))(VariableDeclarationFragment(SimpleName:selector)(CastExpression(SimpleType(SimpleName:String))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:session))(SimpleName:getAttribute)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:destination))(SimpleName:getId))))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:log))(SimpleName:debug)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:session))(SimpleName:getId))(SimpleName:selector))))(IfStatement(InfixExpression(SimpleName:selector)(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:message))(SimpleName:setHeader)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:CommandMessage.SELECTOR_HEADER)(SimpleName:selector)))))))(VariableDeclarationStatement(SimpleType(SimpleName:ServiceAdapter))(VariableDeclarationFragment(SimpleName:adapter)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:adapterFactory))(SimpleName:getServiceAdapter)(METHOD_INVOCATION_ARGUMENTS(SimpleName:message)))))(VariableDeclarationStatement(SimpleType(SimpleName:AsyncMessage))(VariableDeclarationFragment(SimpleName:reply)(CastExpression(SimpleType(SimpleName:AsyncMessage))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:adapter))(SimpleName:manage)(METHOD_INVOCATION_ARGUMENTS(SimpleName:channel)(SimpleName:message))))))(ExpressionStatement(MethodInvocation(SimpleName:postManage)(METHOD_INVOCATION_ARGUMENTS(SimpleName:channel))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:reply))(SimpleName:setDestination)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:message))(SimpleName:getDestination)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:reply))(SimpleName:setClientId)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:channel))(SimpleName:getId)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:reply))(SimpleName:getHeaders)))(SimpleName:putAll)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:message))(SimpleName:getHeaders)))))(IfStatement(InfixExpression(InfixExpression(SimpleName:session)(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(INFIX_EXPRESSION_OPERATOR:&&)(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:message))(SimpleName:getDestination))(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral)))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:session))(SimpleName:setAttribute)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:message))(SimpleName:getDestination)))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:channel))(SimpleName:getId)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:session))(SimpleName:setAttribute)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:message))(SimpleName:getDestination)))(SimpleName:subscriptionId))))))(ReturnStatement(SimpleName:reply))))))