(CompilationUnit(TypeDeclaration(Modifier:public)(TYPE_DECLARATION_KIND:class)(SimpleName:Test)(MethodDeclaration(Modifier:public)(Modifier:static)(SimpleType(SimpleName:Authentication))(SimpleName:login)(SingleVariableDeclaration(SimpleType(SimpleName:HttpServletRequest))(SimpleName:request))(SingleVariableDeclaration(SimpleType(SimpleName:HttpServletResponse))(SimpleName:response))(SimpleType(SimpleName:IOException))(SimpleType(SimpleName:ServletException))(Block(VariableDeclarationStatement(PrimitiveType:boolean)(VariableDeclarationFragment(SimpleName:failOnDoesntExist)(MethodInvocation(METHOD_INVOCATION_RECEIVER(StringLiteral:<STR>))(SimpleName:equalsIgnoreCase)(METHOD_INVOCATION_ARGUMENTS(CastExpression(SimpleType(SimpleName:String))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:request))(SimpleName:getAttribute)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))))))(VariableDeclarationStatement(SimpleType(SimpleName:String))(VariableDeclarationFragment(SimpleName:auth)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:request))(SimpleName:getHeader)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:LOG))(SimpleName:finest)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(SimpleName:auth)))))(VariableDeclarationStatement(SimpleType(SimpleName:String))(VariableDeclarationFragment(SimpleName:decodedBytes)(ClassInstanceCreation(SimpleType(SimpleName:String))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:Base64))(SimpleName:decode)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:auth))(SimpleName:substring)(METHOD_INVOCATION_ARGUMENTS(NumberLiteral:6))))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:LOG))(SimpleName:finest)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(SimpleName:decodedBytes)))))(VariableDeclarationStatement(ArrayType(SimpleType(SimpleName:String))(Dimension))(VariableDeclarationFragment(SimpleName:nonceParts)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:decodedBytes))(SimpleName:split)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:LOG))(SimpleName:finest)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(ArrayAccess(SimpleName:nonceParts)(NumberLiteral:0))(StringLiteral:<STR>)(ArrayAccess(SimpleName:nonceParts)(NumberLiteral:1))))))(VariableDeclarationStatement(ArrayType(SimpleType(SimpleName:String))(Dimension))(VariableDeclarationFragment(SimpleName:authParts)(MethodInvocation(METHOD_INVOCATION_RECEIVER(ArrayAccess(SimpleName:nonceParts)(NumberLiteral:0)))(SimpleName:split)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))))(VariableDeclarationStatement(SimpleType(SimpleName:String))(VariableDeclarationFragment(SimpleName:username)(ArrayAccess(SimpleName:authParts)(NumberLiteral:0))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:LOG))(SimpleName:finest)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(SimpleName:username)))))(VariableDeclarationStatement(SimpleType(SimpleName:String))(VariableDeclarationFragment(SimpleName:password)(ArrayAccess(SimpleName:authParts)(NumberLiteral:1))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:LOG))(SimpleName:finest)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(SimpleName:password)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:LOG))(SimpleName:finest)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(ArrayAccess(SimpleName:nonceParts)(NumberLiteral:1))))))(VariableDeclarationStatement(SimpleType(SimpleName:String))(VariableDeclarationFragment(SimpleName:passwordDigest)(NullLiteral)))(VariableDeclarationStatement(SimpleType(SimpleName:Authentication))(VariableDeclarationFragment(SimpleName:authn)(NullLiteral)))(TryStatement(Block(ExpressionStatement(Assignment(SimpleName:authn)(ASSIGNMENT_OPERATOR:=)(CastExpression(SimpleType(SimpleName:Authentication))(MethodInvocation(METHOD_INVOCATION_RECEIVER(QualifiedName:DBClient.orm))(SimpleName:queryForObject)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)(SimpleName:username))))))(IfStatement(InfixExpression(SimpleName:authn)(INFIX_EXPRESSION_OPERATOR:==)(NullLiteral))(Block(IfStatement(SimpleName:failOnDoesntExist)(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:response))(SimpleName:sendError)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:HttpServletResponse.SC_FORBIDDEN)(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(SimpleName:username)(StringLiteral:<STR>)(SimpleName:password)))))(ReturnStatement(NullLiteral)))(Block(ExpressionStatement(Assignment(SimpleName:authn)(ASSIGNMENT_OPERATOR:=)(ClassInstanceCreation(SimpleType(SimpleName:Authentication)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:authn))(SimpleName:setUsername)(METHOD_INVOCATION_ARGUMENTS(SimpleName:username))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:authn))(SimpleName:setPassword)(METHOD_INVOCATION_ARGUMENTS(SimpleName:password))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:authn))(SimpleName:setUserId)(METHOD_INVOCATION_ARGUMENTS(PrefixExpression(PREFIX_EXPRESSION_OPERATOR:-)(NumberLiteral:1)))))(ReturnStatement(SimpleName:authn))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:LOG))(SimpleName:finest)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:authn))(SimpleName:getPassword))))))(VariableDeclarationStatement(SimpleType(SimpleName:String))(VariableDeclarationFragment(SimpleName:hashedDBPassword)(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:authn))(SimpleName:getPassword))(INFIX_EXPRESSION_OPERATOR:+)(StringLiteral:<STR>)(ArrayAccess(SimpleName:nonceParts)(NumberLiteral:1)))))(VariableDeclarationStatement(SimpleType(SimpleName:MessageDigest))(VariableDeclarationFragment(SimpleName:md5Digest)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:MessageDigest))(SimpleName:getInstance)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))))(VariableDeclarationStatement(ArrayType(PrimitiveType:byte)(Dimension))(VariableDeclarationFragment(SimpleName:digestBytes)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:md5Digest))(SimpleName:digest)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:hashedDBPassword))(SimpleName:getBytes))))))(ExpressionStatement(Assignment(SimpleName:passwordDigest)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:Base64))(SimpleName:encodeBytes)(METHOD_INVOCATION_ARGUMENTS(SimpleName:digestBytes))))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:Exception))(SimpleName:ex))(Block(IfStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:LOG))(SimpleName:isLoggable)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:Level.FINEST)))(Block(VariableDeclarationStatement(SimpleType(SimpleName:StringWriter))(VariableDeclarationFragment(SimpleName:writer)(ClassInstanceCreation(SimpleType(SimpleName:StringWriter)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:ex))(SimpleName:printStackTrace)(METHOD_INVOCATION_ARGUMENTS(ClassInstanceCreation(SimpleType(SimpleName:PrintWriter))(SimpleName:writer)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:LOG))(SimpleName:finest)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:writer))(SimpleName:toString)))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:response))(SimpleName:sendError)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:HttpServletResponse.SC_INTERNAL_SERVER_ERROR)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:ex))(SimpleName:getMessage)))))(ThrowStatement(ClassInstanceCreation(SimpleType(SimpleName:ServletException))(SimpleName:ex))))))(VariableDeclarationStatement(SimpleType(SimpleName:Object))(VariableDeclarationFragment(SimpleName:rowExists)(NullLiteral)))(VariableDeclarationStatement(SimpleType(SimpleName:Nonce))(VariableDeclarationFragment(SimpleName:nonce)(ClassInstanceCreation(SimpleType(SimpleName:Nonce)))))(TryStatement(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:nonce))(SimpleName:setUsername)(METHOD_INVOCATION_ARGUMENTS(SimpleName:username))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:nonce))(SimpleName:setUserId)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:authn))(SimpleName:getUserId)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:nonce))(SimpleName:setNonce)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:Long))(SimpleName:parseLong)(METHOD_INVOCATION_ARGUMENTS(ArrayAccess(SimpleName:nonceParts)(NumberLiteral:1)))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:nonce))(SimpleName:setNonceAsDate)(METHOD_INVOCATION_ARGUMENTS(ClassInstanceCreation(SimpleType(SimpleName:Date))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:nonce))(SimpleName:getNonce))))))(ExpressionStatement(Assignment(SimpleName:rowExists)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(QualifiedName:DBClient.orm))(SimpleName:queryForObject)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)(SimpleName:nonce))))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:Exception))(SimpleName:ex))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:response))(SimpleName:sendError)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:HttpServletResponse.SC_INTERNAL_SERVER_ERROR)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:ex))(SimpleName:getMessage)))))(ThrowStatement(ClassInstanceCreation(SimpleType(SimpleName:ServletException))(SimpleName:ex))))))(IfStatement(InfixExpression(InfixExpression(SimpleName:rowExists)(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(INFIX_EXPRESSION_OPERATOR:||)(InfixExpression(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:nonce))(SimpleName:getNonce))(INFIX_EXPRESSION_OPERATOR:+)(NumberLiteral:1800000l))(INFIX_EXPRESSION_OPERATOR:<)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:System))(SimpleName:currentTimeMillis))))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:response))(SimpleName:sendError)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:HttpServletResponse.SC_FORBIDDEN)(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(SimpleName:username)(StringLiteral:<STR>)(SimpleName:password)))))(ThrowStatement(ClassInstanceCreation(SimpleType(SimpleName:ServletException))(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(SimpleName:username)(StringLiteral:<STR>)(SimpleName:password)))))(Block(VariableDeclarationStatement(SimpleType(SimpleName:Object))(VariableDeclarationFragment(SimpleName:txOwner)(ClassInstanceCreation(SimpleType(SimpleName:Object)))))(TryStatement(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:DBClient))(SimpleName:startTransaction)(METHOD_INVOCATION_ARGUMENTS(SimpleName:txOwner))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(QualifiedName:DBClient.orm))(SimpleName:update)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)(SimpleName:nonce))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:DBClient))(SimpleName:commitTransaction)(METHOD_INVOCATION_ARGUMENTS(SimpleName:txOwner)))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:Exception))(SimpleName:ex))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:response))(SimpleName:sendError)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:HttpServletResponse.SC_INTERNAL_SERVER_ERROR)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:ex))(SimpleName:getMessage)))))(ThrowStatement(ClassInstanceCreation(SimpleType(SimpleName:ServletException))(SimpleName:ex)))))(Block(TryStatement(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:DBClient))(SimpleName:endTransaction)(METHOD_INVOCATION_ARGUMENTS(SimpleName:txOwner)))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:Exception))(SimpleName:ex))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:response))(SimpleName:sendError)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:HttpServletResponse.SC_INTERNAL_SERVER_ERROR)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:ex))(SimpleName:getMessage)))))(ThrowStatement(ClassInstanceCreation(SimpleType(SimpleName:ServletException))(SimpleName:ex))))))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:LOG))(SimpleName:finest)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(SimpleName:passwordDigest)))))(IfStatement(PrefixExpression(PREFIX_EXPRESSION_OPERATOR:!)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:password))(SimpleName:equals)(METHOD_INVOCATION_ARGUMENTS(SimpleName:passwordDigest))))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:response))(SimpleName:sendError)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:HttpServletResponse.SC_FORBIDDEN)(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(SimpleName:username)(StringLiteral:<STR>)(SimpleName:password)))))(ThrowStatement(ClassInstanceCreation(SimpleType(SimpleName:ServletException))(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(SimpleName:username)(StringLiteral:<STR>)(SimpleName:password))))))(ReturnStatement(SimpleName:authn))))))