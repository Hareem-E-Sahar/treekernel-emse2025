(CompilationUnit(TypeDeclaration(Modifier:public)(TYPE_DECLARATION_KIND:class)(SimpleName:Test)(MethodDeclaration(Modifier:public)(SimpleType(SimpleName:ChannelBuffer))(SimpleName:encode)(SingleVariableDeclaration(Modifier:final)(SimpleType(SimpleName:RtmpMessage))(SimpleName:message))(Block(VariableDeclarationStatement(Modifier:final)(SimpleType(SimpleName:ChannelBuffer))(VariableDeclarationFragment(SimpleName:in)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:message))(SimpleName:encode))))(VariableDeclarationStatement(Modifier:final)(SimpleType(SimpleName:RtmpHeader))(VariableDeclarationFragment(SimpleName:header)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:message))(SimpleName:getHeader))))(IfStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:header))(SimpleName:isChunkSize))(Block(VariableDeclarationStatement(Modifier:final)(SimpleType(SimpleName:ChunkSize))(VariableDeclarationFragment(SimpleName:csMessage)(CastExpression(SimpleType(SimpleName:ChunkSize))(SimpleName:message))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:logger))(SimpleName:debug)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)(SimpleName:csMessage))))(ExpressionStatement(Assignment(SimpleName:chunkSize)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:csMessage))(SimpleName:getChunkSize)))))(IfStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:header))(SimpleName:isControl))(Block(VariableDeclarationStatement(Modifier:final)(SimpleType(SimpleName:Control))(VariableDeclarationFragment(SimpleName:control)(CastExpression(SimpleType(SimpleName:Control))(SimpleName:message))))(IfStatement(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:control))(SimpleName:getType))(INFIX_EXPRESSION_OPERATOR:==)(QualifiedName:Control.Type.STREAM_BEGIN))(Block(ExpressionStatement(MethodInvocation(SimpleName:clearPrevHeaders))))))))(VariableDeclarationStatement(Modifier:final)(PrimitiveType:int)(VariableDeclarationFragment(SimpleName:channelId)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:header))(SimpleName:getChannelId))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:header))(SimpleName:setSize)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:in))(SimpleName:readableBytes)))))(VariableDeclarationStatement(Modifier:final)(SimpleType(SimpleName:RtmpHeader))(VariableDeclarationFragment(SimpleName:prevHeader)(ArrayAccess(SimpleName:channelPrevHeaders)(SimpleName:channelId))))(IfStatement(InfixExpression(InfixExpression(InfixExpression(SimpleName:prevHeader)(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(INFIX_EXPRESSION_OPERATOR:&&)(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:header))(SimpleName:getStreamId))(INFIX_EXPRESSION_OPERATOR:>)(NumberLiteral:0)))(INFIX_EXPRESSION_OPERATOR:&&)(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:header))(SimpleName:getTime))(INFIX_EXPRESSION_OPERATOR:>)(NumberLiteral:0)))(Block(IfStatement(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:header))(SimpleName:getSize))(INFIX_EXPRESSION_OPERATOR:==)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:prevHeader))(SimpleName:getSize)))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:header))(SimpleName:setHeaderType)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:RtmpHeader.Type.SMALL)))))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:header))(SimpleName:setHeaderType)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:RtmpHeader.Type.MEDIUM))))))(VariableDeclarationStatement(Modifier:final)(PrimitiveType:int)(VariableDeclarationFragment(SimpleName:deltaTime)(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:header))(SimpleName:getTime))(INFIX_EXPRESSION_OPERATOR:-)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:prevHeader))(SimpleName:getTime)))))(IfStatement(InfixExpression(SimpleName:deltaTime)(INFIX_EXPRESSION_OPERATOR:<)(NumberLiteral:0))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:logger))(SimpleName:warn)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)(SimpleName:header))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:header))(SimpleName:setDeltaTime)(METHOD_INVOCATION_ARGUMENTS(NumberLiteral:0)))))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:header))(SimpleName:setDeltaTime)(METHOD_INVOCATION_ARGUMENTS(SimpleName:deltaTime)))))))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:header))(SimpleName:setHeaderType)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:RtmpHeader.Type.LARGE))))))(ExpressionStatement(Assignment(ArrayAccess(SimpleName:channelPrevHeaders)(SimpleName:channelId))(ASSIGNMENT_OPERATOR:=)(SimpleName:header)))(IfStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:logger))(SimpleName:isDebugEnabled))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:logger))(SimpleName:debug)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)(SimpleName:message))))))(VariableDeclarationStatement(Modifier:final)(SimpleType(SimpleName:ChannelBuffer))(VariableDeclarationFragment(SimpleName:out)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:ChannelBuffers))(SimpleName:buffer)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(QualifiedName:RtmpHeader.MAX_ENCODED_SIZE)(INFIX_EXPRESSION_OPERATOR:+)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:header))(SimpleName:getSize))(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:header))(SimpleName:getSize))(INFIX_EXPRESSION_OPERATOR:/)(SimpleName:chunkSize)))))))(VariableDeclarationStatement(PrimitiveType:boolean)(VariableDeclarationFragment(SimpleName:first)(BooleanLiteral:true)))(WhileStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:in))(SimpleName:readable))(Block(VariableDeclarationStatement(Modifier:final)(PrimitiveType:int)(VariableDeclarationFragment(SimpleName:size)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:Math))(SimpleName:min)(METHOD_INVOCATION_ARGUMENTS(SimpleName:chunkSize)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:in))(SimpleName:readableBytes))))))(IfStatement(SimpleName:first)(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:header))(SimpleName:encode)(METHOD_INVOCATION_ARGUMENTS(SimpleName:out))))(ExpressionStatement(Assignment(SimpleName:first)(ASSIGNMENT_OPERATOR:=)(BooleanLiteral:false))))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:out))(SimpleName:writeBytes)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:header))(SimpleName:getTinyHeader)))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:in))(SimpleName:readBytes)(METHOD_INVOCATION_ARGUMENTS(SimpleName:out)(SimpleName:size))))))(ReturnStatement(SimpleName:out))))))