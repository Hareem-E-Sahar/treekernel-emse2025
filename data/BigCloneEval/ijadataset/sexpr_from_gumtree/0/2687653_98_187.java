(CompilationUnit(TypeDeclaration(Modifier:public)(TYPE_DECLARATION_KIND:class)(SimpleName:Test)(MethodDeclaration(MarkerAnnotation(SimpleName:Override))(Modifier:protected)(PrimitiveType:void)(SimpleName:doPost)(SingleVariableDeclaration(SimpleType(SimpleName:HttpServletRequest))(SimpleName:request))(SingleVariableDeclaration(SimpleType(SimpleName:HttpServletResponse))(SimpleName:response))(SimpleType(SimpleName:ServletException))(SimpleType(SimpleName:IOException))(Block(IfStatement(MethodInvocation(SimpleName:doAuth)(METHOD_INVOCATION_ARGUMENTS(SimpleName:request)(SimpleName:response)))(Block(VariableDeclarationStatement(SimpleType(SimpleName:Connection))(VariableDeclarationFragment(SimpleName:conn)(NullLiteral)))(TryStatement(Block(VariableDeclarationStatement(PrimitiveType:int)(VariableDeclarationFragment(SimpleName:UID)(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:icsm))(SimpleName:getIntChatSession)(METHOD_INVOCATION_ARGUMENTS(SimpleName:request))))(SimpleName:getUID))))(ExpressionStatement(Assignment(SimpleName:conn)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(SimpleName:getJDBCConnection)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:icsm))(SimpleName:getHeavyDatabaseConnectionPool))(SimpleName:request)(SimpleName:response)(QualifiedName:HttpServletResponse.SC_SERVICE_UNAVAILABLE)))))(IfStatement(InfixExpression(SimpleName:conn)(INFIX_EXPRESSION_OPERATOR:==)(NullLiteral))(ReturnStatement))(VariableDeclarationStatement(SimpleType(SimpleName:ResultSet))(VariableDeclarationFragment(SimpleName:rs)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:IntChatDatabaseOperations))(SimpleName:executeQuery)(METHOD_INVOCATION_ARGUMENTS(SimpleName:conn)(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(QualifiedName:IntChatConstants.MessageTemplates.IC_FILES)(StringLiteral:<STR>))))))(IfStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:rs))(SimpleName:next))(Block(VariableDeclarationStatement(PrimitiveType:int)(VariableDeclarationFragment(SimpleName:fileTypeID)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:rs))(SimpleName:getInt)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))))(VariableDeclarationStatement(SimpleType(SimpleName:String))(VariableDeclarationFragment(SimpleName:recipients)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:request))(SimpleName:getHeader)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:IntChatConstants.HEADER_FILERECIPIENTS)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:rs))(SimpleName:getStatement)))(SimpleName:close)))(ExpressionStatement(Assignment(SimpleName:rs)(ASSIGNMENT_OPERATOR:=)(NullLiteral)))(IfStatement(InfixExpression(SimpleName:recipients)(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(Block(VariableDeclarationStatement(ParameterizedType(SimpleType(SimpleName:HashMap))(SimpleType(SimpleName:String))(SimpleType(SimpleName:String)))(VariableDeclarationFragment(SimpleName:hm)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:Tools))(SimpleName:parseMultiparamLine)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:request))(SimpleName:getHeader)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))))))(VariableDeclarationStatement(SimpleType(SimpleName:String))(VariableDeclarationFragment(SimpleName:fileName)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:URLDecoder))(SimpleName:decode)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:hm))(SimpleName:get)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))(QualifiedName:IntChatServerDefaults.ENCODING)))))(VariableDeclarationStatement(PrimitiveType:long)(VariableDeclarationFragment(SimpleName:fileLength)(ParenthesizedExpression(ConditionalExpression(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:request))(SimpleName:getHeader)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:Long))(SimpleName:parseLong)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:request))(SimpleName:getHeader)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))))(PrefixExpression(PREFIX_EXPRESSION_OPERATOR:-)(NumberLiteral:1))))))(ExpressionStatement(Assignment(SimpleName:fileLength)(ASSIGNMENT_OPERATOR:=)(ParenthesizedExpression(ConditionalExpression(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:request))(SimpleName:getHeader)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:IntChatConstants.HEADER_FILELENGTH)))(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:Long))(SimpleName:parseLong)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:request))(SimpleName:getHeader)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:IntChatConstants.HEADER_FILELENGTH)))))(SimpleName:fileLength)))))(VariableDeclarationStatement(PrimitiveType:long)(VariableDeclarationFragment(SimpleName:maxFileSize)(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:RuntimeParameters))(SimpleName:getIntValue)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:ParameterNames.MAX_FILE_SIZE)))(INFIX_EXPRESSION_OPERATOR:*)(NumberLiteral:1048576))))(IfStatement(InfixExpression(InfixExpression(SimpleName:maxFileSize)(INFIX_EXPRESSION_OPERATOR:>)(NumberLiteral:0))(INFIX_EXPRESSION_OPERATOR:&&)(InfixExpression(SimpleName:fileLength)(INFIX_EXPRESSION_OPERATOR:>)(SimpleName:maxFileSize)))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:request))(SimpleName:getInputStream)))(SimpleName:close)))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:response))(SimpleName:sendError)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:HttpServletResponse.SC_REQUEST_ENTITY_TOO_LARGE))))(ReturnStatement)))(VariableDeclarationStatement(PrimitiveType:long)(VariableDeclarationFragment(SimpleName:now)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:System))(SimpleName:currentTimeMillis))))(VariableDeclarationStatement(PrimitiveType:long)(VariableDeclarationFragment(SimpleName:nextid)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:ic_messages_id_seq))(SimpleName:nextval))))(VariableDeclarationStatement(SimpleType(SimpleName:IntChatServletInputStream))(VariableDeclarationFragment(SimpleName:in)(ClassInstanceCreation(SimpleType(SimpleName:IntChatServletInputStream))(SimpleName:request))))(VariableDeclarationStatement(SimpleType(SimpleName:IntChatMessage))(VariableDeclarationFragment(SimpleName:icm)(NullLiteral)))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:conn))(SimpleName:setAutoCommit)(METHOD_INVOCATION_ARGUMENTS(BooleanLiteral:false))))(TryStatement(Block(VariableDeclarationStatement(SimpleType(SimpleName:PreparedStatement))(VariableDeclarationFragment(SimpleName:ps)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:conn))(SimpleName:prepareStatement)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:ps))(SimpleName:setLong)(METHOD_INVOCATION_ARGUMENTS(NumberLiteral:1)(SimpleName:nextid))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:ps))(SimpleName:setInt)(METHOD_INVOCATION_ARGUMENTS(NumberLiteral:2)(SimpleName:fileTypeID))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:ps))(SimpleName:setString)(METHOD_INVOCATION_ARGUMENTS(NumberLiteral:3)(SimpleName:fileName))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:ps))(SimpleName:setString)(METHOD_INVOCATION_ARGUMENTS(NumberLiteral:4)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:Long))(SimpleName:toString)(METHOD_INVOCATION_ARGUMENTS(SimpleName:fileLength))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:ps))(SimpleName:setLong)(METHOD_INVOCATION_ARGUMENTS(NumberLiteral:5)(SimpleName:now))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:ps))(SimpleName:setInt)(METHOD_INVOCATION_ARGUMENTS(NumberLiteral:6)(SimpleName:UID))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:ps))(SimpleName:executeUpdate)))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:ps))(SimpleName:close)))(IfStatement(PrefixExpression(PREFIX_EXPRESSION_OPERATOR:!)(MethodInvocation(SimpleName:insertBLOB)(METHOD_INVOCATION_ARGUMENTS(SimpleName:conn)(SimpleName:in)(SimpleName:fileLength)(SimpleName:nextid)(SimpleName:maxFileSize))))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:conn))(SimpleName:rollback)))(ReturnStatement)))(ExpressionStatement(Assignment(SimpleName:icm)(ASSIGNMENT_OPERATOR:=)(ClassInstanceCreation(SimpleType(SimpleName:IntChatMessage))(BooleanLiteral:false)(SimpleName:fileTypeID)(NullLiteral)(NullLiteral))))(VariableDeclarationStatement(ArrayType(SimpleType(SimpleName:String))(Dimension))(VariableDeclarationFragment(SimpleName:id)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:recipients))(SimpleName:split)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))))(VariableDeclarationStatement(PrimitiveType:int)(VariableDeclarationFragment(SimpleName:id1)))(ForStatement(VariableDeclarationExpression(PrimitiveType:int)(VariableDeclarationFragment(SimpleName:i)(NumberLiteral:0)))(InfixExpression(SimpleName:i)(INFIX_EXPRESSION_OPERATOR:<)(QualifiedName:id.length))(PostfixExpression(SimpleName:i)(POSTFIX_EXPRESSION_OPERATOR:++))(Block(ExpressionStatement(Assignment(SimpleName:id1)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:Integer))(SimpleName:parseInt)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(ArrayAccess(SimpleName:id)(SimpleName:i)))(SimpleName:trim))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:IntChatDatabaseOperations))(SimpleName:executeUpdate)(METHOD_INVOCATION_ARGUMENTS(SimpleName:conn)(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(SimpleName:nextid)(StringLiteral:<STR>)(SimpleName:id1)(StringLiteral:<STR>)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:icm))(SimpleName:addTo)(METHOD_INVOCATION_ARGUMENTS(SimpleName:id1))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:conn))(SimpleName:commit))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:Exception))(SimpleName:e))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:conn))(SimpleName:rollback)))(ThrowStatement(SimpleName:e))))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:conn))(SimpleName:setAutoCommit)(METHOD_INVOCATION_ARGUMENTS(BooleanLiteral:true))))))(IfStatement(InfixExpression(SimpleName:icm)(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:icm))(SimpleName:setID)(METHOD_INVOCATION_ARGUMENTS(SimpleName:nextid))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:icm))(SimpleName:setDate)(METHOD_INVOCATION_ARGUMENTS(ClassInstanceCreation(SimpleType(SimpleName:Timestamp))(InfixExpression(SimpleName:now)(INFIX_EXPRESSION_OPERATOR:-)(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:TimeZone))(SimpleName:getDefault)))(SimpleName:getOffset)(METHOD_INVOCATION_ARGUMENTS(SimpleName:now))))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:icm))(SimpleName:setFrom)(METHOD_INVOCATION_ARGUMENTS(SimpleName:UID))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:icm))(SimpleName:setHeadText)(METHOD_INVOCATION_ARGUMENTS(SimpleName:fileName))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:icm))(SimpleName:setBodyText)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:Long))(SimpleName:toString)(METHOD_INVOCATION_ARGUMENTS(SimpleName:fileLength))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:icsm))(SimpleName:onClientSentMessage)(METHOD_INVOCATION_ARGUMENTS(SimpleName:icm))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:response))(SimpleName:setStatus)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:HttpServletResponse.SC_OK)))))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:response))(SimpleName:setStatus)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:HttpServletResponse.SC_BAD_REQUEST)))))))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:response))(SimpleName:setStatus)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:HttpServletResponse.SC_NOT_FOUND))))))(IfStatement(InfixExpression(SimpleName:rs)(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:rs))(SimpleName:getStatement)))(SimpleName:close)))(ExpressionStatement(Assignment(SimpleName:rs)(ASSIGNMENT_OPERATOR:=)(NullLiteral))))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:RetryRequest))(SimpleName:rr))(Block(ThrowStatement(SimpleName:rr))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:Exception))(SimpleName:e))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:Tools))(SimpleName:makeErrorResponse)(METHOD_INVOCATION_ARGUMENTS(SimpleName:request)(SimpleName:response)(QualifiedName:HttpServletResponse.SC_INTERNAL_SERVER_ERROR)(SimpleName:e))))))(Block(TryStatement(Block(IfStatement(InfixExpression(SimpleName:conn)(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:icsm))(SimpleName:getHeavyDatabaseConnectionPool)))(SimpleName:releaseConnection)(METHOD_INVOCATION_ARGUMENTS(SimpleName:conn))))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:Exception))(SimpleName:e))(Block)))))))))))