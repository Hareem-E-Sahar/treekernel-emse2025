(CompilationUnit(TypeDeclaration(Modifier:public)(TYPE_DECLARATION_KIND:class)(SimpleName:Test)(MethodDeclaration(MarkerAnnotation(SimpleName:Test))(Modifier:public)(PrimitiveType:void)(SimpleName:testHandleMessageInvalidIntegritySignature)(SimpleType(SimpleName:Exception))(Block(VariableDeclarationStatement(SimpleType(SimpleName:KeyPair))(VariableDeclarationFragment(SimpleName:keyPair)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:MiscTestUtils))(SimpleName:generateKeyPair))))(VariableDeclarationStatement(SimpleType(SimpleName:DateTime))(VariableDeclarationFragment(SimpleName:notBefore)(ClassInstanceCreation(SimpleType(SimpleName:DateTime)))))(VariableDeclarationStatement(SimpleType(SimpleName:DateTime))(VariableDeclarationFragment(SimpleName:notAfter)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:notBefore))(SimpleName:plusYears)(METHOD_INVOCATION_ARGUMENTS(NumberLiteral:1)))))(VariableDeclarationStatement(SimpleType(SimpleName:X509Certificate))(VariableDeclarationFragment(SimpleName:certificate)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:MiscTestUtils))(SimpleName:generateCertificate)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:keyPair))(SimpleName:getPublic))(StringLiteral:<STR>)(SimpleName:notBefore)(SimpleName:notAfter)(NullLiteral)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:keyPair))(SimpleName:getPrivate))(BooleanLiteral:true)(NumberLiteral:0)(NullLiteral)(NullLiteral)))))(VariableDeclarationStatement(SimpleType(SimpleName:ServletConfig))(VariableDeclarationFragment(SimpleName:mockServletConfig)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:createMock)(METHOD_INVOCATION_ARGUMENTS(TypeLiteral(SimpleType(SimpleName:ServletConfig)))))))(VariableDeclarationStatement(ParameterizedType(SimpleType(SimpleName:Map))(SimpleType(SimpleName:String))(SimpleType(SimpleName:String)))(VariableDeclarationFragment(SimpleName:httpHeaders)(ClassInstanceCreation(ParameterizedType(SimpleType(SimpleName:HashMap))(SimpleType(SimpleName:String))(SimpleType(SimpleName:String))))))(VariableDeclarationStatement(SimpleType(SimpleName:HttpSession))(VariableDeclarationFragment(SimpleName:mockHttpSession)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:createMock)(METHOD_INVOCATION_ARGUMENTS(TypeLiteral(SimpleType(SimpleName:HttpSession)))))))(VariableDeclarationStatement(SimpleType(SimpleName:HttpServletRequest))(VariableDeclarationFragment(SimpleName:mockServletRequest)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:createMock)(METHOD_INVOCATION_ARGUMENTS(TypeLiteral(SimpleType(SimpleName:HttpServletRequest)))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:expect)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mockServletConfig))(SimpleName:getInitParameter)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))))(SimpleName:andStubReturn)(METHOD_INVOCATION_ARGUMENTS(NullLiteral))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:expect)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mockServletConfig))(SimpleName:getInitParameter)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))))(SimpleName:andStubReturn)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(TypeLiteral(SimpleType(SimpleName:IdentityIntegrityTestService))))(SimpleName:getName)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:expect)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mockServletConfig))(SimpleName:getInitParameter)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))))(SimpleName:andStubReturn)(METHOD_INVOCATION_ARGUMENTS(NullLiteral))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:expect)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mockServletConfig))(SimpleName:getInitParameter)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))))(SimpleName:andStubReturn)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(TypeLiteral(SimpleType(SimpleName:AuditTestService))))(SimpleName:getName)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:expect)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mockServletConfig))(SimpleName:getInitParameter)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))))(SimpleName:andStubReturn)(METHOD_INVOCATION_ARGUMENTS(NullLiteral))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:expect)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mockServletRequest))(SimpleName:getRemoteAddr)))))(SimpleName:andStubReturn)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:expect)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mockHttpSession))(SimpleName:getAttribute)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:RequestContext.INCLUDE_ADDRESS_SESSION_ATTRIBUTE))))))(SimpleName:andStubReturn)(METHOD_INVOCATION_ARGUMENTS(BooleanLiteral:false))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:expect)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mockHttpSession))(SimpleName:getAttribute)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:RequestContext.INCLUDE_CERTIFICATES_SESSION_ATTRIBUTE))))))(SimpleName:andStubReturn)(METHOD_INVOCATION_ARGUMENTS(BooleanLiteral:false))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:expect)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mockHttpSession))(SimpleName:getAttribute)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:RequestContext.INCLUDE_PHOTO_SESSION_ATTRIBUTE))))))(SimpleName:andStubReturn)(METHOD_INVOCATION_ARGUMENTS(BooleanLiteral:false))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:expect)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mockServletConfig))(SimpleName:getInitParameter)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:IdentityDataMessageHandler.INCLUDE_DATA_FILES))))))(SimpleName:andReturn)(METHOD_INVOCATION_ARGUMENTS(NullLiteral))))(VariableDeclarationStatement(ArrayType(PrimitiveType:byte)(Dimension))(VariableDeclarationFragment(SimpleName:idFile)(MethodInvocation(METHOD_INVOCATION_RECEIVER(StringLiteral:<STR>))(SimpleName:getBytes))))(VariableDeclarationStatement(SimpleType(SimpleName:IdentityDataMessage))(VariableDeclarationFragment(SimpleName:message)(ClassInstanceCreation(SimpleType(SimpleName:IdentityDataMessage)))))(ExpressionStatement(Assignment(QualifiedName:message.idFile)(ASSIGNMENT_OPERATOR:=)(SimpleName:idFile)))(VariableDeclarationStatement(SimpleType(SimpleName:KeyPair))(VariableDeclarationFragment(SimpleName:intruderKeyPair)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:MiscTestUtils))(SimpleName:generateKeyPair))))(VariableDeclarationStatement(SimpleType(SimpleName:Signature))(VariableDeclarationFragment(SimpleName:signature)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:Signature))(SimpleName:getInstance)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:signature))(SimpleName:initSign)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:intruderKeyPair))(SimpleName:getPrivate)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:signature))(SimpleName:update)(METHOD_INVOCATION_ARGUMENTS(SimpleName:idFile))))(VariableDeclarationStatement(ArrayType(PrimitiveType:byte)(Dimension))(VariableDeclarationFragment(SimpleName:idFileSignature)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:signature))(SimpleName:sign))))(ExpressionStatement(Assignment(QualifiedName:message.identitySignatureFile)(ASSIGNMENT_OPERATOR:=)(SimpleName:idFileSignature)))(ExpressionStatement(Assignment(QualifiedName:message.rrnCertFile)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:certificate))(SimpleName:getEncoded))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:replay)(METHOD_INVOCATION_ARGUMENTS(SimpleName:mockServletConfig)(SimpleName:mockHttpSession)(SimpleName:mockServletRequest))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:AppletServiceServlet))(SimpleName:injectInitParams)(METHOD_INVOCATION_ARGUMENTS(SimpleName:mockServletConfig)(FieldAccess(ThisExpression)(SimpleName:testedInstance)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(FieldAccess(ThisExpression)(SimpleName:testedInstance)))(SimpleName:init)(METHOD_INVOCATION_ARGUMENTS(SimpleName:mockServletConfig))))(TryStatement(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(FieldAccess(ThisExpression)(SimpleName:testedInstance)))(SimpleName:handleMessage)(METHOD_INVOCATION_ARGUMENTS(SimpleName:message)(SimpleName:httpHeaders)(SimpleName:mockServletRequest)(SimpleName:mockHttpSession))))(ExpressionStatement(MethodInvocation(SimpleName:fail))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:ServletException))(SimpleName:e))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:LOG))(SimpleName:debug)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:e))(SimpleName:getMessage))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:verify)(METHOD_INVOCATION_ARGUMENTS(SimpleName:mockServletConfig)(SimpleName:mockHttpSession)(SimpleName:mockServletRequest))))(ExpressionStatement(MethodInvocation(SimpleName:assertNull)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:IdentityIntegrityTestService))(SimpleName:getCertificate)))))(ExpressionStatement(MethodInvocation(SimpleName:assertEquals)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:AuditTestService))(SimpleName:getAuditIntegrityRemoteAddress))))))))))))