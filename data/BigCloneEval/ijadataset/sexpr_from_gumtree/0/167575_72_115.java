(CompilationUnit(TypeDeclaration(Modifier:public)(TYPE_DECLARATION_KIND:class)(SimpleName:Test)(MethodDeclaration(Modifier:private)(PrimitiveType:void)(SimpleName:handleRequest)(SingleVariableDeclaration(SimpleType(SimpleName:IEnvelope))(SimpleName:env))(SingleVariableDeclaration(SimpleType(SimpleName:RequestTCPRelayMessage))(SimpleName:message))(Block(VariableDeclarationStatement(SimpleType(SimpleName:IPeer))(VariableDeclarationFragment(SimpleName:peer)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:message))(SimpleName:getTarget))))(VariableDeclarationStatement(SimpleType(SimpleName:IPeerID))(VariableDeclarationFragment(SimpleName:requestorID)(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:env))(SimpleName:getSender)))(SimpleName:getPeerID))))(VariableDeclarationStatement(SimpleType(SimpleName:SocketChannel))(VariableDeclarationFragment(SimpleName:sc)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:natConnector))(SimpleName:getControlChannelWith)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:peer))(SimpleName:getPeerID))))))(IfStatement(InfixExpression(SimpleName:sc)(INFIX_EXPRESSION_OPERATOR:==)(NullLiteral))(Block(VariableDeclarationStatement(SimpleType(SimpleName:RelayAnswerMessage))(VariableDeclarationFragment(SimpleName:ram)(ClassInstanceCreation(SimpleType(SimpleName:RelayAnswerMessage))(SimpleName:myPeerID)(SimpleName:requestorID)(BooleanLiteral:false)(StringLiteral:<STR>)(NullLiteral))))(TryStatement(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:commFacade))(SimpleName:sendTCPMessage)(METHOD_INVOCATION_ARGUMENTS(CastExpression(SimpleType(SimpleName:SocketChannel))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:env))(SimpleName:getChannel)))(SimpleName:ram)))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:IOException))(SimpleName:e))(Block)))(ReturnStatement)))(VariableDeclarationStatement(SimpleType(SimpleName:InetSocketAddress))(VariableDeclarationFragment(SimpleName:addr)(ClassInstanceCreation(SimpleType(SimpleName:InetSocketAddress))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:InetAddressUtils))(SimpleName:getMostProbableExternalAddress))(QualifiedName:NatConnector.DEFAULT_PORT))))(VariableDeclarationStatement(SimpleType(SimpleName:TCPConnRequest))(VariableDeclarationFragment(SimpleName:request)(ClassInstanceCreation(SimpleType(SimpleName:TCPConnRequest))(SimpleName:myPeerID)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:peer))(SimpleName:getPeerID))(SimpleName:addr))))(VariableDeclarationStatement(SimpleType(SimpleName:BlockingHook))(VariableDeclarationFragment(SimpleName:bh)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:BlockingHook))(SimpleName:createMessageAnswerHook)(METHOD_INVOCATION_ARGUMENTS(SimpleName:request)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:commFacade))(SimpleName:getMessageProcessor)))(SimpleName:installHook)(METHOD_INVOCATION_ARGUMENTS(SimpleName:bh)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:bh))(SimpleName:getPredicate)))))(VariableDeclarationStatement(SimpleType(SimpleName:IEnvelope))(VariableDeclarationFragment(SimpleName:answer)(NullLiteral)))(TryStatement(Block(TryStatement(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:commFacade))(SimpleName:sendTCPMessage)(METHOD_INVOCATION_ARGUMENTS(SimpleName:sc)(SimpleName:request)))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:IOException))(SimpleName:e))(Block)))(ExpressionStatement(Assignment(SimpleName:answer)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:bh))(SimpleName:waitForMessage)))))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:commFacade))(SimpleName:getMessageProcessor)))(SimpleName:removeHook)(METHOD_INVOCATION_ARGUMENTS(SimpleName:bh))))))(IfStatement(InfixExpression(SimpleName:answer)(INFIX_EXPRESSION_OPERATOR:==)(NullLiteral))(Block(VariableDeclarationStatement(SimpleType(SimpleName:RelayAnswerMessage))(VariableDeclarationFragment(SimpleName:ram)(ClassInstanceCreation(SimpleType(SimpleName:RelayAnswerMessage))(SimpleName:myPeerID)(SimpleName:requestorID)(BooleanLiteral:false)(StringLiteral:<STR>)(NullLiteral))))(TryStatement(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:commFacade))(SimpleName:sendTCPMessage)(METHOD_INVOCATION_ARGUMENTS(CastExpression(SimpleType(SimpleName:SocketChannel))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:env))(SimpleName:getChannel)))(SimpleName:ram)))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:IOException))(SimpleName:e))(Block)))(ReturnStatement)))(VariableDeclarationStatement(Modifier:final)(SimpleType(SimpleName:SocketChannel))(VariableDeclarationFragment(SimpleName:requestTarget)(CastExpression(SimpleType(SimpleName:SocketChannel))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:answer))(SimpleName:getChannel)))))(VariableDeclarationStatement(SimpleType(SimpleName:RelayAnswerMessage))(VariableDeclarationFragment(SimpleName:relayAnswer)(ClassInstanceCreation(SimpleType(SimpleName:RelayAnswerMessage))(SimpleName:myPeerID)(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:env))(SimpleName:getSender)))(SimpleName:getPeerID))(BooleanLiteral:true)(StringLiteral:<STR>)(NullLiteral))))(TryStatement(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:commFacade))(SimpleName:sendTCPMessage)(METHOD_INVOCATION_ARGUMENTS(CastExpression(SimpleType(SimpleName:SocketChannel))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:env))(SimpleName:getChannel)))(SimpleName:relayAnswer)))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:IOException))(SimpleName:e))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:Logger))(SimpleName:logError)(METHOD_INVOCATION_ARGUMENTS(SimpleName:e)(StringLiteral:<STR>)))))))(VariableDeclarationStatement(Modifier:final)(SimpleType(SimpleName:SocketChannel))(VariableDeclarationFragment(SimpleName:requestor)(CastExpression(SimpleType(SimpleName:SocketChannel))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:env))(SimpleName:getChannel)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:daemon))(SimpleName:addMapping)(METHOD_INVOCATION_ARGUMENTS(SimpleName:requestor)(SimpleName:requestTarget))))))))