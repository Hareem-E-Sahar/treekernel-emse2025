(CompilationUnit(TypeDeclaration(Modifier:public)(TYPE_DECLARATION_KIND:class)(SimpleName:Test)(MethodDeclaration(Modifier:private)(PrimitiveType:void)(SimpleName:runWithInstance)(SingleVariableDeclaration(SimpleType(SimpleName:InstanceCredType))(SimpleName:instanceCred))(SingleVariableDeclaration(SimpleType(SimpleName:InstanceRunnable))(SimpleName:runable))(SingleVariableDeclaration(PrimitiveType:boolean)(SimpleName:write))(SimpleType(SimpleName:EngineException))(Block(VariableDeclarationStatement(PrimitiveType:long)(VariableDeclarationFragment(SimpleName:instanceID)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:instanceCred))(SimpleName:getId))))(VariableDeclarationStatement(SimpleType(SimpleName:Lock))(VariableDeclarationFragment(SimpleName:lock)(NullLiteral)))(IfStatement(BooleanLiteral:true)(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:instanceLocks))(SimpleName:putIfAbsent)(METHOD_INVOCATION_ARGUMENTS(SimpleName:instanceID)(ClassInstanceCreation(SimpleType(SimpleName:ReentrantReadWriteLock))))))(VariableDeclarationStatement(SimpleType(SimpleName:ReentrantReadWriteLock))(VariableDeclarationFragment(SimpleName:rwlock)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:instanceLocks))(SimpleName:get)(METHOD_INVOCATION_ARGUMENTS(SimpleName:instanceID)))))(ExpressionStatement(Assignment(SimpleName:lock)(ASSIGNMENT_OPERATOR:=)(ConditionalExpression(SimpleName:write)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:rwlock))(SimpleName:writeLock))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:rwlock))(SimpleName:readLock))))))(Block))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:lock))(SimpleName:lock)))(VariableDeclarationStatement(SimpleType(SimpleName:EntityManager))(VariableDeclarationFragment(SimpleName:em)(MethodInvocation(SimpleName:createEM))))(VariableDeclarationStatement(SimpleType(SimpleName:EntityTransaction))(VariableDeclarationFragment(SimpleName:tx)(NullLiteral)))(TryStatement(Block(ExpressionStatement(Assignment(SimpleName:tx)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:em))(SimpleName:getTransaction))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:tx))(SimpleName:begin)))(VariableDeclarationStatement(SimpleType(SimpleName:Instance))(VariableDeclarationFragment(SimpleName:instance)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:em))(SimpleName:find)(METHOD_INVOCATION_ARGUMENTS(TypeLiteral(SimpleType(SimpleName:Instance)))(SimpleName:instanceID)))))(IfStatement(InfixExpression(SimpleName:instance)(INFIX_EXPRESSION_OPERATOR:==)(NullLiteral))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:instanceLocks))(SimpleName:remove)(METHOD_INVOCATION_ARGUMENTS(SimpleName:instanceID))))(ThrowStatement(ClassInstanceCreation(SimpleType(SimpleName:EngineException))(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(SimpleName:instanceID))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:instance))(SimpleName:setEngine)(METHOD_INVOCATION_ARGUMENTS(ThisExpression))))(IfStatement(PrefixExpression(PREFIX_EXPRESSION_OPERATOR:!)(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:instance))(SimpleName:getKey)))(SimpleName:equals)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:instanceCred))(SimpleName:getKey)))))(Block(ThrowStatement(ClassInstanceCreation(SimpleType(SimpleName:EngineException))(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(SimpleName:instanceID))))))(ExpressionStatement(Assignment(QualifiedName:runable.instance)(ASSIGNMENT_OPERATOR:=)(SimpleName:instance)))(ExpressionStatement(Assignment(QualifiedName:runable.em)(ASSIGNMENT_OPERATOR:=)(SimpleName:em)))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:runable))(SimpleName:run)))(IfStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:tx))(SimpleName:isActive))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:tx))(SimpleName:commit)))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:RuntimeException))(SimpleName:re))(Block(ThrowStatement(ClassInstanceCreation(SimpleType(SimpleName:RuntimeException))(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(SimpleName:instanceID))(SimpleName:re)))))(Block(IfStatement(InfixExpression(InfixExpression(SimpleName:tx)(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(INFIX_EXPRESSION_OPERATOR:&&)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:tx))(SimpleName:isActive)))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:tx))(SimpleName:rollback))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:em))(SimpleName:close)))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:lock))(SimpleName:unlock)))))))))