(CompilationUnit(TypeDeclaration(Modifier:public)(TYPE_DECLARATION_KIND:class)(SimpleName:Test)(MethodDeclaration(Modifier:public)(PrimitiveType:void)(SimpleName:run)(Block(TryStatement(Block(VariableDeclarationStatement(SimpleType(SimpleName:Socket))(VariableDeclarationFragment(SimpleName:socket)(MethodInvocation(SimpleName:getSocket))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(QualifiedName:System.out))(SimpleName:println)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(SimpleName:address)(StringLiteral:<STR>)(SimpleName:port)))))(VariableDeclarationStatement(SimpleType(SimpleName:InputStream))(VariableDeclarationFragment(SimpleName:in)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:socket))(SimpleName:getInputStream))))(ForStatement(Block(VariableDeclarationStatement(SimpleType(SimpleName:FileTransferHeader))(VariableDeclarationFragment(SimpleName:header)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:FileTransferHeader))(SimpleName:readHeader)(METHOD_INVOCATION_ARGUMENTS(SimpleName:in)))))(IfStatement(InfixExpression(SimpleName:header)(INFIX_EXPRESSION_OPERATOR:==)(NullLiteral))(BreakStatement))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(QualifiedName:System.out))(SimpleName:println)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(SimpleName:header)))))(VariableDeclarationStatement(ArrayType(SimpleType(SimpleName:String))(Dimension))(VariableDeclarationFragment(SimpleName:parts)(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:header))(SimpleName:getFilename)))(SimpleName:getSegments))))(VariableDeclarationStatement(SimpleType(SimpleName:String))(VariableDeclarationFragment(SimpleName:filename)))(IfStatement(InfixExpression(QualifiedName:parts.length)(INFIX_EXPRESSION_OPERATOR:>)(NumberLiteral:0))(ExpressionStatement(Assignment(SimpleName:filename)(ASSIGNMENT_OPERATOR:=)(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(ArrayAccess(SimpleName:parts)(InfixExpression(QualifiedName:parts.length)(INFIX_EXPRESSION_OPERATOR:-)(NumberLiteral:1))))))(ExpressionStatement(Assignment(SimpleName:filename)(ASSIGNMENT_OPERATOR:=)(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:session))(SimpleName:getScreenname))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(QualifiedName:System.out))(SimpleName:println)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(SimpleName:filename)))))(VariableDeclarationStatement(PrimitiveType:long)(VariableDeclarationFragment(SimpleName:sum)(NumberLiteral:0)))(IfStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(ClassInstanceCreation(SimpleType(SimpleName:File))(SimpleName:filename)))(SimpleName:exists))(Block(VariableDeclarationStatement(SimpleType(SimpleName:FileInputStream))(VariableDeclarationFragment(SimpleName:fis)(ClassInstanceCreation(SimpleType(SimpleName:FileInputStream))(SimpleName:filename))))(VariableDeclarationStatement(ArrayType(PrimitiveType:byte)(Dimension))(VariableDeclarationFragment(SimpleName:block)(ArrayCreation(ArrayType(PrimitiveType:byte)(Dimension(NumberLiteral:10))))))(ForStatement(VariableDeclarationExpression(PrimitiveType:int)(VariableDeclarationFragment(SimpleName:i)(NumberLiteral:0)))(InfixExpression(SimpleName:i)(INFIX_EXPRESSION_OPERATOR:<)(QualifiedName:block.length))(Block(VariableDeclarationStatement(PrimitiveType:int)(VariableDeclarationFragment(SimpleName:count)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:fis))(SimpleName:read)(METHOD_INVOCATION_ARGUMENTS(SimpleName:block)))))(IfStatement(InfixExpression(SimpleName:count)(INFIX_EXPRESSION_OPERATOR:==)(PrefixExpression(PREFIX_EXPRESSION_OPERATOR:-)(NumberLiteral:1)))(BreakStatement))(ExpressionStatement(Assignment(SimpleName:i)(ASSIGNMENT_OPERATOR:+=)(SimpleName:count)))))(VariableDeclarationStatement(SimpleType(SimpleName:FileTransferChecksum))(VariableDeclarationFragment(SimpleName:summer)(ClassInstanceCreation(SimpleType(SimpleName:FileTransferChecksum)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:summer))(SimpleName:update)(METHOD_INVOCATION_ARGUMENTS(SimpleName:block)(NumberLiteral:0)(NumberLiteral:10))))(ExpressionStatement(Assignment(SimpleName:sum)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:summer))(SimpleName:getValue))))))(VariableDeclarationStatement(SimpleType(SimpleName:FileChannel))(VariableDeclarationFragment(SimpleName:fileChannel)(MethodInvocation(METHOD_INVOCATION_RECEIVER(ClassInstanceCreation(SimpleType(SimpleName:FileOutputStream))(SimpleName:filename)))(SimpleName:getChannel))))(VariableDeclarationStatement(SimpleType(SimpleName:FileTransferHeader))(VariableDeclarationFragment(SimpleName:outHeader)(ClassInstanceCreation(SimpleType(SimpleName:FileTransferHeader))(SimpleName:header))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:outHeader))(SimpleName:setHeaderType)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:FileTransferHeader.HEADERTYPE_ACK))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:outHeader))(SimpleName:setIcbmMessageId)(METHOD_INVOCATION_ARGUMENTS(SimpleName:cookie))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:outHeader))(SimpleName:setBytesReceived)(METHOD_INVOCATION_ARGUMENTS(NumberLiteral:0))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:outHeader))(SimpleName:setReceivedChecksum)(METHOD_INVOCATION_ARGUMENTS(SimpleName:sum))))(VariableDeclarationStatement(SimpleType(SimpleName:OutputStream))(VariableDeclarationFragment(SimpleName:socketOut)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:socket))(SimpleName:getOutputStream))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(QualifiedName:System.out))(SimpleName:println)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(SimpleName:outHeader)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:outHeader))(SimpleName:write)(METHOD_INVOCATION_ARGUMENTS(SimpleName:socketOut))))(ForStatement(VariableDeclarationExpression(PrimitiveType:int)(VariableDeclarationFragment(SimpleName:i)(NumberLiteral:0)))(InfixExpression(SimpleName:i)(INFIX_EXPRESSION_OPERATOR:<)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:header))(SimpleName:getFileSize)))(Block(VariableDeclarationStatement(PrimitiveType:long)(VariableDeclarationFragment(SimpleName:transferred)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:fileChannel))(SimpleName:transferFrom)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:Channels))(SimpleName:newChannel)(METHOD_INVOCATION_ARGUMENTS(SimpleName:in)))(NumberLiteral:0)(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:header))(SimpleName:getFileSize))(INFIX_EXPRESSION_OPERATOR:-)(SimpleName:i))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(QualifiedName:System.out))(SimpleName:println)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(SimpleName:transferred)))))(IfStatement(InfixExpression(SimpleName:transferred)(INFIX_EXPRESSION_OPERATOR:==)(PrefixExpression(PREFIX_EXPRESSION_OPERATOR:-)(NumberLiteral:1)))(ReturnStatement))(ExpressionStatement(Assignment(SimpleName:i)(ASSIGNMENT_OPERATOR:+=)(SimpleName:transferred)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(QualifiedName:System.out))(SimpleName:println)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:fileChannel))(SimpleName:close)))(VariableDeclarationStatement(SimpleType(SimpleName:FileTransferHeader))(VariableDeclarationFragment(SimpleName:doneHeader)(ClassInstanceCreation(SimpleType(SimpleName:FileTransferHeader))(SimpleName:header))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:doneHeader))(SimpleName:setHeaderType)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:FileTransferHeader.HEADERTYPE_RECEIVED))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:doneHeader))(SimpleName:setFlags)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:doneHeader))(SimpleName:getFlags))(INFIX_EXPRESSION_OPERATOR:|)(QualifiedName:FileTransferHeader.FLAG_DONE)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:doneHeader))(SimpleName:setBytesReceived)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:doneHeader))(SimpleName:getBytesReceived))(INFIX_EXPRESSION_OPERATOR:+)(NumberLiteral:1)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:doneHeader))(SimpleName:setIcbmMessageId)(METHOD_INVOCATION_ARGUMENTS(SimpleName:cookie))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:doneHeader))(SimpleName:setFilesLeft)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:doneHeader))(SimpleName:getFilesLeft))(INFIX_EXPRESSION_OPERATOR:-)(NumberLiteral:1)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:doneHeader))(SimpleName:write)(METHOD_INVOCATION_ARGUMENTS(SimpleName:socketOut))))(IfStatement(InfixExpression(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:doneHeader))(SimpleName:getFilesLeft))(INFIX_EXPRESSION_OPERATOR:-)(NumberLiteral:1))(INFIX_EXPRESSION_OPERATOR:<=)(NumberLiteral:0))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:socket))(SimpleName:close)))(BreakStatement))))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:IOException))(SimpleName:e))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:e))(SimpleName:printStackTrace)))(ReturnStatement))))))))