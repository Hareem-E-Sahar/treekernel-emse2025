(CompilationUnit(TypeDeclaration(Modifier:public)(TYPE_DECLARATION_KIND:class)(SimpleName:Test)(MethodDeclaration(MarkerAnnotation(SimpleName:Test))(Modifier:public)(PrimitiveType:void)(SimpleName:testSignEnvelopingDocumentWithExternalDigestInfo)(SimpleType(SimpleName:Exception))(Block(VariableDeclarationStatement(SimpleType(SimpleName:DocumentBuilderFactory))(VariableDeclarationFragment(SimpleName:documentBuilderFactory)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:DocumentBuilderFactory))(SimpleName:newInstance))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:documentBuilderFactory))(SimpleName:setNamespaceAware)(METHOD_INVOCATION_ARGUMENTS(BooleanLiteral:true))))(VariableDeclarationStatement(SimpleType(SimpleName:DocumentBuilder))(VariableDeclarationFragment(SimpleName:documentBuilder)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:documentBuilderFactory))(SimpleName:newDocumentBuilder))))(VariableDeclarationStatement(SimpleType(SimpleName:Document))(VariableDeclarationFragment(SimpleName:document)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:documentBuilder))(SimpleName:newDocument))))(VariableDeclarationStatement(SimpleType(SimpleName:Element))(VariableDeclarationFragment(SimpleName:rootElement)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:document))(SimpleName:createElementNS)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)(StringLiteral:<STR>)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:rootElement))(SimpleName:setAttributeNS)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:Constants.NamespaceSpecNS)(StringLiteral:<STR>)(StringLiteral:<STR>))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:document))(SimpleName:appendChild)(METHOD_INVOCATION_ARGUMENTS(SimpleName:rootElement))))(VariableDeclarationStatement(SimpleType(SimpleName:XmlSignatureTestService))(VariableDeclarationFragment(SimpleName:testedInstance)(ClassInstanceCreation(SimpleType(SimpleName:XmlSignatureTestService)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:testedInstance))(SimpleName:setEnvelopingDocument)(METHOD_INVOCATION_ARGUMENTS(SimpleName:document))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:testedInstance))(SimpleName:setSignatureDescription)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))(VariableDeclarationStatement(ArrayType(PrimitiveType:byte)(Dimension))(VariableDeclarationFragment(SimpleName:refData)(MethodInvocation(METHOD_INVOCATION_RECEIVER(StringLiteral:<STR>))(SimpleName:getBytes))))(VariableDeclarationStatement(SimpleType(SimpleName:MessageDigest))(VariableDeclarationFragment(SimpleName:messageDigest)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:MessageDigest))(SimpleName:getInstance)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:messageDigest))(SimpleName:update)(METHOD_INVOCATION_ARGUMENTS(SimpleName:refData))))(VariableDeclarationStatement(ArrayType(PrimitiveType:byte)(Dimension))(VariableDeclarationFragment(SimpleName:digestValue)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:messageDigest))(SimpleName:digest))))(VariableDeclarationStatement(SimpleType(SimpleName:DigestInfo))(VariableDeclarationFragment(SimpleName:refDigestInfo)(ClassInstanceCreation(SimpleType(SimpleName:DigestInfo))(SimpleName:digestValue)(StringLiteral:<STR>)(StringLiteral:<STR>))))(VariableDeclarationStatement(SimpleType(SimpleName:DigestInfo))(VariableDeclarationFragment(SimpleName:digestInfo)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:testedInstance))(SimpleName:preSign)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:Collections))(SimpleName:singletonList)(METHOD_INVOCATION_ARGUMENTS(SimpleName:refDigestInfo)))(NullLiteral)))))(ExpressionStatement(MethodInvocation(SimpleName:assertNotNull)(METHOD_INVOCATION_ARGUMENTS(SimpleName:digestInfo))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:LOG))(SimpleName:debug)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(QualifiedName:digestInfo.description)))))(ExpressionStatement(MethodInvocation(SimpleName:assertEquals)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)(QualifiedName:digestInfo.description))))(ExpressionStatement(MethodInvocation(SimpleName:assertNotNull)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:digestInfo.digestValue))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:LOG))(SimpleName:debug)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(QualifiedName:digestInfo.digestAlgo)))))(ExpressionStatement(MethodInvocation(SimpleName:assertEquals)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)(QualifiedName:digestInfo.digestAlgo))))(VariableDeclarationStatement(SimpleType(SimpleName:TemporaryTestDataStorage))(VariableDeclarationFragment(SimpleName:temporaryDataStorage)(CastExpression(SimpleType(SimpleName:TemporaryTestDataStorage))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:testedInstance))(SimpleName:getTemporaryDataStorage)))))(ExpressionStatement(MethodInvocation(SimpleName:assertNotNull)(METHOD_INVOCATION_ARGUMENTS(SimpleName:temporaryDataStorage))))(VariableDeclarationStatement(SimpleType(SimpleName:InputStream))(VariableDeclarationFragment(SimpleName:tempInputStream)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:temporaryDataStorage))(SimpleName:getTempInputStream))))(ExpressionStatement(MethodInvocation(SimpleName:assertNotNull)(METHOD_INVOCATION_ARGUMENTS(SimpleName:tempInputStream))))(VariableDeclarationStatement(SimpleType(SimpleName:Document))(VariableDeclarationFragment(SimpleName:tmpDocument)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:PkiTestUtils))(SimpleName:loadDocument)(METHOD_INVOCATION_ARGUMENTS(SimpleName:tempInputStream)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:LOG))(SimpleName:debug)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:PkiTestUtils))(SimpleName:toString)(METHOD_INVOCATION_ARGUMENTS(SimpleName:tmpDocument)))))))(VariableDeclarationStatement(SimpleType(SimpleName:Element))(VariableDeclarationFragment(SimpleName:nsElement)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:tmpDocument))(SimpleName:createElement)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:nsElement))(SimpleName:setAttributeNS)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:Constants.NamespaceSpecNS)(StringLiteral:<STR>)(QualifiedName:Constants.SignatureSpecNS))))(VariableDeclarationStatement(SimpleType(SimpleName:Node))(VariableDeclarationFragment(SimpleName:digestValueNode)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:XPathAPI))(SimpleName:selectSingleNode)(METHOD_INVOCATION_ARGUMENTS(SimpleName:tmpDocument)(StringLiteral:<STR>)(SimpleName:nsElement)))))(ExpressionStatement(MethodInvocation(SimpleName:assertNotNull)(METHOD_INVOCATION_ARGUMENTS(SimpleName:digestValueNode))))(VariableDeclarationStatement(SimpleType(SimpleName:String))(VariableDeclarationFragment(SimpleName:digestValueTextContent)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:digestValueNode))(SimpleName:getTextContent))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:LOG))(SimpleName:debug)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(SimpleName:digestValueTextContent)))))(ExpressionStatement(MethodInvocation(SimpleName:assertFalse)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:digestValueTextContent))(SimpleName:isEmpty)))))(VariableDeclarationStatement(SimpleType(SimpleName:KeyPair))(VariableDeclarationFragment(SimpleName:keyPair)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:PkiTestUtils))(SimpleName:generateKeyPair))))(VariableDeclarationStatement(SimpleType(SimpleName:Cipher))(VariableDeclarationFragment(SimpleName:cipher)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:Cipher))(SimpleName:getInstance)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:cipher))(SimpleName:init)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:Cipher.ENCRYPT_MODE)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:keyPair))(SimpleName:getPrivate)))))(VariableDeclarationStatement(ArrayType(PrimitiveType:byte)(Dimension))(VariableDeclarationFragment(SimpleName:digestInfoValue)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:ArrayUtils))(SimpleName:addAll)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:PkiTestUtils.SHA1_DIGEST_INFO_PREFIX)(QualifiedName:digestInfo.digestValue)))))(VariableDeclarationStatement(ArrayType(PrimitiveType:byte)(Dimension))(VariableDeclarationFragment(SimpleName:signatureValue)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:cipher))(SimpleName:doFinal)(METHOD_INVOCATION_ARGUMENTS(SimpleName:digestInfoValue)))))(VariableDeclarationStatement(SimpleType(SimpleName:DateTime))(VariableDeclarationFragment(SimpleName:notBefore)(ClassInstanceCreation(SimpleType(SimpleName:DateTime)))))(VariableDeclarationStatement(SimpleType(SimpleName:DateTime))(VariableDeclarationFragment(SimpleName:notAfter)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:notBefore))(SimpleName:plusYears)(METHOD_INVOCATION_ARGUMENTS(NumberLiteral:1)))))(VariableDeclarationStatement(SimpleType(SimpleName:X509Certificate))(VariableDeclarationFragment(SimpleName:certificate)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:PkiTestUtils))(SimpleName:generateCertificate)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:keyPair))(SimpleName:getPublic))(StringLiteral:<STR>)(SimpleName:notBefore)(SimpleName:notAfter)(NullLiteral)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:keyPair))(SimpleName:getPrivate))(BooleanLiteral:true)(NumberLiteral:0)(NullLiteral)(NullLiteral)(ClassInstanceCreation(SimpleType(SimpleName:KeyUsage))(QualifiedName:KeyUsage.nonRepudiation))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:testedInstance))(SimpleName:postSign)(METHOD_INVOCATION_ARGUMENTS(SimpleName:signatureValue)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:Collections))(SimpleName:singletonList)(METHOD_INVOCATION_ARGUMENTS(SimpleName:certificate))))))(VariableDeclarationStatement(ArrayType(PrimitiveType:byte)(Dimension))(VariableDeclarationFragment(SimpleName:signedDocumentData)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:testedInstance))(SimpleName:getSignedDocumentData))))(ExpressionStatement(MethodInvocation(SimpleName:assertNotNull)(METHOD_INVOCATION_ARGUMENTS(SimpleName:signedDocumentData))))(VariableDeclarationStatement(SimpleType(SimpleName:Document))(VariableDeclarationFragment(SimpleName:signedDocument)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:PkiTestUtils))(SimpleName:loadDocument)(METHOD_INVOCATION_ARGUMENTS(ClassInstanceCreation(SimpleType(SimpleName:ByteArrayInputStream))(SimpleName:signedDocumentData))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:LOG))(SimpleName:debug)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:PkiTestUtils))(SimpleName:toString)(METHOD_INVOCATION_ARGUMENTS(SimpleName:signedDocument)))))))(VariableDeclarationStatement(SimpleType(SimpleName:NodeList))(VariableDeclarationFragment(SimpleName:signatureNodeList)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:signedDocument))(SimpleName:getElementsByTagNameNS)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:XMLSignature.XMLNS)(StringLiteral:<STR>)))))(ExpressionStatement(MethodInvocation(SimpleName:assertEquals)(METHOD_INVOCATION_ARGUMENTS(NumberLiteral:1)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:signatureNodeList))(SimpleName:getLength)))))(VariableDeclarationStatement(SimpleType(SimpleName:Node))(VariableDeclarationFragment(SimpleName:signatureNode)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:signatureNodeList))(SimpleName:item)(METHOD_INVOCATION_ARGUMENTS(NumberLiteral:0)))))(VariableDeclarationStatement(SimpleType(SimpleName:DOMValidateContext))(VariableDeclarationFragment(SimpleName:domValidateContext)(ClassInstanceCreation(SimpleType(SimpleName:DOMValidateContext))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:KeySelector))(SimpleName:singletonKeySelector)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:keyPair))(SimpleName:getPublic))))(SimpleName:signatureNode))))(VariableDeclarationStatement(SimpleType(SimpleName:URIDereferencer))(VariableDeclarationFragment(SimpleName:dereferencer)(ClassInstanceCreation(SimpleType(SimpleName:URITest2Dereferencer)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:domValidateContext))(SimpleName:setURIDereferencer)(METHOD_INVOCATION_ARGUMENTS(SimpleName:dereferencer))))(VariableDeclarationStatement(SimpleType(SimpleName:XMLSignatureFactory))(VariableDeclarationFragment(SimpleName:xmlSignatureFactory)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:XMLSignatureFactory))(SimpleName:getInstance))))(VariableDeclarationStatement(SimpleType(SimpleName:XMLSignature))(VariableDeclarationFragment(SimpleName:xmlSignature)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:xmlSignatureFactory))(SimpleName:unmarshalXMLSignature)(METHOD_INVOCATION_ARGUMENTS(SimpleName:domValidateContext)))))(VariableDeclarationStatement(PrimitiveType:boolean)(VariableDeclarationFragment(SimpleName:validity)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:xmlSignature))(SimpleName:validate)(METHOD_INVOCATION_ARGUMENTS(SimpleName:domValidateContext)))))(ExpressionStatement(MethodInvocation(SimpleName:assertTrue)(METHOD_INVOCATION_ARGUMENTS(SimpleName:validity))))))))