(CompilationUnit(TypeDeclaration(Modifier:public)(TYPE_DECLARATION_KIND:class)(SimpleName:Test)(MethodDeclaration(Modifier:public)(SimpleType(SimpleName:Result))(SimpleName:toZip)(SingleVariableDeclaration(SimpleType(SimpleName:Request))(SimpleName:request))(SingleVariableDeclaration(SimpleType(SimpleName:String))(SimpleName:prefix))(SingleVariableDeclaration(ParameterizedType(SimpleType(SimpleName:List))(SimpleType(SimpleName:Entry)))(SimpleName:entries))(SingleVariableDeclaration(PrimitiveType:boolean)(SimpleName:recurse))(SingleVariableDeclaration(PrimitiveType:boolean)(SimpleName:forExport))(SimpleType(SimpleName:Exception))(Block(VariableDeclarationStatement(SimpleType(SimpleName:OutputStream))(VariableDeclarationFragment(SimpleName:os)))(VariableDeclarationStatement(PrimitiveType:boolean)(VariableDeclarationFragment(SimpleName:doingFile)(BooleanLiteral:false)))(VariableDeclarationStatement(SimpleType(SimpleName:File))(VariableDeclarationFragment(SimpleName:tmpFile)(NullLiteral)))(IfStatement(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:request))(SimpleName:getHttpServletResponse))(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(Block(ExpressionStatement(Assignment(SimpleName:os)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:request))(SimpleName:getHttpServletResponse)))(SimpleName:getOutputStream))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:request))(SimpleName:getHttpServletResponse)))(SimpleName:setContentType)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(SimpleName:getMimeType)(METHOD_INVOCATION_ARGUMENTS(SimpleName:OUTPUT_ZIP)))))))(Block(ExpressionStatement(Assignment(SimpleName:tmpFile)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(SimpleName:getRepository)))(SimpleName:getStorageManager)))(SimpleName:getTmpFile)(METHOD_INVOCATION_ARGUMENTS(SimpleName:request)(StringLiteral:<STR>)))))(ExpressionStatement(Assignment(SimpleName:os)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(SimpleName:getStorageManager)))(SimpleName:getFileOutputStream)(METHOD_INVOCATION_ARGUMENTS(SimpleName:tmpFile)))))(ExpressionStatement(Assignment(SimpleName:doingFile)(ASSIGNMENT_OPERATOR:=)(BooleanLiteral:true)))))(VariableDeclarationStatement(SimpleType(SimpleName:Result))(VariableDeclarationFragment(SimpleName:result)(ClassInstanceCreation(SimpleType(SimpleName:Result)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:result))(SimpleName:setNeedToWrite)(METHOD_INVOCATION_ARGUMENTS(BooleanLiteral:false))))(VariableDeclarationStatement(SimpleType(SimpleName:Element))(VariableDeclarationFragment(SimpleName:root)(NullLiteral)))(VariableDeclarationStatement(PrimitiveType:boolean)(VariableDeclarationFragment(SimpleName:ok)(BooleanLiteral:true)))(TryStatement(Block(ExpressionStatement(MethodInvocation(SimpleName:processZip)(METHOD_INVOCATION_ARGUMENTS(SimpleName:request)(SimpleName:entries)(SimpleName:recurse)(NumberLiteral:0)(NullLiteral)(SimpleName:prefix)(NumberLiteral:0)(ArrayCreation(ArrayType(PrimitiveType:int)(Dimension))(ArrayInitializer(NumberLiteral:0)))(SimpleName:forExport)(NullLiteral)))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:IllegalArgumentException))(SimpleName:iae))(Block(ExpressionStatement(Assignment(SimpleName:ok)(ASSIGNMENT_OPERATOR:=)(BooleanLiteral:false))))))(IfStatement(PrefixExpression(PREFIX_EXPRESSION_OPERATOR:!)(SimpleName:ok))(Block(VariableDeclarationStatement(SimpleType(QualifiedName:javax.servlet.http.HttpServletResponse))(VariableDeclarationFragment(SimpleName:response)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:request))(SimpleName:getHttpServletResponse))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:response))(SimpleName:setStatus)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:Result.RESPONSE_UNAUTHORIZED))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:response))(SimpleName:sendError)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:response.SC_INTERNAL_SERVER_ERROR)(StringLiteral:<STR>))))(ReturnStatement(SimpleName:result))))(VariableDeclarationStatement(SimpleType(SimpleName:ZipOutputStream))(VariableDeclarationFragment(SimpleName:zos)(ClassInstanceCreation(SimpleType(SimpleName:ZipOutputStream))(SimpleName:os))))(IfStatement(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:request))(SimpleName:get)(METHOD_INVOCATION_ARGUMENTS(SimpleName:ARG_COMPRESS)(BooleanLiteral:true)))(INFIX_EXPRESSION_OPERATOR:==)(BooleanLiteral:false))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:zos))(SimpleName:setLevel)(METHOD_INVOCATION_ARGUMENTS(NumberLiteral:0))))))(VariableDeclarationStatement(SimpleType(SimpleName:Hashtable))(VariableDeclarationFragment(SimpleName:seen)(ClassInstanceCreation(SimpleType(SimpleName:Hashtable)))))(TryStatement(Block(IfStatement(SimpleName:forExport)(Block(VariableDeclarationStatement(SimpleType(SimpleName:Document))(VariableDeclarationFragment(SimpleName:doc)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:XmlUtil))(SimpleName:makeDocument))))(ExpressionStatement(Assignment(SimpleName:root)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:XmlUtil))(SimpleName:create)(METHOD_INVOCATION_ARGUMENTS(SimpleName:doc)(SimpleName:TAG_ENTRIES)(NullLiteral)(ArrayCreation(ArrayType(SimpleType(SimpleName:String))(Dimension))(ArrayInitializer))))))))(ExpressionStatement(MethodInvocation(SimpleName:processZip)(METHOD_INVOCATION_ARGUMENTS(SimpleName:request)(SimpleName:entries)(SimpleName:recurse)(NumberLiteral:0)(SimpleName:zos)(SimpleName:prefix)(NumberLiteral:0)(ArrayCreation(ArrayType(PrimitiveType:int)(Dimension))(ArrayInitializer(NumberLiteral:0)))(SimpleName:forExport)(SimpleName:root))))(IfStatement(InfixExpression(SimpleName:root)(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(Block(VariableDeclarationStatement(SimpleType(SimpleName:String))(VariableDeclarationFragment(SimpleName:xml)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:XmlUtil))(SimpleName:toString)(METHOD_INVOCATION_ARGUMENTS(SimpleName:root)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(QualifiedName:System.err))(SimpleName:println)(METHOD_INVOCATION_ARGUMENTS(SimpleName:xml))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:zos))(SimpleName:putNextEntry)(METHOD_INVOCATION_ARGUMENTS(ClassInstanceCreation(SimpleType(SimpleName:ZipEntry))(StringLiteral:<STR>)))))(VariableDeclarationStatement(ArrayType(PrimitiveType:byte)(Dimension))(VariableDeclarationFragment(SimpleName:bytes)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:xml))(SimpleName:getBytes))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:zos))(SimpleName:write)(METHOD_INVOCATION_ARGUMENTS(SimpleName:bytes)(NumberLiteral:0)(QualifiedName:bytes.length))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:zos))(SimpleName:closeEntry))))))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:IOUtil))(SimpleName:close)(METHOD_INVOCATION_ARGUMENTS(SimpleName:zos))))))(IfStatement(SimpleName:doingFile)(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:os))(SimpleName:close)))(ReturnStatement(ClassInstanceCreation(SimpleType(SimpleName:Result))(StringLiteral:<STR>)(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(SimpleName:getStorageManager)))(SimpleName:getFileInputStream)(METHOD_INVOCATION_ARGUMENTS(SimpleName:tmpFile)))(MethodInvocation(SimpleName:getMimeType)(METHOD_INVOCATION_ARGUMENTS(SimpleName:OUTPUT_ZIP)))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(SimpleName:getLogManager)))(SimpleName:logInfo)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))(ReturnStatement(SimpleName:result))))))