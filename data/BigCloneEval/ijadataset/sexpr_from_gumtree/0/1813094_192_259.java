(CompilationUnit(TypeDeclaration(Modifier:public)(TYPE_DECLARATION_KIND:class)(SimpleName:Test)(MethodDeclaration(MarkerAnnotation(SimpleName:Test))(Modifier:public)(PrimitiveType:void)(SimpleName:testHandleReturnResponse)(SimpleType(SimpleName:Exception))(Block(VariableDeclarationStatement(SimpleType(SimpleName:SAML2ProtocolServiceAuthIdent))(VariableDeclarationFragment(SimpleName:saml2ProtocolService)(ClassInstanceCreation(SimpleType(SimpleName:SAML2ProtocolServiceAuthIdent)))))(VariableDeclarationStatement(SimpleType(SimpleName:String))(VariableDeclarationFragment(SimpleName:userId)(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:UUID))(SimpleName:randomUUID)))(SimpleName:toString))))(VariableDeclarationStatement(SimpleType(SimpleName:String))(VariableDeclarationFragment(SimpleName:givenName)(StringLiteral:<STR>)))(VariableDeclarationStatement(SimpleType(SimpleName:String))(VariableDeclarationFragment(SimpleName:surName)(StringLiteral:<STR>)))(VariableDeclarationStatement(SimpleType(SimpleName:Identity))(VariableDeclarationFragment(SimpleName:identity)(ClassInstanceCreation(SimpleType(SimpleName:Identity)))))(ExpressionStatement(Assignment(QualifiedName:identity.name)(ASSIGNMENT_OPERATOR:=)(SimpleName:surName)))(ExpressionStatement(Assignment(QualifiedName:identity.firstName)(ASSIGNMENT_OPERATOR:=)(SimpleName:givenName)))(ExpressionStatement(Assignment(QualifiedName:identity.gender)(ASSIGNMENT_OPERATOR:=)(QualifiedName:Gender.MALE)))(ExpressionStatement(Assignment(QualifiedName:identity.dateOfBirth)(ASSIGNMENT_OPERATOR:=)(ClassInstanceCreation(SimpleType(SimpleName:GregorianCalendar)))))(ExpressionStatement(Assignment(QualifiedName:identity.nationality)(ASSIGNMENT_OPERATOR:=)(StringLiteral:<STR>)))(ExpressionStatement(Assignment(QualifiedName:identity.placeOfBirth)(ASSIGNMENT_OPERATOR:=)(StringLiteral:<STR>)))(VariableDeclarationStatement(SimpleType(SimpleName:HttpSession))(VariableDeclarationFragment(SimpleName:mockHttpSession)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:createMock)(METHOD_INVOCATION_ARGUMENTS(TypeLiteral(SimpleType(SimpleName:HttpSession)))))))(VariableDeclarationStatement(SimpleType(SimpleName:HttpServletRequest))(VariableDeclarationFragment(SimpleName:mockHttpServletRequest)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:createMock)(METHOD_INVOCATION_ARGUMENTS(TypeLiteral(SimpleType(SimpleName:HttpServletRequest)))))))(VariableDeclarationStatement(SimpleType(SimpleName:HttpServletResponse))(VariableDeclarationFragment(SimpleName:mockHttpServletResponse)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:createMock)(METHOD_INVOCATION_ARGUMENTS(TypeLiteral(SimpleType(SimpleName:HttpServletResponse)))))))(VariableDeclarationStatement(SimpleType(SimpleName:ServletContext))(VariableDeclarationFragment(SimpleName:mockServletContext)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:createMock)(METHOD_INVOCATION_ARGUMENTS(TypeLiteral(SimpleType(SimpleName:ServletContext)))))))(VariableDeclarationStatement(SimpleType(SimpleName:KeyPair))(VariableDeclarationFragment(SimpleName:keyPair)(MethodInvocation(SimpleName:generateKeyPair))))(VariableDeclarationStatement(SimpleType(SimpleName:DateTime))(VariableDeclarationFragment(SimpleName:notBefore)(ClassInstanceCreation(SimpleType(SimpleName:DateTime)))))(VariableDeclarationStatement(SimpleType(SimpleName:DateTime))(VariableDeclarationFragment(SimpleName:notAfter)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:notBefore))(SimpleName:plusMonths)(METHOD_INVOCATION_ARGUMENTS(NumberLiteral:1)))))(VariableDeclarationStatement(SimpleType(SimpleName:X509Certificate))(VariableDeclarationFragment(SimpleName:certificate)(MethodInvocation(SimpleName:generateSelfSignedCertificate)(METHOD_INVOCATION_ARGUMENTS(SimpleName:keyPair)(StringLiteral:<STR>)(SimpleName:notBefore)(SimpleName:notAfter)))))(VariableDeclarationStatement(SimpleType(SimpleName:IdPIdentity))(VariableDeclarationFragment(SimpleName:idpIdentity)(ClassInstanceCreation(SimpleType(SimpleName:IdPIdentity))(StringLiteral:<STR>)(ClassInstanceCreation(SimpleType(QualifiedName:KeyStore.PrivateKeyEntry))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:keyPair))(SimpleName:getPrivate))(ArrayCreation(ArrayType(SimpleType(SimpleName:Certificate))(Dimension))(ArrayInitializer(SimpleName:certificate)))))))(VariableDeclarationStatement(SimpleType(SimpleName:IdentityProviderConfiguration))(VariableDeclarationFragment(SimpleName:mockConfiguration)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:createMock)(METHOD_INVOCATION_ARGUMENTS(TypeLiteral(SimpleType(SimpleName:IdentityProviderConfiguration)))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mockServletContext))(SimpleName:setAttribute)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:AbstractSAML2ProtocolService.IDP_CONFIG_CONTEXT_ATTRIBUTE)(SimpleName:mockConfiguration))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:expect)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mockHttpSession))(SimpleName:getServletContext)))))(SimpleName:andReturn)(METHOD_INVOCATION_ARGUMENTS(SimpleName:mockServletContext))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:expect)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mockServletContext))(SimpleName:getAttribute)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:AbstractSAML2ProtocolService.IDP_CONFIG_CONTEXT_ATTRIBUTE))))))(SimpleName:andReturn)(METHOD_INVOCATION_ARGUMENTS(SimpleName:mockConfiguration))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:expect)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mockHttpSession))(SimpleName:getAttribute)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:AbstractSAML2ProtocolService.TARGET_URL_SESSION_ATTRIBUTE))))))(SimpleName:andStubReturn)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:expect)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mockHttpSession))(SimpleName:getAttribute)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:AbstractSAML2ProtocolService.RELAY_STATE_SESSION_ATTRIBUTE))))))(SimpleName:andStubReturn)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:expect)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mockHttpSession))(SimpleName:getAttribute)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:AbstractSAML2ProtocolService.IN_RESPONSE_TO_SESSION_ATTRIBUTE))))))(SimpleName:andStubReturn)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:expect)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mockHttpSession))(SimpleName:getAttribute)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:AbstractSAML2ProtocolService.ISSUER_SESSION_ATTRIBUTE))))))(SimpleName:andStubReturn)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:expect)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mockHttpServletRequest))(SimpleName:getSession)))))(SimpleName:andReturn)(METHOD_INVOCATION_ARGUMENTS(SimpleName:mockHttpSession))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:expect)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mockHttpSession))(SimpleName:getServletContext)))))(SimpleName:andReturn)(METHOD_INVOCATION_ARGUMENTS(SimpleName:mockServletContext))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:expect)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mockServletContext))(SimpleName:getAttribute)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:AbstractSAML2ProtocolService.IDP_CONFIG_CONTEXT_ATTRIBUTE))))))(SimpleName:andReturn)(METHOD_INVOCATION_ARGUMENTS(SimpleName:mockConfiguration))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:expect)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mockConfiguration))(SimpleName:getResponseTokenValidity)))))(SimpleName:andStubReturn)(METHOD_INVOCATION_ARGUMENTS(NumberLiteral:5))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:expect)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mockConfiguration))(SimpleName:findIdentity)))))(SimpleName:andStubReturn)(METHOD_INVOCATION_ARGUMENTS(SimpleName:idpIdentity))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:expect)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mockConfiguration))(SimpleName:getIdentityCertificateChain)))))(SimpleName:andStubReturn)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:Collections))(SimpleName:singletonList)(METHOD_INVOCATION_ARGUMENTS(SimpleName:certificate))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:expect)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mockConfiguration))(SimpleName:getDefaultIssuer)))))(SimpleName:andStubReturn)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:replay)(METHOD_INVOCATION_ARGUMENTS(SimpleName:mockHttpServletRequest)(SimpleName:mockHttpSession)(SimpleName:mockServletContext)(SimpleName:mockConfiguration))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:saml2ProtocolService))(SimpleName:init)(METHOD_INVOCATION_ARGUMENTS(SimpleName:mockServletContext)(SimpleName:mockConfiguration))))(VariableDeclarationStatement(SimpleType(SimpleName:ReturnResponse))(VariableDeclarationFragment(SimpleName:returnResponse)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:saml2ProtocolService))(SimpleName:handleReturnResponse)(METHOD_INVOCATION_ARGUMENTS(SimpleName:mockHttpSession)(SimpleName:userId)(ClassInstanceCreation(ParameterizedType(SimpleType(SimpleName:HashMap))(SimpleType(SimpleName:String))(SimpleType(SimpleName:Attribute))))(NullLiteral)(NullLiteral)(NullLiteral)(SimpleName:mockHttpServletRequest)(SimpleName:mockHttpServletResponse)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EasyMock))(SimpleName:verify)(METHOD_INVOCATION_ARGUMENTS(SimpleName:mockHttpServletRequest)(SimpleName:mockHttpSession)(SimpleName:mockServletContext)(SimpleName:mockConfiguration))))(ExpressionStatement(MethodInvocation(SimpleName:assertNotNull)(METHOD_INVOCATION_ARGUMENTS(SimpleName:returnResponse))))(ExpressionStatement(MethodInvocation(SimpleName:assertEquals)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:returnResponse))(SimpleName:getActionUrl)))))(VariableDeclarationStatement(ParameterizedType(SimpleType(SimpleName:List))(SimpleType(SimpleName:NameValuePair)))(VariableDeclarationFragment(SimpleName:attributes)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:returnResponse))(SimpleName:getAttributes))))(ExpressionStatement(MethodInvocation(SimpleName:assertNotNull)(METHOD_INVOCATION_ARGUMENTS(SimpleName:attributes))))(VariableDeclarationStatement(SimpleType(SimpleName:NameValuePair))(VariableDeclarationFragment(SimpleName:relayStateAttribute)(NullLiteral)))(VariableDeclarationStatement(SimpleType(SimpleName:NameValuePair))(VariableDeclarationFragment(SimpleName:samlResponseAttribute)(NullLiteral)))(EnhancedForStatement(SingleVariableDeclaration(SimpleType(SimpleName:NameValuePair))(SimpleName:attribute))(SimpleName:attributes)(Block(IfStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(StringLiteral:<STR>))(SimpleName:equals)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:attribute))(SimpleName:getName))))(Block(ExpressionStatement(Assignment(SimpleName:relayStateAttribute)(ASSIGNMENT_OPERATOR:=)(SimpleName:attribute)))(ContinueStatement)))(IfStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(StringLiteral:<STR>))(SimpleName:equals)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:attribute))(SimpleName:getName))))(Block(ExpressionStatement(Assignment(SimpleName:samlResponseAttribute)(ASSIGNMENT_OPERATOR:=)(SimpleName:attribute)))(ContinueStatement)))))(ExpressionStatement(MethodInvocation(SimpleName:assertNotNull)(METHOD_INVOCATION_ARGUMENTS(SimpleName:relayStateAttribute))))(ExpressionStatement(MethodInvocation(SimpleName:assertEquals)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:relayStateAttribute))(SimpleName:getValue)))))(ExpressionStatement(MethodInvocation(SimpleName:assertNotNull)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)(SimpleName:samlResponseAttribute))))(VariableDeclarationStatement(SimpleType(SimpleName:String))(VariableDeclarationFragment(SimpleName:encodedSamlResponse)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:samlResponseAttribute))(SimpleName:getValue))))(ExpressionStatement(MethodInvocation(SimpleName:assertNotNull)(METHOD_INVOCATION_ARGUMENTS(SimpleName:encodedSamlResponse))))(VariableDeclarationStatement(SimpleType(SimpleName:String))(VariableDeclarationFragment(SimpleName:samlResponse)(ClassInstanceCreation(SimpleType(SimpleName:String))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:Base64))(SimpleName:decodeBase64)(METHOD_INVOCATION_ARGUMENTS(SimpleName:encodedSamlResponse))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:LOG))(SimpleName:debug)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(SimpleName:samlResponse)))))(VariableDeclarationStatement(SimpleType(SimpleName:File))(VariableDeclarationFragment(SimpleName:tmpFile)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:File))(SimpleName:createTempFile)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)(StringLiteral:<STR>)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:FileUtils))(SimpleName:writeStringToFile)(METHOD_INVOCATION_ARGUMENTS(SimpleName:tmpFile)(SimpleName:samlResponse))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:LOG))(SimpleName:debug)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:tmpFile))(SimpleName:getAbsolutePath))))))))))