(CompilationUnit(TypeDeclaration(Modifier:public)(TYPE_DECLARATION_KIND:class)(SimpleName:Test)(MethodDeclaration(MarkerAnnotation(SimpleName:Override))(Modifier:protected)(SimpleType(SimpleName:String))(SimpleName:execute)(SingleVariableDeclaration(SimpleType(SimpleName:Player))(SimpleName:player))(SingleVariableDeclaration(ParameterizedType(SimpleType(SimpleName:Map))(SimpleType(SimpleName:String))(SimpleType(SimpleName:Object)))(SimpleName:params))(SingleVariableDeclaration(SimpleType(SimpleName:Session))(SimpleName:session))(SimpleType(SimpleName:Exception))(Block(VariableDeclarationStatement(PrimitiveType:int)(VariableDeclarationFragment(SimpleName:idFleet)(CastExpression(SimpleType(SimpleName:Integer))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:params))(SimpleName:get)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))))(VariableDeclarationStatement(PrimitiveType:int)(VariableDeclarationFragment(SimpleName:resource)(CastExpression(SimpleType(SimpleName:Integer))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:params))(SimpleName:get)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))))(VariableDeclarationStatement(PrimitiveType:long)(VariableDeclarationFragment(SimpleName:count)(CastExpression(SimpleType(SimpleName:Long))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:params))(SimpleName:get)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))))(VariableDeclarationStatement(PrimitiveType:boolean)(VariableDeclarationFragment(SimpleName:sell)(InfixExpression(SimpleName:count)(INFIX_EXPRESSION_OPERATOR:<)(NumberLiteral:0))))(IfStatement(SimpleName:sell)(ExpressionStatement(Assignment(SimpleName:count)(ASSIGNMENT_OPERATOR:=)(PrefixExpression(PREFIX_EXPRESSION_OPERATOR:-)(SimpleName:count)))))(VariableDeclarationStatement(SimpleType(SimpleName:Fleet))(VariableDeclarationFragment(SimpleName:fleet)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:FleetTools))(SimpleName:getFleetByIdWithChecks)(METHOD_INVOCATION_ARGUMENTS(SimpleName:idFleet)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:player))(SimpleName:getId))))))(VariableDeclarationStatement(ParameterizedType(SimpleType(SimpleName:List))(SimpleType(SimpleName:StellarObject)))(VariableDeclarationFragment(SimpleName:objects)(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:fleet))(SimpleName:getArea)))(SimpleName:getObjects))))(VariableDeclarationStatement(PrimitiveType:int)(VariableDeclarationFragment(SimpleName:idTradecenter)(PrefixExpression(PREFIX_EXPRESSION_OPERATOR:-)(NumberLiteral:1))))(SynchronizedStatement(SimpleName:objects)(Block(EnhancedForStatement(SingleVariableDeclaration(SimpleType(SimpleName:StellarObject))(SimpleName:object))(SimpleName:objects)(IfStatement(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:object))(SimpleName:getType)))(SimpleName:equals)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:StellarObject.TYPE_TRADECENTER)))(INFIX_EXPRESSION_OPERATOR:&&)(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:object))(SimpleName:getBounds)))(SimpleName:contains)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:fleet))(SimpleName:getCurrentX))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:fleet))(SimpleName:getCurrentY)))))(Block(ExpressionStatement(Assignment(SimpleName:idTradecenter)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:object))(SimpleName:getId))))(BreakStatement))))))(IfStatement(InfixExpression(SimpleName:idTradecenter)(INFIX_EXPRESSION_OPERATOR:==)(PrefixExpression(PREFIX_EXPRESSION_OPERATOR:-)(NumberLiteral:1)))(ThrowStatement(ClassInstanceCreation(SimpleType(SimpleName:IllegalOperationException))(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(StringLiteral:<STR>)))))(VariableDeclarationStatement(SimpleType(SimpleName:Tradecenter))(VariableDeclarationFragment(SimpleName:tradecenter)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:DataAccess))(SimpleName:getTradecenterById)(METHOD_INVOCATION_ARGUMENTS(SimpleName:idTradecenter)))))(VariableDeclarationStatement(SimpleType(SimpleName:ItemContainer))(VariableDeclarationFragment(SimpleName:itemContainer)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:fleet))(SimpleName:getItemContainer))))(IfStatement(InfixExpression(SimpleName:sell)(INFIX_EXPRESSION_OPERATOR:&&)(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:itemContainer))(SimpleName:getResource)(METHOD_INVOCATION_ARGUMENTS(SimpleName:resource)))(INFIX_EXPRESSION_OPERATOR:<)(SimpleName:count)))(ThrowStatement(ClassInstanceCreation(SimpleType(SimpleName:IllegalOperationException))(StringLiteral:<STR>))))(VariableDeclarationStatement(PrimitiveType:double)(VariableDeclarationFragment(SimpleName:rateBefore)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:tradecenter))(SimpleName:getRate)(METHOD_INVOCATION_ARGUMENTS(SimpleName:resource)))))(VariableDeclarationStatement(PrimitiveType:double)(VariableDeclarationFragment(SimpleName:rateAfter)(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:tradecenter))(SimpleName:getRate)(METHOD_INVOCATION_ARGUMENTS(SimpleName:resource)))(INFIX_EXPRESSION_OPERATOR:+)(InfixExpression(ParenthesizedExpression(ConditionalExpression(SimpleName:sell)(PrefixExpression(PREFIX_EXPRESSION_OPERATOR:-)(NumberLiteral:1))(NumberLiteral:1)))(INFIX_EXPRESSION_OPERATOR:*)(SimpleName:count)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:tradecenter))(SimpleName:getVariation))))))(VariableDeclarationStatement(PrimitiveType:double)(VariableDeclarationFragment(SimpleName:rate)(InfixExpression(ParenthesizedExpression(InfixExpression(SimpleName:rateAfter)(INFIX_EXPRESSION_OPERATOR:+)(SimpleName:rateBefore)))(INFIX_EXPRESSION_OPERATOR:/)(NumberLiteral:2))))(VariableDeclarationStatement(PrimitiveType:double)(VariableDeclarationFragment(SimpleName:min)(NumberLiteral:.005)))(VariableDeclarationStatement(PrimitiveType:double)(VariableDeclarationFragment(SimpleName:max)(NumberLiteral:9.52)))(IfStatement(InfixExpression(SimpleName:rateAfter)(INFIX_EXPRESSION_OPERATOR:<)(SimpleName:min))(Block(VariableDeclarationStatement(PrimitiveType:double)(VariableDeclarationFragment(SimpleName:coef)(InfixExpression(ParenthesizedExpression(InfixExpression(SimpleName:rateBefore)(INFIX_EXPRESSION_OPERATOR:-)(SimpleName:min)))(INFIX_EXPRESSION_OPERATOR:/)(ParenthesizedExpression(InfixExpression(SimpleName:rateBefore)(INFIX_EXPRESSION_OPERATOR:-)(SimpleName:rateAfter))))))(ExpressionStatement(Assignment(SimpleName:rate)(ASSIGNMENT_OPERATOR:=)(InfixExpression(InfixExpression(InfixExpression(SimpleName:coef)(INFIX_EXPRESSION_OPERATOR:*)(ParenthesizedExpression(InfixExpression(SimpleName:rateBefore)(INFIX_EXPRESSION_OPERATOR:-)(SimpleName:min))))(INFIX_EXPRESSION_OPERATOR:/)(NumberLiteral:2))(INFIX_EXPRESSION_OPERATOR:+)(InfixExpression(ParenthesizedExpression(InfixExpression(NumberLiteral:1)(INFIX_EXPRESSION_OPERATOR:-)(SimpleName:coef)))(INFIX_EXPRESSION_OPERATOR:*)(SimpleName:min)))))(ExpressionStatement(Assignment(SimpleName:rateAfter)(ASSIGNMENT_OPERATOR:=)(SimpleName:min))))(IfStatement(InfixExpression(SimpleName:rateAfter)(INFIX_EXPRESSION_OPERATOR:>)(SimpleName:max))(Block(VariableDeclarationStatement(PrimitiveType:double)(VariableDeclarationFragment(SimpleName:coef)(InfixExpression(ParenthesizedExpression(InfixExpression(SimpleName:max)(INFIX_EXPRESSION_OPERATOR:-)(SimpleName:rateBefore)))(INFIX_EXPRESSION_OPERATOR:/)(ParenthesizedExpression(InfixExpression(SimpleName:rateAfter)(INFIX_EXPRESSION_OPERATOR:-)(SimpleName:rateBefore))))))(ExpressionStatement(Assignment(SimpleName:rate)(ASSIGNMENT_OPERATOR:=)(InfixExpression(InfixExpression(InfixExpression(SimpleName:coef)(INFIX_EXPRESSION_OPERATOR:*)(ParenthesizedExpression(InfixExpression(SimpleName:max)(INFIX_EXPRESSION_OPERATOR:-)(SimpleName:rateBefore))))(INFIX_EXPRESSION_OPERATOR:/)(NumberLiteral:2))(INFIX_EXPRESSION_OPERATOR:+)(InfixExpression(ParenthesizedExpression(InfixExpression(NumberLiteral:1)(INFIX_EXPRESSION_OPERATOR:-)(SimpleName:coef)))(INFIX_EXPRESSION_OPERATOR:*)(SimpleName:max)))))(ExpressionStatement(Assignment(SimpleName:rateAfter)(ASSIGNMENT_OPERATOR:=)(SimpleName:max))))(Block(ExpressionStatement(Assignment(SimpleName:rate)(ASSIGNMENT_OPERATOR:=)(InfixExpression(ParenthesizedExpression(InfixExpression(SimpleName:rateAfter)(INFIX_EXPRESSION_OPERATOR:+)(SimpleName:rateBefore)))(INFIX_EXPRESSION_OPERATOR:/)(NumberLiteral:2)))))))(ExpressionStatement(Assignment(SimpleName:rate)(ASSIGNMENT_OPERATOR:*=)(ParenthesizedExpression(InfixExpression(NumberLiteral:1)(INFIX_EXPRESSION_OPERATOR:+)(ParenthesizedExpression(ConditionalExpression(SimpleName:sell)(PrefixExpression(PREFIX_EXPRESSION_OPERATOR:-)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:tradecenter))(SimpleName:getPlayerFees)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:player))(SimpleName:getId)))))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:tradecenter))(SimpleName:getPlayerFees)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:player))(SimpleName:getId))))))))))(ExpressionStatement(Assignment(SimpleName:player)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:Player))(SimpleName:updateCredits)(METHOD_INVOCATION_ARGUMENTS(SimpleName:player)))))(VariableDeclarationStatement(PrimitiveType:long)(VariableDeclarationFragment(SimpleName:credits)(CastExpression(PrimitiveType:long)(ParenthesizedExpression(ConditionalExpression(SimpleName:sell)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:Math))(SimpleName:floor)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(SimpleName:rate)(INFIX_EXPRESSION_OPERATOR:*)(SimpleName:count))))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:Math))(SimpleName:ceil)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(SimpleName:rate)(INFIX_EXPRESSION_OPERATOR:*)(SimpleName:count)))))))))(IfStatement(InfixExpression(PrefixExpression(PREFIX_EXPRESSION_OPERATOR:!)(SimpleName:sell))(INFIX_EXPRESSION_OPERATOR:&&)(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:player))(SimpleName:getCredits))(INFIX_EXPRESSION_OPERATOR:<)(SimpleName:credits)))(ThrowStatement(ClassInstanceCreation(SimpleType(SimpleName:IllegalOperationException))(StringLiteral:<STR>))))(IfStatement(InfixExpression(PrefixExpression(PREFIX_EXPRESSION_OPERATOR:!)(SimpleName:sell))(INFIX_EXPRESSION_OPERATOR:&&)(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:itemContainer))(SimpleName:getCompatibleOrFreePosition)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:Item.TYPE_RESOURCE)(SimpleName:resource)))(INFIX_EXPRESSION_OPERATOR:==)(PrefixExpression(PREFIX_EXPRESSION_OPERATOR:-)(NumberLiteral:1))))(ThrowStatement(ClassInstanceCreation(SimpleType(SimpleName:IllegalOperationException))(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(StringLiteral:<STR>)))))(SynchronizedStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:player))(SimpleName:getLock))(Block(ExpressionStatement(Assignment(SimpleName:player)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:DataAccess))(SimpleName:getEditable)(METHOD_INVOCATION_ARGUMENTS(SimpleName:player)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:player))(SimpleName:addCredits)(METHOD_INVOCATION_ARGUMENTS(ConditionalExpression(SimpleName:sell)(SimpleName:credits)(PrefixExpression(PREFIX_EXPRESSION_OPERATOR:-)(SimpleName:credits))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:player))(SimpleName:save)))))(IfStatement(SimpleName:sell)(Block(ForStatement(VariableDeclarationExpression(PrimitiveType:int)(VariableDeclarationFragment(SimpleName:i)(NumberLiteral:0)))(InfixExpression(SimpleName:i)(INFIX_EXPRESSION_OPERATOR:<)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:itemContainer))(SimpleName:getMaxItems)))(PostfixExpression(SimpleName:i)(POSTFIX_EXPRESSION_OPERATOR:++))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(QualifiedName:System.out))(SimpleName:println)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:itemContainer))(SimpleName:getItem)(METHOD_INVOCATION_ARGUMENTS(SimpleName:i))))(SimpleName:getType))(INFIX_EXPRESSION_OPERATOR:+)(StringLiteral:<STR>)(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:itemContainer))(SimpleName:getItem)(METHOD_INVOCATION_ARGUMENTS(SimpleName:i))))(SimpleName:getCount)))))))(SynchronizedStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:itemContainer))(SimpleName:getLock))(Block(ExpressionStatement(Assignment(SimpleName:itemContainer)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:DataAccess))(SimpleName:getEditable)(METHOD_INVOCATION_ARGUMENTS(SimpleName:itemContainer)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:itemContainer))(SimpleName:addResource)(METHOD_INVOCATION_ARGUMENTS(PrefixExpression(PREFIX_EXPRESSION_OPERATOR:-)(SimpleName:count))(SimpleName:resource))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:itemContainer))(SimpleName:save)))))(ForStatement(VariableDeclarationExpression(PrimitiveType:int)(VariableDeclarationFragment(SimpleName:i)(NumberLiteral:0)))(InfixExpression(SimpleName:i)(INFIX_EXPRESSION_OPERATOR:<)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:itemContainer))(SimpleName:getMaxItems)))(PostfixExpression(SimpleName:i)(POSTFIX_EXPRESSION_OPERATOR:++))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(QualifiedName:System.out))(SimpleName:println)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:itemContainer))(SimpleName:getItem)(METHOD_INVOCATION_ARGUMENTS(SimpleName:i))))(SimpleName:getType))(INFIX_EXPRESSION_OPERATOR:+)(StringLiteral:<STR>)(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:itemContainer))(SimpleName:getItem)(METHOD_INVOCATION_ARGUMENTS(SimpleName:i))))(SimpleName:getCount))))))))(Block(VariableDeclarationStatement(PrimitiveType:double)(VariableDeclarationFragment(SimpleName:totalWeight)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:itemContainer))(SimpleName:getTotalWeight))))(VariableDeclarationStatement(PrimitiveType:long)(VariableDeclarationFragment(SimpleName:newResources)(SimpleName:count)))(IfStatement(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:fleet))(SimpleName:getPayload))(INFIX_EXPRESSION_OPERATOR:<)(InfixExpression(SimpleName:totalWeight)(INFIX_EXPRESSION_OPERATOR:+)(SimpleName:count)))(ExpressionStatement(Assignment(SimpleName:newResources)(ASSIGNMENT_OPERATOR:=)(CastExpression(PrimitiveType:long)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:Math))(SimpleName:floor)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:fleet))(SimpleName:getPayload))(INFIX_EXPRESSION_OPERATOR:-)(SimpleName:totalWeight))))))))(SynchronizedStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:itemContainer))(SimpleName:getLock))(Block(ExpressionStatement(Assignment(SimpleName:itemContainer)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:DataAccess))(SimpleName:getEditable)(METHOD_INVOCATION_ARGUMENTS(SimpleName:itemContainer)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:itemContainer))(SimpleName:addResource)(METHOD_INVOCATION_ARGUMENTS(SimpleName:newResources)(SimpleName:resource))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:itemContainer))(SimpleName:save)))))))(SynchronizedStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:tradecenter))(SimpleName:getLock))(Block(ExpressionStatement(Assignment(SimpleName:tradecenter)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:DataAccess))(SimpleName:getEditable)(METHOD_INVOCATION_ARGUMENTS(SimpleName:tradecenter)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:tradecenter))(SimpleName:setRate)(METHOD_INVOCATION_ARGUMENTS(SimpleName:rateAfter)(SimpleName:resource))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:tradecenter))(SimpleName:save)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:GameEventsDispatcher))(SimpleName:fireGameEvent)(METHOD_INVOCATION_ARGUMENTS(ClassInstanceCreation(SimpleType(SimpleName:AfterTradeEvent))(SimpleName:fleet)(SimpleName:sell)(SimpleName:resource)(SimpleName:count)))))(ReturnStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:UpdateTools))(SimpleName:formatUpdates)(METHOD_INVOCATION_ARGUMENTS(SimpleName:player)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:Update))(SimpleName:getPlayerFleetUpdate)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:fleet))(SimpleName:getId))))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:Update))(SimpleName:getPlayerSystemsUpdate)))))))))