(CompilationUnit(TypeDeclaration(Modifier:public)(TYPE_DECLARATION_KIND:class)(SimpleName:Test)(MethodDeclaration(MarkerAnnotation(SimpleName:Override))(Modifier:public)(Modifier:synchronized)(PrimitiveType:boolean)(SimpleName:login)(SimpleType(SimpleName:LoginException))(Block(IfStatement(InfixExpression(SimpleName:mCallbackHandler)(INFIX_EXPRESSION_OPERATOR:==)(NullLiteral))(Block(ThrowStatement(ClassInstanceCreation(SimpleType(SimpleName:LoginException))(StringLiteral:<STR>)))))(VariableDeclarationStatement(PrimitiveType:boolean)(VariableDeclarationFragment(SimpleName:authenticated)(BooleanLiteral:false)))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mPrincipals))(SimpleName:clear)))(TryStatement(Block(VariableDeclarationStatement(Modifier:final)(SimpleType(SimpleName:CredentialsCallback))(VariableDeclarationFragment(SimpleName:ccb)(ClassInstanceCreation(SimpleType(SimpleName:CredentialsCallback)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mCallbackHandler))(SimpleName:handle)(METHOD_INVOCATION_ARGUMENTS(ArrayCreation(ArrayType(SimpleType(SimpleName:Callback))(Dimension))(ArrayInitializer(SimpleName:ccb))))))(VariableDeclarationStatement(Modifier:final)(SimpleType(SimpleName:Credentials))(VariableDeclarationFragment(SimpleName:creds)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:ccb))(SimpleName:getCredentials))))(IfStatement(InfixExpression(SimpleName:creds)(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(Block(IfStatement(InstanceofExpression(SimpleName:creds)(SimpleType(SimpleName:CARS_Credentials)))(Block(VariableDeclarationStatement(SimpleType(SimpleName:UserPrincipal))(VariableDeclarationFragment(SimpleName:userP)(NullLiteral)))(VariableDeclarationStatement(Modifier:final)(SimpleType(SimpleName:CARS_Credentials))(VariableDeclarationFragment(SimpleName:sc)(CastExpression(SimpleType(SimpleName:CARS_Credentials))(SimpleName:creds))))(VariableDeclarationStatement(SimpleType(SimpleName:String))(VariableDeclarationFragment(SimpleName:userName)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:CARS_Utils))(SimpleName:decode)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:sc))(SimpleName:getUserID))))))(VariableDeclarationStatement(Modifier:final)(SimpleType(SimpleName:Object))(VariableDeclarationFragment(SimpleName:attr)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:sc))(SimpleName:getAttribute)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:SecurityConstants.IMPERSONATOR_ATTRIBUTE)))))(IfStatement(InfixExpression(InfixExpression(SimpleName:attr)(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(INFIX_EXPRESSION_OPERATOR:&&)(InstanceofExpression(SimpleName:attr)(SimpleType(SimpleName:Subject))))(Block)(Block(IfStatement(PrefixExpression(PREFIX_EXPRESSION_OPERATOR:!)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:userName))(SimpleName:equals)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:CARS_AccessManager.gSuperuserName))))(Block(VariableDeclarationStatement(Modifier:final)(SimpleType(SimpleName:Session))(VariableDeclarationFragment(SimpleName:loginSession)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:CARS_Factory))(SimpleName:getSystemLoginSession))))(IfStatement(InfixExpression(SimpleName:loginSession)(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(Block(SynchronizedStatement(SimpleName:loginSession)(Block(IfStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:userName))(SimpleName:startsWith)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:CARS_AccountsApp.AUTHKEY_PREFIX)))(Block(VariableDeclarationStatement(Modifier:final)(SimpleType(SimpleName:String))(VariableDeclarationFragment(SimpleName:authKey)(SimpleName:userName)))(ExpressionStatement(Assignment(SimpleName:userName)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(SimpleName:getKeyNodeName)(METHOD_INVOCATION_ARGUMENTS(SimpleName:authKey)))))(VariableDeclarationStatement(Modifier:final)(SimpleType(SimpleName:Node))(VariableDeclarationFragment(SimpleName:users)(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:CARS_Factory))(SimpleName:getSystemLoginSession)))(SimpleName:getRootNode)))(SimpleName:getNode)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:CARS_AccessManager.gUsersPath)))))(IfStatement(InfixExpression(ParenthesizedExpression(InfixExpression(SimpleName:userName)(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral)))(INFIX_EXPRESSION_OPERATOR:&&)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:users))(SimpleName:hasNode)(METHOD_INVOCATION_ARGUMENTS(SimpleName:userName))))(Block(VariableDeclarationStatement(Modifier:final)(SimpleType(SimpleName:Node))(VariableDeclarationFragment(SimpleName:user)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:users))(SimpleName:getNode)(METHOD_INVOCATION_ARGUMENTS(SimpleName:userName)))))(IfStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:user))(SimpleName:hasProperty)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:CARS_AccessManager.gPasswordProperty)))(Block(ExpressionStatement(Assignment(SimpleName:userP)(ASSIGNMENT_OPERATOR:=)(ClassInstanceCreation(SimpleType(SimpleName:UserPrincipal))(SimpleName:userName))))(ExpressionStatement(Assignment(SimpleName:authenticated)(ASSIGNMENT_OPERATOR:=)(BooleanLiteral:true))))))(Block(ExpressionStatement(Assignment(SimpleName:userName)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:CARS_AccountsApp))(SimpleName:checkCircleOfTrust)(METHOD_INVOCATION_ARGUMENTS(SimpleName:sc)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:authKey))(SimpleName:substring)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(QualifiedName:CARS_AccountsApp.AUTHKEY_PREFIX))(SimpleName:length))))))))(IfStatement(InfixExpression(ParenthesizedExpression(InfixExpression(SimpleName:userName)(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral)))(INFIX_EXPRESSION_OPERATOR:&&)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:users))(SimpleName:hasNode)(METHOD_INVOCATION_ARGUMENTS(SimpleName:userName))))(Block(VariableDeclarationStatement(Modifier:final)(SimpleType(SimpleName:Node))(VariableDeclarationFragment(SimpleName:user)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:users))(SimpleName:getNode)(METHOD_INVOCATION_ARGUMENTS(SimpleName:userName)))))(IfStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:user))(SimpleName:hasProperty)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:CARS_AccessManager.gPasswordProperty)))(Block(ExpressionStatement(Assignment(SimpleName:userP)(ASSIGNMENT_OPERATOR:=)(ClassInstanceCreation(SimpleType(SimpleName:UserPrincipal))(SimpleName:userName))))(ExpressionStatement(Assignment(SimpleName:authenticated)(ASSIGNMENT_OPERATOR:=)(BooleanLiteral:true))))))(Block(ThrowStatement(ClassInstanceCreation(SimpleType(SimpleName:LoginException))(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(SimpleName:authKey)))))))))(Block(VariableDeclarationStatement(Modifier:final)(SimpleType(SimpleName:Node))(VariableDeclarationFragment(SimpleName:users)(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:CARS_Factory))(SimpleName:getSystemLoginSession)))(SimpleName:getRootNode)))(SimpleName:getNode)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:CARS_AccessManager.gUsersPath)))))(IfStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:users))(SimpleName:hasNode)(METHOD_INVOCATION_ARGUMENTS(SimpleName:userName)))(Block(VariableDeclarationStatement(Modifier:final)(SimpleType(SimpleName:Node))(VariableDeclarationFragment(SimpleName:user)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:users))(SimpleName:getNode)(METHOD_INVOCATION_ARGUMENTS(SimpleName:userName)))))(IfStatement(InfixExpression(ParenthesizedExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:user))(SimpleName:hasProperty)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))(INFIX_EXPRESSION_OPERATOR:&&)(ParenthesizedExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:user))(SimpleName:getProperty)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))(SimpleName:getBoolean))))(Block(ThrowStatement(ClassInstanceCreation(SimpleType(SimpleName:AccountLockedException))(InfixExpression(SimpleName:userName)(INFIX_EXPRESSION_OPERATOR:+)(StringLiteral:<STR>))))))(VariableDeclarationStatement(Modifier:final)(SimpleType(SimpleName:String))(VariableDeclarationFragment(SimpleName:password)(ClassInstanceCreation(SimpleType(SimpleName:String))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:sc))(SimpleName:getPassword)))))(IfStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:password))(SimpleName:startsWith)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(QualifiedName:JeCARS_RESTServlet.AUTH_TYPE.DIGEST))(SimpleName:toString))))(Block(IfStatement(ParenthesizedExpression(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:user))(SimpleName:isNodeType)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))(INFIX_EXPRESSION_OPERATOR:&&)(ParenthesizedExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:user))(SimpleName:hasProperty)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))))(Block(VariableDeclarationStatement(Modifier:final)(SimpleType(SimpleName:String))(VariableDeclarationFragment(SimpleName:checkPass)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:password))(SimpleName:substring)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(QualifiedName:JeCARS_RESTServlet.AUTH_TYPE.DIGEST))(SimpleName:toString)))(SimpleName:length))(INFIX_EXPRESSION_OPERATOR:+)(NumberLiteral:1))))))(VariableDeclarationStatement(Modifier:final)(ArrayType(SimpleType(SimpleName:String))(Dimension))(VariableDeclarationFragment(SimpleName:pass)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:checkPass))(SimpleName:split)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))))(VariableDeclarationStatement(Modifier:final)(SimpleType(SimpleName:String))(VariableDeclarationFragment(SimpleName:response)(ArrayAccess(SimpleName:pass)(NumberLiteral:0))))(VariableDeclarationStatement(Modifier:final)(SimpleType(SimpleName:MessageDigest))(VariableDeclarationFragment(SimpleName:md)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:MessageDigest))(SimpleName:getInstance)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))))(VariableDeclarationStatement(Modifier:final)(ArrayType(PrimitiveType:byte)(Dimension))(VariableDeclarationFragment(SimpleName:md5)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:md))(SimpleName:digest)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(ParenthesizedExpression(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:user))(SimpleName:getProperty)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))(SimpleName:getString))(INFIX_EXPRESSION_OPERATOR:+)(ArrayAccess(SimpleName:pass)(NumberLiteral:1)))))(SimpleName:getBytes))))))(IfStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:StringUtil))(SimpleName:bytesToHexString)(METHOD_INVOCATION_ARGUMENTS(SimpleName:md5))))(SimpleName:equals)(METHOD_INVOCATION_ARGUMENTS(SimpleName:response)))(Block(ExpressionStatement(Assignment(SimpleName:authenticated)(ASSIGNMENT_OPERATOR:=)(BooleanLiteral:true))))))))(Block(IfStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:user))(SimpleName:hasProperty)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:CARS_AccessManager.gPasswordProperty)))(Block(IfStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:user))(SimpleName:getProperty)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:CARS_AccessManager.gPasswordProperty))))(SimpleName:getString)))(SimpleName:equals)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:CARS_PasswordService))(SimpleName:getInstance)))(SimpleName:encrypt)(METHOD_INVOCATION_ARGUMENTS(SimpleName:password)))))(Block(ExpressionStatement(Assignment(SimpleName:authenticated)(ASSIGNMENT_OPERATOR:=)(BooleanLiteral:true))))))))))))))))))(Block(ExpressionStatement(Assignment(SimpleName:authenticated)(ASSIGNMENT_OPERATOR:=)(SimpleName:gSuperuserAllowed)))))))(IfStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mAnonymousUserId))(SimpleName:equals)(METHOD_INVOCATION_ARGUMENTS(SimpleName:userName)))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mPrincipals))(SimpleName:add)(METHOD_INVOCATION_ARGUMENTS(ClassInstanceCreation(SimpleType(SimpleName:AnonymousPrincipal)))))))(Block(IfStatement(InfixExpression(SimpleName:userP)(INFIX_EXPRESSION_OPERATOR:==)(NullLiteral))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mPrincipals))(SimpleName:add)(METHOD_INVOCATION_ARGUMENTS(ClassInstanceCreation(SimpleType(SimpleName:UserPrincipal))(SimpleName:userName))))))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mPrincipals))(SimpleName:add)(METHOD_INVOCATION_ARGUMENTS(SimpleName:userP)))))))))))(IfStatement(InfixExpression(SimpleName:mDefaultUserId)(INFIX_EXPRESSION_OPERATOR:==)(NullLiteral))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mPrincipals))(SimpleName:add)(METHOD_INVOCATION_ARGUMENTS(ClassInstanceCreation(SimpleType(SimpleName:AnonymousPrincipal))))))(ExpressionStatement(Assignment(SimpleName:authenticated)(ASSIGNMENT_OPERATOR:=)(BooleanLiteral:true))))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mPrincipals))(SimpleName:add)(METHOD_INVOCATION_ARGUMENTS(ClassInstanceCreation(SimpleType(SimpleName:UserPrincipal))(SimpleName:mDefaultUserId)))))(ExpressionStatement(Assignment(SimpleName:authenticated)(ASSIGNMENT_OPERATOR:=)(BooleanLiteral:true)))))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:RepositoryException))(SimpleName:re))(Block(ThrowStatement(ClassInstanceCreation(SimpleType(SimpleName:LoginException))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:re))(SimpleName:getMessage))))))(CatchClause(SingleVariableDeclaration(SimpleType(QualifiedName:java.io.IOException))(SimpleName:ioe))(Block(ThrowStatement(ClassInstanceCreation(SimpleType(SimpleName:LoginException))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:ioe))(SimpleName:toString))))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:UnsupportedCallbackException))(SimpleName:uce))(Block(ThrowStatement(ClassInstanceCreation(SimpleType(SimpleName:LoginException))(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:uce))(SimpleName:getCallback)))(SimpleName:toString))(INFIX_EXPRESSION_OPERATOR:+)(StringLiteral:<STR>))))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:AccountLockedException))(SimpleName:ale))(Block(ThrowStatement(SimpleName:ale))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:Exception))(SimpleName:ne))(Block(ThrowStatement(ClassInstanceCreation(SimpleType(SimpleName:LoginException))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:ne))(SimpleName:getMessage)))))))(IfStatement(SimpleName:authenticated)(Block(ReturnStatement(PrefixExpression(PREFIX_EXPRESSION_OPERATOR:!)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mPrincipals))(SimpleName:isEmpty)))))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mPrincipals))(SimpleName:clear)))(ThrowStatement(ClassInstanceCreation(SimpleType(SimpleName:FailedLoginException))))))))))