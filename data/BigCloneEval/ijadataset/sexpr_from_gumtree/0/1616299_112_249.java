(CompilationUnit(TypeDeclaration(Modifier:public)(TYPE_DECLARATION_KIND:class)(SimpleName:Test)(MethodDeclaration(Modifier:public)(SimpleType(SimpleName:MimeMessageHelper))(SimpleName:populateEmailTemplate)(SingleVariableDeclaration(SimpleType(SimpleName:EmailQueue))(SimpleName:emailQueue))(SingleVariableDeclaration(SimpleType(SimpleName:MimeMessageHelper))(SimpleName:helper))(SimpleType(SimpleName:EmailEngineException))(Block(VariableDeclarationStatement(ParameterizedType(SimpleType(SimpleName:Map))(SimpleType(SimpleName:String))(SimpleType(SimpleName:String)))(VariableDeclarationFragment(SimpleName:model)(ClassInstanceCreation(ParameterizedType(SimpleType(SimpleName:HashMap))(SimpleType(SimpleName:String))(SimpleType(SimpleName:String))))))(VariableDeclarationStatement(ParameterizedType(SimpleType(SimpleName:Set))(SimpleType(SimpleName:EmailField)))(VariableDeclarationFragment(SimpleName:emailFields)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:emailQueue))(SimpleName:getEmailFields))))(EnhancedForStatement(SingleVariableDeclaration(SimpleType(SimpleName:EmailField))(SimpleName:field))(SimpleName:emailFields)(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:model))(SimpleName:put)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:field))(SimpleName:getFieldName))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:field))(SimpleName:getFieldValue)))))))(VariableDeclarationStatement(SimpleType(SimpleName:VelocityContext))(VariableDeclarationFragment(SimpleName:context)(ClassInstanceCreation(SimpleType(SimpleName:VelocityContext))(SimpleName:model))))(VariableDeclarationStatement(SimpleType(SimpleName:Template))(VariableDeclarationFragment(SimpleName:template)(NullLiteral)))(VariableDeclarationStatement(SimpleType(SimpleName:StringWriter))(VariableDeclarationFragment(SimpleName:contentSw)(NullLiteral)))(VariableDeclarationStatement(SimpleType(SimpleName:String))(VariableDeclarationFragment(SimpleName:templateType)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:emailQueue))(SimpleName:getTemplateType))))(VariableDeclarationStatement(SimpleType(SimpleName:VelocityTemplate))(VariableDeclarationFragment(SimpleName:velocityTemplate)(NullLiteral)))(TryStatement(Block(ExpressionStatement(Assignment(SimpleName:velocityTemplate)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:velocityTemplateManager))(SimpleName:getTemplate)(METHOD_INVOCATION_ARGUMENTS(SimpleName:templateType))))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:ObjectNotFoundException))(SimpleName:e1))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:log))(SimpleName:warn)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(SimpleName:templateType))))))))(TryStatement(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:log))(SimpleName:debug)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(SimpleName:templateType)))))(ExpressionStatement(Assignment(SimpleName:template)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:engine))(SimpleName:getTemplate)(METHOD_INVOCATION_ARGUMENTS(SimpleName:templateType)))))(ExpressionStatement(Assignment(SimpleName:contentSw)(ASSIGNMENT_OPERATOR:=)(ClassInstanceCreation(SimpleType(SimpleName:StringWriter)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:log))(SimpleName:debug)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:template))(SimpleName:merge)(METHOD_INVOCATION_ARGUMENTS(SimpleName:context)(SimpleName:contentSw)))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:ResourceNotFoundException))(SimpleName:rnfe))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:log))(SimpleName:warn)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(SimpleName:templateType))(SimpleName:rnfe))))(ThrowStatement(ClassInstanceCreation(SimpleType(SimpleName:EmailEngineException))(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(SimpleName:templateType))))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:ParseErrorException))(SimpleName:pee))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:log))(SimpleName:warn)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)(SimpleName:pee))))(ThrowStatement(ClassInstanceCreation(SimpleType(SimpleName:EmailEngineException))(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:pee))(SimpleName:getMessage)))))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:MethodInvocationException))(SimpleName:mie))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:log))(SimpleName:warn)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)(SimpleName:mie))))(ThrowStatement(ClassInstanceCreation(SimpleType(SimpleName:EmailEngineException))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mie))(SimpleName:getMessage))))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:Exception))(SimpleName:e))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:log))(SimpleName:warn)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)(SimpleName:e))))(ThrowStatement(ClassInstanceCreation(SimpleType(SimpleName:EmailEngineException))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:e))(SimpleName:getMessage)))))))(TryStatement(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:helper))(SimpleName:setTo)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:emailQueue))(SimpleName:getTo)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:helper))(SimpleName:setSubject)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:emailQueue))(SimpleName:getSubject)))))(TryStatement(Block(IfStatement(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:model))(SimpleName:containsKey)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))(INFIX_EXPRESSION_OPERATOR:&&)(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:model))(SimpleName:get)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))(SimpleName:equalsIgnoreCase)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))(Block(VariableDeclarationStatement(ParameterizedType(SimpleType(SimpleName:Map))(SimpleType(SimpleName:String))(SimpleType(SimpleName:String)))(VariableDeclarationFragment(SimpleName:htmlModel)(ClassInstanceCreation(ParameterizedType(SimpleType(SimpleName:HashMap))(SimpleType(SimpleName:String))(SimpleType(SimpleName:String))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:htmlModel))(SimpleName:put)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)(ConditionalExpression(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:velocityTemplate))(SimpleName:getTitle))(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:velocityTemplate))(SimpleName:getTitle))(StringLiteral:<STR>)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:htmlModel))(SimpleName:put)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:contentSw))(SimpleName:toString)))))(IfStatement(InfixExpression(SimpleName:velocityTemplate)(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(Block(VariableDeclarationStatement(SimpleType(SimpleName:String))(VariableDeclarationFragment(SimpleName:langCode)(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:velocityTemplate))(SimpleName:getTemplateType)))(SimpleName:substring)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:velocityTemplate))(SimpleName:getTemplateType)))(SimpleName:length))(INFIX_EXPRESSION_OPERATOR:-)(NumberLiteral:2))))))(TryStatement(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:htmlModel))(SimpleName:put)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)(MethodInvocation(SimpleName:generateHtmlForPromotions)(METHOD_INVOCATION_ARGUMENTS(SimpleName:langCode)(SimpleName:velocityTemplate)))))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:Exception))(SimpleName:e))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:log))(SimpleName:error)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)(SimpleName:e))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:htmlModel))(SimpleName:put)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)(StringLiteral:<STR>))))))))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:htmlModel))(SimpleName:put)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)(StringLiteral:<STR>))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:htmlModel))(SimpleName:put)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)(StringLiteral:<STR>))))(VariableDeclarationStatement(SimpleType(SimpleName:VelocityContext))(VariableDeclarationFragment(SimpleName:htmlContext)(ClassInstanceCreation(SimpleType(SimpleName:VelocityContext))(SimpleName:htmlModel))))(VariableDeclarationStatement(SimpleType(SimpleName:Template))(VariableDeclarationFragment(SimpleName:htmlTemplate)(NullLiteral)))(VariableDeclarationStatement(SimpleType(SimpleName:StringWriter))(VariableDeclarationFragment(SimpleName:htmlSw)(NullLiteral)))(TryStatement(Block(ExpressionStatement(Assignment(SimpleName:htmlTemplate)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:engine))(SimpleName:getTemplate)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:Constants.BASE_EMAIL_HTML_TEMPLATE)))))(ExpressionStatement(Assignment(SimpleName:htmlSw)(ASSIGNMENT_OPERATOR:=)(ClassInstanceCreation(SimpleType(SimpleName:StringWriter)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:htmlTemplate))(SimpleName:merge)(METHOD_INVOCATION_ARGUMENTS(SimpleName:htmlContext)(SimpleName:htmlSw))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:helper))(SimpleName:setText)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:htmlSw))(SimpleName:toString))(BooleanLiteral:true)))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:ResourceNotFoundException))(SimpleName:rnfe))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:log))(SimpleName:warn)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(QualifiedName:Constants.BASE_EMAIL_HTML_TEMPLATE))(SimpleName:rnfe))))(ThrowStatement(ClassInstanceCreation(SimpleType(SimpleName:EmailEngineException))(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(QualifiedName:Constants.BASE_EMAIL_HTML_TEMPLATE))))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:ParseErrorException))(SimpleName:pee))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:log))(SimpleName:warn)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)(SimpleName:pee))))(ThrowStatement(ClassInstanceCreation(SimpleType(SimpleName:EmailEngineException))(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:pee))(SimpleName:getMessage)))))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:MethodInvocationException))(SimpleName:mie))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:log))(SimpleName:warn)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)(SimpleName:mie))))(ThrowStatement(ClassInstanceCreation(SimpleType(SimpleName:EmailEngineException))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:mie))(SimpleName:getMessage))))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:Exception))(SimpleName:e))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:log))(SimpleName:warn)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)(SimpleName:e))))(ThrowStatement(ClassInstanceCreation(SimpleType(SimpleName:EmailEngineException))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:e))(SimpleName:getMessage))))))))(Block(VariableDeclarationStatement(SimpleType(SimpleName:String))(VariableDeclarationFragment(SimpleName:noHTMLString)(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:contentSw))(SimpleName:toString)))(SimpleName:replaceAll)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:config))(SimpleName:get)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:config))(SimpleName:get)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))))))(ExpressionStatement(Assignment(SimpleName:noHTMLString)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:noHTMLString))(SimpleName:replaceAll)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:config))(SimpleName:get)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:config))(SimpleName:get)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))))))(ExpressionStatement(Assignment(SimpleName:noHTMLString)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:noHTMLString))(SimpleName:replaceAll)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:config))(SimpleName:get)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:config))(SimpleName:get)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))))))(ExpressionStatement(Assignment(SimpleName:noHTMLString)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:noHTMLString))(SimpleName:replaceAll)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:config))(SimpleName:get)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:config))(SimpleName:get)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))))))(ExpressionStatement(Assignment(SimpleName:noHTMLString)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:noHTMLString))(SimpleName:replaceAll)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:config))(SimpleName:get)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:config))(SimpleName:get)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))))))(VariableDeclarationStatement(PrimitiveType:int)(VariableDeclarationFragment(SimpleName:regexNumber)(NumberLiteral:5)))(VariableDeclarationStatement(SimpleType(SimpleName:String))(VariableDeclarationFragment(SimpleName:regEX)(NullLiteral)))(WhileStatement(InfixExpression(InfixExpression(PrefixExpression(PREFIX_EXPRESSION_OPERATOR:++)(SimpleName:regexNumber))(INFIX_EXPRESSION_OPERATOR:<)(NumberLiteral:99))(INFIX_EXPRESSION_OPERATOR:&&)(InfixExpression(ParenthesizedExpression(Assignment(SimpleName:regEX)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:config))(SimpleName:get)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(SimpleName:regexNumber))))))(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral)))(Block(ExpressionStatement(Assignment(SimpleName:noHTMLString)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:noHTMLString))(SimpleName:replaceAll)(METHOD_INVOCATION_ARGUMENTS(SimpleName:regEX)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:config))(SimpleName:get)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(SimpleName:regexNumber)(StringLiteral:<STR>))))))))))(ExpressionStatement(Assignment(SimpleName:noHTMLString)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(SimpleName:removeHtmlSpecialEntities)(METHOD_INVOCATION_ARGUMENTS(SimpleName:noHTMLString)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:helper))(SimpleName:setText)(METHOD_INVOCATION_ARGUMENTS(SimpleName:noHTMLString))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:log))(SimpleName:debug)(METHOD_INVOCATION_ARGUMENTS(SimpleName:noHTMLString))))))(IfStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:model))(SimpleName:containsKey)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:helper))(SimpleName:setBcc)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EmailEngineConfiguration))(SimpleName:getInstance)))(SimpleName:getConfigurationParameter)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:EmailEngineConfiguration.SMTP_EFORMS)))))))(IfStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:model))(SimpleName:containsKey)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:helper))(SimpleName:setFrom)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:model))(SimpleName:get)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)))))))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:helper))(SimpleName:setFrom)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:EmailEngineConfiguration))(SimpleName:getInstance)))(SimpleName:getConfigurationParameter)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:EmailEngineConfiguration.EMAIL_SRC_ADR)))))))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:ConfigurationException))(SimpleName:e))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:log))(SimpleName:warn)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)(SimpleName:e))))(ThrowStatement(ClassInstanceCreation(SimpleType(SimpleName:EmailEngineException))(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:e))(SimpleName:getMessage))))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:log))(SimpleName:debug)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))(IfStatement(PrefixExpression(PREFIX_EXPRESSION_OPERATOR:!)(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:emailQueue))(SimpleName:getAttachments)))(SimpleName:isEmpty)))(Block(VariableDeclarationStatement(ParameterizedType(SimpleType(SimpleName:Set))(SimpleType(SimpleName:EmailAttachment)))(VariableDeclarationFragment(SimpleName:attachments)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:emailQueue))(SimpleName:getAttachments))))(VariableDeclarationStatement(SimpleType(SimpleName:FileOutputStream))(VariableDeclarationFragment(SimpleName:fos)(NullLiteral)))(VariableDeclarationStatement(SimpleType(SimpleName:InputStream))(VariableDeclarationFragment(SimpleName:is)))(EnhancedForStatement(SingleVariableDeclaration(SimpleType(SimpleName:EmailAttachment))(SimpleName:att))(SimpleName:attachments)(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:log))(SimpleName:debug)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(SimpleName:att)))))(TryStatement(Block(ExpressionStatement(Assignment(SimpleName:is)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:att))(SimpleName:getAttachmentContent)))(SimpleName:getBinaryStream))))(VariableDeclarationStatement(SimpleType(SimpleName:ByteArrayOutputStream))(VariableDeclarationFragment(SimpleName:out)(ClassInstanceCreation(SimpleType(SimpleName:ByteArrayOutputStream)))))(VariableDeclarationStatement(PrimitiveType:int)(VariableDeclarationFragment(SimpleName:read)))(WhileStatement(InfixExpression(ParenthesizedExpression(Assignment(SimpleName:read)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:is))(SimpleName:read))))(INFIX_EXPRESSION_OPERATOR:!=)(ParenthesizedExpression(PrefixExpression(PREFIX_EXPRESSION_OPERATOR:-)(NumberLiteral:1))))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:out))(SimpleName:write)(METHOD_INVOCATION_ARGUMENTS(SimpleName:read))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:is))(SimpleName:close)))(VariableDeclarationStatement(ArrayType(PrimitiveType:byte)(Dimension))(VariableDeclarationFragment(SimpleName:b)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:out))(SimpleName:toByteArray))))(VariableDeclarationStatement(SimpleType(SimpleName:File))(VariableDeclarationFragment(SimpleName:file)(ClassInstanceCreation(SimpleType(SimpleName:File))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:att))(SimpleName:getAttachmentName)))))(ExpressionStatement(Assignment(SimpleName:fos)(ASSIGNMENT_OPERATOR:=)(ClassInstanceCreation(SimpleType(SimpleName:FileOutputStream))(SimpleName:file))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:fos))(SimpleName:write)(METHOD_INVOCATION_ARGUMENTS(SimpleName:b))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:fos))(SimpleName:flush)))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:fos))(SimpleName:close)))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:helper))(SimpleName:addAttachment)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:att))(SimpleName:getAttachmentName))(SimpleName:file)))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:SQLException))(SimpleName:e))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:log))(SimpleName:error)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(SimpleName:att))(SimpleName:e))))(ThrowStatement(ClassInstanceCreation(SimpleType(SimpleName:EmailEngineException))(StringLiteral:<STR>)))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:IOException))(SimpleName:ioe))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:log))(SimpleName:error)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>)(SimpleName:ioe))))(ThrowStatement(ClassInstanceCreation(SimpleType(SimpleName:EmailEngineException))(StringLiteral:<STR>))))))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:helper))(SimpleName:setSentDate)(METHOD_INVOCATION_ARGUMENTS(ClassInstanceCreation(SimpleType(SimpleName:Timestamp))(MethodInvocation(METHOD_INVOCATION_RECEIVER(ClassInstanceCreation(SimpleType(SimpleName:Date))))(SimpleName:getTime)))))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:MessagingException))(SimpleName:e))(Block(ThrowStatement(ClassInstanceCreation(SimpleType(SimpleName:EmailEngineException))(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:e))(SimpleName:getMessage))))))))(ReturnStatement(SimpleName:helper))))))