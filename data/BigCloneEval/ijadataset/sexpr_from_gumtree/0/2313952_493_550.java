(CompilationUnit(TypeDeclaration(Modifier:public)(TYPE_DECLARATION_KIND:class)(SimpleName:Test)(MethodDeclaration(Modifier:public)(PrimitiveType:void)(SimpleName:truncate)(SingleVariableDeclaration(SimpleType(SimpleName:String))(SimpleName:path))(SingleVariableDeclaration(PrimitiveType:long)(SimpleName:truncate_length))(SingleVariableDeclaration(ParameterizedType(SimpleType(SimpleName:Thunk2))(SimpleType(SimpleName:Integer))(SimpleType(SimpleName:Update)))(SimpleName:app_cb))(Block(IfStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:logger))(SimpleName:isInfoEnabled))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:logger))(SimpleName:info)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(SimpleName:path)(StringLiteral:<STR>)(SimpleName:truncate_length))))))(VariableDeclarationStatement(SimpleType(SimpleName:ObjectState))(VariableDeclarationFragment(SimpleName:state)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:state_map))(SimpleName:get)(METHOD_INVOCATION_ARGUMENTS(SimpleName:path)))))(IfStatement(InfixExpression(SimpleName:state)(INFIX_EXPRESSION_OPERATOR:==)(NullLiteral))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:logger))(SimpleName:warn)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(SimpleName:path)))))(VariableDeclarationStatement(PrimitiveType:int)(VariableDeclarationFragment(SimpleName:status)(QualifiedName:MoxieStatus.MOXIE_STATUS_IO)))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:app_cb))(SimpleName:run)(METHOD_INVOCATION_ARGUMENTS(SimpleName:status)(CastExpression(SimpleType(SimpleName:Update))(NullLiteral)))))(ReturnStatement)))(SynchronizedStatement(SimpleName:state)(Block(ExpressionStatement(Assignment(QualifiedName:state.busy)(ASSIGNMENT_OPERATOR:=)(BooleanLiteral:true)))))(VariableDeclarationStatement(PrimitiveType:boolean)(VariableDeclarationFragment(SimpleName:requires_server_update)(BooleanLiteral:false)))(TryStatement(Block(VariableDeclarationStatement(PrimitiveType:long)(VariableDeclarationFragment(SimpleName:file_length)(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:state))(SimpleName:getChannel)))(SimpleName:size))))(IfStatement(InfixExpression(SimpleName:file_length)(INFIX_EXPRESSION_OPERATOR:>)(SimpleName:truncate_length))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:state))(SimpleName:getChannel)))(SimpleName:truncate)(METHOD_INVOCATION_ARGUMENTS(SimpleName:truncate_length))))(ExpressionStatement(Assignment(SimpleName:requires_server_update)(ASSIGNMENT_OPERATOR:=)(BooleanLiteral:true)))(ExpressionStatement(Assignment(QualifiedName:state.md.size)(ASSIGNMENT_OPERATOR:=)(CastExpression(PrimitiveType:int)(SimpleName:truncate_length)))))(IfStatement(InfixExpression(SimpleName:file_length)(INFIX_EXPRESSION_OPERATOR:<)(SimpleName:truncate_length))(Block(ExpressionStatement(MethodInvocation(SimpleName:BUG)(METHOD_INVOCATION_ARGUMENTS(StringLiteral:<STR>))))(ExpressionStatement(Assignment(SimpleName:requires_server_update)(ASSIGNMENT_OPERATOR:=)(BooleanLiteral:true)))(ExpressionStatement(Assignment(QualifiedName:state.md.size)(ASSIGNMENT_OPERATOR:=)(CastExpression(PrimitiveType:int)(SimpleName:truncate_length)))))(Block(AssertStatement(ParenthesizedExpression(InfixExpression(SimpleName:file_length)(INFIX_EXPRESSION_OPERATOR:==)(SimpleName:truncate_length))))))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:Exception))(SimpleName:e))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:logger))(SimpleName:fatal)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(SimpleName:e)))))(SynchronizedStatement(SimpleName:state)(Block(ExpressionStatement(Assignment(QualifiedName:state.busy)(ASSIGNMENT_OPERATOR:=)(BooleanLiteral:false)))))(VariableDeclarationStatement(PrimitiveType:int)(VariableDeclarationFragment(SimpleName:status)(QualifiedName:MoxieStatus.MOXIE_STATUS_IO)))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:app_cb))(SimpleName:run)(METHOD_INVOCATION_ARGUMENTS(SimpleName:status)(CastExpression(SimpleType(SimpleName:Update))(NullLiteral)))))(ReturnStatement))))(IfStatement(QualifiedName:state.open_write)(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:logger))(SimpleName:warn)(METHOD_INVOCATION_ARGUMENTS(InfixExpression(StringLiteral:<STR>)(INFIX_EXPRESSION_OPERATOR:+)(StringLiteral:<STR>)(SimpleName:path)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:truncate_update_cb))(SimpleName:run)(METHOD_INVOCATION_ARGUMENTS(SimpleName:path)(SimpleName:truncate_length)(SimpleName:app_cb)(CastExpression(SimpleType(SimpleName:Update))(NullLiteral))))))(IfStatement(PrefixExpression(PREFIX_EXPRESSION_OPERATOR:!)(SimpleName:requires_server_update))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:truncate_update_cb))(SimpleName:run)(METHOD_INVOCATION_ARGUMENTS(SimpleName:path)(SimpleName:truncate_length)(SimpleName:app_cb)(CastExpression(SimpleType(SimpleName:Update))(NullLiteral))))))(Block(AssertStatement(ParenthesizedExpression(SimpleName:requires_server_update)))(VariableDeclarationStatement(SimpleType(SimpleName:FileChannel))(VariableDeclarationFragment(SimpleName:fchannel)(NullLiteral)))(TryStatement(Block(ExpressionStatement(Assignment(SimpleName:fchannel)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:state))(SimpleName:getChannel)))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:IOException))(SimpleName:e))(Block(SynchronizedStatement(SimpleName:state)(Block(ExpressionStatement(Assignment(QualifiedName:state.busy)(ASSIGNMENT_OPERATOR:=)(BooleanLiteral:false)))))(VariableDeclarationStatement(PrimitiveType:int)(VariableDeclarationFragment(SimpleName:status)(QualifiedName:MoxieStatus.MOXIE_STATUS_IO)))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:app_cb))(SimpleName:run)(METHOD_INVOCATION_ARGUMENTS(SimpleName:status)(CastExpression(SimpleType(SimpleName:Update))(NullLiteral)))))(ReturnStatement))))(VariableDeclarationStatement(ParameterizedType(SimpleType(SimpleName:Thunk1))(SimpleType(SimpleName:Update)))(VariableDeclarationFragment(SimpleName:update_cb)(MethodInvocation(SimpleName:curry)(METHOD_INVOCATION_ARGUMENTS(SimpleName:truncate_update_cb)(SimpleName:path)(SimpleName:truncate_length)(SimpleName:app_cb)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:updater))(SimpleName:computeUpdate)(METHOD_INVOCATION_ARGUMENTS(SimpleName:path)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:state))(SimpleName:getCachePath))(QualifiedName:state.ver)(SimpleName:fchannel)(SimpleName:update_cb)))))))(ReturnStatement)))))