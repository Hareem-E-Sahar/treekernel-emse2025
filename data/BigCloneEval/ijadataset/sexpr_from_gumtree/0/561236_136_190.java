(CompilationUnit(TypeDeclaration(Modifier:public)(TYPE_DECLARATION_KIND:class)(SimpleName:Test)(MethodDeclaration(Modifier:private)(SimpleType(SimpleName:HttpApiResponse))(SimpleName:execute)(SingleVariableDeclaration(SimpleType(SimpleName:String))(SimpleName:method))(SingleVariableDeclaration(SimpleType(SimpleName:HttpApiRequest))(SimpleName:httpApiRequest))(SingleVariableDeclaration(SimpleType(SimpleName:BaseRequestItem))(SimpleName:requestItem))(Block(IfStatement(InfixExpression(QualifiedName:httpApiRequest.href)(INFIX_EXPRESSION_OPERATOR:==)(NullLiteral))(Block(ThrowStatement(ClassInstanceCreation(SimpleType(SimpleName:ProtocolException))(QualifiedName:HttpServletResponse.SC_BAD_REQUEST)(StringLiteral:<STR>)))))(VariableDeclarationStatement(SimpleType(SimpleName:Uri))(VariableDeclarationFragment(SimpleName:href)(MethodInvocation(SimpleName:normalizeUrl)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:httpApiRequest.href)))))(TryStatement(Block(VariableDeclarationStatement(SimpleType(SimpleName:HttpRequest))(VariableDeclarationFragment(SimpleName:req)(ClassInstanceCreation(SimpleType(SimpleName:HttpRequest))(SimpleName:href))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:req))(SimpleName:setMethod)(METHOD_INVOCATION_ARGUMENTS(SimpleName:method))))(IfStatement(InfixExpression(QualifiedName:httpApiRequest.body)(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:req))(SimpleName:setPostBody)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(QualifiedName:httpApiRequest.body))(SimpleName:getBytes)))))))(EnhancedForStatement(SingleVariableDeclaration(ParameterizedType(SimpleType(QualifiedName:Map.Entry))(SimpleType(SimpleName:String))(ParameterizedType(SimpleType(SimpleName:List))(SimpleType(SimpleName:String))))(SimpleName:header))(MethodInvocation(METHOD_INVOCATION_RECEIVER(QualifiedName:httpApiRequest.headers))(SimpleName:entrySet))(Block(IfStatement(PrefixExpression(PREFIX_EXPRESSION_OPERATOR:!)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:BAD_HEADERS))(SimpleName:contains)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:header))(SimpleName:getKey)))(SimpleName:trim)))(SimpleName:toUpperCase)))))(Block(EnhancedForStatement(SingleVariableDeclaration(SimpleType(SimpleName:String))(SimpleName:value))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:header))(SimpleName:getValue))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:req))(SimpleName:addHeader)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:header))(SimpleName:getKey))(SimpleName:value))))))))))(VariableDeclarationStatement(SimpleType(SimpleName:Uri))(VariableDeclarationFragment(SimpleName:gadgetUri)(MethodInvocation(SimpleName:getGadgetUri)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:requestItem))(SimpleName:getToken))(SimpleName:httpApiRequest)))))(IfStatement(InfixExpression(SimpleName:gadgetUri)(INFIX_EXPRESSION_OPERATOR:==)(NullLiteral))(Block(ThrowStatement(ClassInstanceCreation(SimpleType(SimpleName:ProtocolException))(QualifiedName:HttpServletResponse.SC_BAD_REQUEST)(StringLiteral:<STR>)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:req))(SimpleName:setGadget)(METHOD_INVOCATION_ARGUMENTS(SimpleName:gadgetUri))))(IfStatement(InfixExpression(QualifiedName:httpApiRequest.authz)(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:req))(SimpleName:setAuthType)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:AuthType))(SimpleName:parse)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:httpApiRequest.authz))))))))(IfStatement(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:req))(SimpleName:getAuthType))(INFIX_EXPRESSION_OPERATOR:!=)(QualifiedName:AuthType.NONE))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:req))(SimpleName:setSecurityToken)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:requestItem))(SimpleName:getToken)))))(VariableDeclarationStatement(ParameterizedType(SimpleType(SimpleName:Map))(SimpleType(SimpleName:String))(SimpleType(SimpleName:String)))(VariableDeclarationFragment(SimpleName:authSettings)(MethodInvocation(SimpleName:getAuthSettings)(METHOD_INVOCATION_ARGUMENTS(SimpleName:requestItem)))))(VariableDeclarationStatement(SimpleType(SimpleName:OAuthArguments))(VariableDeclarationFragment(SimpleName:oauthArgs)(ClassInstanceCreation(SimpleType(SimpleName:OAuthArguments))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:req))(SimpleName:getAuthType))(SimpleName:authSettings))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:oauthArgs))(SimpleName:setSignOwner)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:httpApiRequest.signOwner))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:oauthArgs))(SimpleName:setSignViewer)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:httpApiRequest.signViewer))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:req))(SimpleName:setOAuthArguments)(METHOD_INVOCATION_ARGUMENTS(SimpleName:oauthArgs))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:req))(SimpleName:setIgnoreCache)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:httpApiRequest.noCache))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:req))(SimpleName:setSanitizationRequested)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:httpApiRequest.sanitize))))(IfStatement(InfixExpression(QualifiedName:httpApiRequest.refreshInterval)(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:req))(SimpleName:setCacheTtl)(METHOD_INVOCATION_ARGUMENTS(QualifiedName:httpApiRequest.refreshInterval))))))(VariableDeclarationStatement(SimpleType(SimpleName:HttpResponse))(VariableDeclarationFragment(SimpleName:results)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:requestPipeline))(SimpleName:execute)(METHOD_INVOCATION_ARGUMENTS(SimpleName:req)))))(ExpressionStatement(Assignment(SimpleName:results)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:contentRewriterRegistry))(SimpleName:rewriteHttpResponse)(METHOD_INVOCATION_ARGUMENTS(SimpleName:req)(SimpleName:results)))))(VariableDeclarationStatement(SimpleType(SimpleName:HttpApiResponse))(VariableDeclarationFragment(SimpleName:httpApiResponse)(ClassInstanceCreation(SimpleType(SimpleName:HttpApiResponse))(SimpleName:results)(MethodInvocation(SimpleName:transformBody)(METHOD_INVOCATION_ARGUMENTS(SimpleName:httpApiRequest)(SimpleName:results)))(SimpleName:httpApiRequest))))(IfStatement(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:requestItem))(SimpleName:getToken))(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(Block(VariableDeclarationStatement(SimpleType(SimpleName:String))(VariableDeclarationFragment(SimpleName:updatedAuthToken)(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:requestItem))(SimpleName:getToken)))(SimpleName:getUpdatedToken))))(IfStatement(InfixExpression(SimpleName:updatedAuthToken)(INFIX_EXPRESSION_OPERATOR:!=)(NullLiteral))(Block(ExpressionStatement(Assignment(QualifiedName:httpApiResponse.token)(ASSIGNMENT_OPERATOR:=)(SimpleName:updatedAuthToken)))))))(ReturnStatement(SimpleName:httpApiResponse)))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:GadgetException))(SimpleName:ge))(Block(ThrowStatement(ClassInstanceCreation(SimpleType(SimpleName:ProtocolException))(QualifiedName:HttpServletResponse.SC_INTERNAL_SERVER_ERROR)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:ge))(SimpleName:getMessage))(SimpleName:ge)))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:RewritingException))(SimpleName:re))(Block(ThrowStatement(ClassInstanceCreation(SimpleType(SimpleName:ProtocolException))(QualifiedName:HttpServletResponse.SC_INTERNAL_SERVER_ERROR)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:re))(SimpleName:getMessage))(SimpleName:re))))))))))