(CompilationUnit(TypeDeclaration(Modifier:public)(TYPE_DECLARATION_KIND:class)(SimpleName:Test)(MethodDeclaration(Modifier:private)(SimpleType(SimpleName:Message))(SimpleName:handlePublishMessage)(SingleVariableDeclaration(SimpleType(SimpleName:AsyncMessage))(SimpleName:message))(SingleVariableDeclaration(SimpleType(SimpleName:Channel))(SimpleName:channel))(Block(VariableDeclarationStatement(SimpleType(SimpleName:GraniteContext))(VariableDeclarationFragment(SimpleName:context)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:GraniteContext))(SimpleName:getCurrentInstance))))(VariableDeclarationStatement(SimpleType(SimpleName:Destination))(VariableDeclarationFragment(SimpleName:destination)(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:context))(SimpleName:getServicesConfig)))(SimpleName:findDestinationById)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:message))(SimpleName:getClass)))(SimpleName:getName))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:message))(SimpleName:getDestination))))))(IfStatement(InfixExpression(SimpleName:destination)(INFIX_EXPRESSION_OPERATOR:==)(NullLiteral))(ReturnStatement(MethodInvocation(SimpleName:getInvalidDestinationError)(METHOD_INVOCATION_ARGUMENTS(SimpleName:message)))))(VariableDeclarationStatement(SimpleType(SimpleName:GravityInvocationContext))(VariableDeclarationFragment(SimpleName:invocationContext)(ClassInstanceCreation(SimpleType(SimpleName:GravityInvocationContext))(SimpleName:message)(SimpleName:destination))))(IfStatement(InstanceofExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:destination))(SimpleName:getSecurizer))(SimpleType(SimpleName:GravityDestinationSecurizer)))(Block(TryStatement(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(ParenthesizedExpression(CastExpression(SimpleType(SimpleName:GravityDestinationSecurizer))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:destination))(SimpleName:getSecurizer)))))(SimpleName:canPublish)(METHOD_INVOCATION_ARGUMENTS(SimpleName:invocationContext)))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:Exception))(SimpleName:e))(Block(ReturnStatement(ClassInstanceCreation(SimpleType(SimpleName:ErrorMessage))(SimpleName:message)(SimpleName:e)(BooleanLiteral:true))))))))(VariableDeclarationStatement(SimpleType(SimpleName:GraniteConfig))(VariableDeclarationFragment(SimpleName:config)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:context))(SimpleName:getGraniteConfig))))(IfStatement(InfixExpression(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:config))(SimpleName:hasSecurityService))(INFIX_EXPRESSION_OPERATOR:&&)(InstanceofExpression(SimpleName:context)(SimpleType(SimpleName:HttpGraniteContext))))(Block(TryStatement(Block(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:config))(SimpleName:getSecurityService)))(SimpleName:authorize)(METHOD_INVOCATION_ARGUMENTS(SimpleName:invocationContext)))))(CatchClause(SingleVariableDeclaration(SimpleType(SimpleName:Exception))(SimpleName:e))(Block(ReturnStatement(ClassInstanceCreation(SimpleType(SimpleName:ErrorMessage))(SimpleName:message)(SimpleName:e)(BooleanLiteral:true))))))))(VariableDeclarationStatement(SimpleType(SimpleName:Channel))(VariableDeclarationFragment(SimpleName:fromChannel)(SimpleName:channel)))(IfStatement(InfixExpression(SimpleName:fromChannel)(INFIX_EXPRESSION_OPERATOR:==)(NullLiteral))(ExpressionStatement(Assignment(SimpleName:fromChannel)(ASSIGNMENT_OPERATOR:=)(MethodInvocation(SimpleName:getChannel)(METHOD_INVOCATION_ARGUMENTS(CastExpression(SimpleType(SimpleName:String))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:message))(SimpleName:getClientId))))))))(IfStatement(InfixExpression(SimpleName:fromChannel)(INFIX_EXPRESSION_OPERATOR:==)(NullLiteral))(ReturnStatement(MethodInvocation(SimpleName:handleUnknownClientMessage)(METHOD_INVOCATION_ARGUMENTS(SimpleName:message)))))(VariableDeclarationStatement(SimpleType(SimpleName:ServiceAdapter))(VariableDeclarationFragment(SimpleName:adapter)(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:adapterFactory))(SimpleName:getServiceAdapter)(METHOD_INVOCATION_ARGUMENTS(SimpleName:message)))))(VariableDeclarationStatement(SimpleType(SimpleName:AsyncMessage))(VariableDeclarationFragment(SimpleName:reply)(CastExpression(SimpleType(SimpleName:AsyncMessage))(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:adapter))(SimpleName:invoke)(METHOD_INVOCATION_ARGUMENTS(SimpleName:fromChannel)(SimpleName:message))))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:reply))(SimpleName:setDestination)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:message))(SimpleName:getDestination)))))(ExpressionStatement(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:reply))(SimpleName:setClientId)(METHOD_INVOCATION_ARGUMENTS(MethodInvocation(METHOD_INVOCATION_RECEIVER(SimpleName:fromChannel))(SimpleName:getId)))))(ReturnStatement(SimpleName:reply))))))